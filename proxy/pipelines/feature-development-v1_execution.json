{
  "pipelineId": "feature-development-v1",
  "startTime": "2025-11-16T20:09:25.815Z",
  "events": [
    {
      "timestamp": "2025-11-16T20:09:25.816Z",
      "eventType": "pipeline_initialized",
      "pipelineName": "Feature Development Pipeline V1",
      "userContext": "The user needs automation testing infrastructure for the game. Implement a WebSocket server that can be used for automated testing purposes. The WebSocket should accept commands to control the game state and query information about the current game state. Key requirements:\n\n1. WebSocket server that can be enabled/disabled (possibly via a debug flag or test mode)\n2. Command interface to:\n   - Control player ship (movement, fitting, undocking, etc.)\n   - Query game state (ship position, fitted modules, inventory, etc.)\n   - Trigger game events (combat, resource gathering, etc.)\n   - Get current scene/state information\n3. Response format should be JSON for easy parsing in test scripts\n4. Security consideration: This should only be available in test/debug mode, not production\n5. Example commands might include: getShipState, setThrottle, dock, undock, fitItem, getInventory, etc.\n\nThis will enable automated integration testing of game features and help catch bugs like the recent navigation issue after ship fitting.\n\nInputs from previous stages:\n\n[classify_request]:\n```json\n{\n  \"classification\": \"FEATURE_REQUEST\",\n  \"confidence\": 0.98,\n  \"reasoning\": \"This is a clear request to implement new functionality - a WebSocket server for automated testing. While it's testing infrastructure rather than a player-facing feature, it still requires creating new code, new systems, and new functionality that doesn't currently exist. The request includes multiple components (WebSocket server, command interface, JSON response format, security controls) and represents a significant new capability for the codebase.\",\n  \"context\": {\n    \"originalRequest\": \"Implement WebSocket server for automated testing infrastructure\",\n    \"keyIndicators\": [\"implement\", \"WebSocket server\", \"command interface\", \"enable automated testing\"],\n    \"affectedArea\": \"testing infrastructure, game state management, debug systems\",\n    \"priority\": \"medium\",\n    \"scope\": \"This is a developer-facing feature that will enable better testing workflows. It requires: 1) WebSocket server implementation, 2) Command parser/router, 3) Game state query interface, 4) Security/debug mode controls, 5) Integration with existing game systems (ship control, inventory, fitting, etc.)\",\n    \"technicalConsiderations\": [\n      \"WebSocket server (likely Node.js or browser-based)\",\n      \"JSON command/response protocol design\",\n      \"Game state access layer\",\n      \"Debug mode flag system\",\n      \"Security to prevent production exposure\",\n      \"Integration points with SpaceshipSimulator, ShipFittingManager, InventoryUI, etc.\"\n    ]\n  }\n}\n```\n\nThis request asks to \"implement\" a WebSocket server with multiple sub-features (command interface, query system, JSON responses, security controls). These are all new capabilities being added to the codebase, making it clearly a **FEATURE_REQUEST** rather than a bug fix, quick change, refactor, or question.\n\nThe request is well-structured with clear requirements and use cases (automated testing, catching bugs like the navigation issue). This will require significant new code across multiple files and systems.\n\nDECISION: FEATURE_REQUEST\n",
      "workingDir": "/mnt/c/github/superstarships",
      "totalStages": 7,
      "stageNames": [
        "Feature Definition",
        "Test Planning",
        "Implementation Planning",
        "Feature Implementation",
        "Run Game & Observe",
        "Behavior Observation",
        "Expectation Validation"
      ],
      "connections": [
        {
          "from": "define_feature",
          "to": "plan_tests",
          "condition": "feature_defined",
          "description": "Feature defined, create test plan"
        },
        {
          "from": "plan_tests",
          "to": "plan_implementation",
          "condition": "test_plan_ready",
          "description": "Tests planned, design implementation"
        },
        {
          "from": "plan_implementation",
          "to": "implement_feature",
          "condition": "implementation_plan_ready",
          "description": "Plan ready, implement feature"
        },
        {
          "from": "implement_feature",
          "to": "run_game",
          "condition": "implementation_complete",
          "description": "Feature implemented, run game"
        },
        {
          "from": "run_game",
          "to": "observe_behavior",
          "condition": "execution_complete",
          "description": "Game executed, observe behavior"
        },
        {
          "from": "observe_behavior",
          "to": "validate_expectations",
          "condition": "observation_complete",
          "description": "Behavior observed, validate against expectations"
        },
        {
          "from": "validate_expectations",
          "to": null,
          "condition": "FEATURE_COMPLETE",
          "description": "Feature complete and validated - PIPELINE ENDS"
        },
        {
          "from": "validate_expectations",
          "to": "implement_feature",
          "condition": "NEEDS_REFINEMENT",
          "description": "Minor issues, refine implementation"
        },
        {
          "from": "validate_expectations",
          "to": "plan_implementation",
          "condition": "INCOMPLETE",
          "description": "Significant gaps, revise implementation plan"
        },
        {
          "from": "validate_expectations",
          "to": "plan_tests",
          "condition": "NEEDS_MORE_TESTING",
          "description": "Insufficient test coverage, improve test plan"
        }
      ]
    },
    {
      "timestamp": "2025-11-16T20:09:25.862Z",
      "eventType": "stage_started",
      "executionNumber": 1,
      "stageId": "define_feature",
      "stageName": "Feature Definition",
      "agent": "feature_definer",
      "stageType": "planner",
      "description": "Define feature specifications and acceptance criteria",
      "inputs": []
    },
    {
      "timestamp": "2025-11-16T20:10:04.654Z",
      "eventType": "stage_completed",
      "executionNumber": 1,
      "stageId": "define_feature",
      "stageName": "Feature Definition",
      "agent": "feature_definer",
      "outputLength": 6534,
      "output": "```json\n{\n  \"featureName\": \"WebSocket Testing Server\",\n  \"userStory\": \"As a developer, I want a WebSocket server for automated testing so that I can write integration tests to catch bugs like the recent navigation issue after ship fitting\",\n  \"description\": \"A WebSocket server that provides a command-based interface for controlling and querying the game state during automated testing. The server accepts JSON commands to manipulate the player ship, query game state, and trigger events. It responds with JSON data that can be parsed by test scripts. This is a debug/test-only feature that should not be available in production builds.\",\n  \"acceptanceCriteria\": [\n    \"WebSocket server can be enabled/disabled via debug flag or test mode configuration\",\n    \"Server accepts JSON commands and returns JSON responses\",\n    \"Command: getShipState returns current ship position, velocity, fitted modules, and status\",\n    \"Command: setThrottle(value) sets ship throttle to specified value (0-100)\",\n    \"Command: dock() initiates docking at nearest station\",\n    \"Command: undock() initiates undocking from current station\",\n    \"Command: fitItem(itemId, slot) fits specified item to ship slot\",\n    \"Command: unfitItem(slot) removes item from ship slot\",\n    \"Command: getInventory() returns current inventory contents\",\n    \"Command: getSceneInfo() returns current scene/state (in space, docked, combat, etc.)\",\n    \"Command: setPosition(x, y, z) teleports ship to specified coordinates (debug only)\",\n    \"Command: addResource(resourceType, amount) adds resources to inventory (debug only)\",\n    \"Command: triggerCombat(enemyType) spawns enemy ship for combat testing\",\n    \"Server only listens on localhost in test mode\",\n    \"Connection rejected with error if not in test/debug mode\",\n    \"All commands return success/failure status and relevant data\",\n    \"Error responses include error codes and descriptive messages\"\n  ],\n  \"scope\": {\n    \"inScope\": [\n      \"WebSocket server implementation (browser-based or Node.js proxy)\",\n      \"JSON command parser and router\",\n      \"Game state query interface\",\n      \"Ship control commands (throttle, movement, docking)\",\n      \"Inventory and fitting commands\",\n      \"Scene/state information queries\",\n      \"Debug-only cheat commands (teleport, add resources)\",\n      \"Test mode flag and security controls\",\n      \"Error handling and response formatting\",\n      \"Integration with SpaceshipSimulator, ShipFittingManager, InventoryUI, StationManager\"\n    ],\n    \"outOfScope\": [\n      \"Multi-player testing (single client only)\",\n      \"Recording/playback of test sessions\",\n      \"Built-in test script runner\",\n      \"GUI for sending commands (CLI/script-based only)\",\n      \"Production builds (test mode only)\",\n      \"Authentication/authorization (localhost-only is sufficient)\",\n      \"Persistent test data storage\",\n      \"Performance profiling hooks (separate feature)\"\n    ]\n  },\n  \"affectedSystems\": [\n    \"SpaceshipSimulator (main game loop integration)\",\n    \"ShipFittingManager (fitting commands)\",\n    \"InventoryUI/CargoManager (inventory queries)\",\n    \"StationManager (docking/undocking)\",\n    \"Ship (ship state queries and control)\",\n    \"NavigationManager (position queries)\",\n    \"ResourceManager (resource manipulation)\",\n    \"Debug systems (test mode flag)\"\n  ],\n  \"technicalConsiderations\": {\n    \"implementation\": \"Browser-based WebSocket client connecting to external test server, OR lightweight Node.js WebSocket server that controls game via window.simulator reference\",\n    \"protocol\": \"JSON-RPC style with command, params, and id fields\",\n    \"security\": \"Test mode flag checked at server startup and on each command, localhost-only binding\",\n    \"performance\": \"Commands should execute synchronously where possible, async for docking/undocking\",\n    \"integration\": \"Add TestingInterface class that wraps simulator and provides command handlers\"\n  },\n  \"dependencies\": [\n    \"Requires access to window.simulator instance\",\n    \"Needs ShipFittingManager for fitting commands\",\n    \"Needs InventoryUI/CargoManager for inventory queries\",\n    \"Needs StationManager for docking operations\",\n    \"Requires test mode flag (new or extend existing debug mode)\",\n    \"WebSocket library (ws for Node.js or native WebSocket API for browser)\"\n  ],\n  \"edgeCases\": [\n    \"What happens if command is sent while game is paused?\",\n    \"How to handle commands during scene transitions (warping, docking)?\",\n    \"What if fitItem command references invalid item or slot?\",\n    \"How to handle multiple simultaneous commands?\",\n    \"What if WebSocket disconnects during long-running operation?\",\n    \"How to prevent test commands from breaking game state?\",\n    \"Should commands be queued or rejected if game is busy?\",\n    \"How to handle browser refresh (reconnection logic)?\",\n    \"What data should be included in error responses for debugging?\",\n    \"Should there be a 'reset game state' command for test cleanup?\"\n  ],\n  \"proposedArchitecture\": {\n    \"components\": [\n      {\n        \"name\": \"TestingWebSocketServer\",\n        \"file\": \"js/testing/TestingWebSocketServer.js\",\n        \"purpose\": \"WebSocket server implementation with command routing\"\n      },\n      {\n        \"name\": \"GameTestingInterface\",\n        \"file\": \"js/testing/GameTestingInterface.js\",\n        \"purpose\": \"Command handlers that interact with game systems\"\n      },\n      {\n        \"name\": \"TestModeManager\",\n        \"file\": \"js/debug/TestModeManager.js\",\n        \"purpose\": \"Test mode flag and security controls\"\n      }\n    ],\n    \"commandFormat\": {\n      \"request\": {\n        \"id\": \"unique-request-id\",\n        \"command\": \"getShipState\",\n        \"params\": {}\n      },\n      \"response\": {\n        \"id\": \"unique-request-id\",\n        \"success\": true,\n        \"data\": {},\n        \"error\": null\n      }\n    }\n  },\n  \"testingConsiderations\": {\n    \"unitTests\": \"Test individual command handlers with mocked game state\",\n    \"integrationTests\": \"Test WebSocket communication and game state changes\",\n    \"securityTests\": \"Verify test mode enforcement and localhost binding\",\n    \"exampleTestScript\": \"Python or Node.js script demonstrating command usage\"\n  },\n  \"documentationNeeds\": [\n    \"Command reference with all available commands and parameters\",\n    \"Example test scripts in Python and JavaScript\",\n    \"Architecture overview explaining how testing interface integrates\",\n    \"Security notes about test mode requirements\",\n    \"Troubleshooting guide for common issues\"\n  ]\n}\n```\n\nDECISION: feature_defined",
      "completedStagesCount": 1,
      "totalExecutions": 1
    },
    {
      "timestamp": "2025-11-16T20:10:05.340Z",
      "eventType": "stage_routed",
      "fromStage": "define_feature",
      "toStage": "plan_tests",
      "decision": "FEATURE_DEFINED",
      "reasoning": "Decision \"FEATURE_DEFINED\" matched connection condition"
    },
    {
      "timestamp": "2025-11-16T20:10:05.411Z",
      "eventType": "stage_started",
      "executionNumber": 2,
      "stageId": "plan_tests",
      "stageName": "Test Planning",
      "agent": "test_planner",
      "stageType": "planner",
      "description": "Create test plan with expected behaviors BEFORE implementation",
      "inputs": [
        "define_feature"
      ]
    },
    {
      "timestamp": "2025-11-16T20:12:47.618Z",
      "eventType": "stage_completed",
      "executionNumber": 2,
      "stageId": "plan_tests",
      "stageName": "Test Planning",
      "agent": "test_planner",
      "outputLength": 39805,
      "output": "I'll create a comprehensive test plan for the WebSocket Testing Server feature BEFORE implementation begins.\n\n```json\n{\n  \"testPlan\": {\n    \"feature\": \"WebSocket Testing Server\",\n    \"version\": \"1.0.0\",\n    \"totalTestCases\": 32,\n    \"categories\": [\n      \"security\",\n      \"connectivity\",\n      \"ship-control\",\n      \"inventory-fitting\",\n      \"state-queries\",\n      \"debug-commands\",\n      \"error-handling\",\n      \"integration\",\n      \"performance\"\n    ],\n    \"testEnvironment\": {\n      \"browser\": \"Chrome/Firefox latest\",\n      \"gameState\": \"Fresh load with default ship and resources\",\n      \"testMode\": \"Enabled via URL parameter ?testMode=true or localStorage flag\"\n    }\n  },\n  \"testCases\": [\n    {\n      \"id\": \"TC-SEC-001\",\n      \"category\": \"security\",\n      \"priority\": \"critical\",\n      \"description\": \"WebSocket server rejects connections when test mode is disabled\",\n      \"preconditions\": [\n        \"Game loaded WITHOUT test mode flag\",\n        \"WebSocket client attempts connection to ws://localhost:8765\"\n      ],\n      \"steps\": [\n        \"Load game normally (no ?testMode=true parameter)\",\n        \"Attempt WebSocket connection from test script\",\n        \"Observe connection response\"\n      ],\n      \"expectedOutcome\": {\n        \"connection\": \"Connection refused or immediately closed\",\n        \"response\": {\n          \"success\": false,\n          \"error\": {\n            \"code\": \"TEST_MODE_DISABLED\",\n            \"message\": \"Testing interface is not available in production mode\"\n          }\n        },\n        \"console\": \"Warning logged about rejected test connection\",\n        \"timing\": \"Rejection within 100ms\"\n      },\n      \"evidenceToCapture\": [\n        \"screenshot_production_mode.png\",\n        \"console_output_rejection.txt\",\n        \"network_tab_showing_connection_refused.png\"\n      ],\n      \"successCriteria\": \"No WebSocket commands can be executed without test mode enabled\"\n    },\n    {\n      \"id\": \"TC-SEC-002\",\n      \"category\": \"security\",\n      \"priority\": \"critical\",\n      \"description\": \"WebSocket server only binds to localhost\",\n      \"preconditions\": [\n        \"Game loaded with test mode enabled\",\n        \"Test client attempts connection from external IP\"\n      ],\n      \"steps\": [\n        \"Start game with ?testMode=true\",\n        \"From different machine on network, attempt WebSocket connection\",\n        \"Verify connection fails\"\n      ],\n      \"expectedOutcome\": {\n        \"connection\": \"Connection refused (server not listening on external interface)\",\n        \"console\": \"No errors in game console (connection never reaches server)\",\n        \"timing\": \"Connection timeout or immediate refusal\"\n      },\n      \"evidenceToCapture\": [\n        \"network_config_showing_localhost_binding.txt\",\n        \"external_connection_attempt_failure.txt\"\n      ],\n      \"successCriteria\": \"Server only accepts connections from 127.0.0.1/localhost\"\n    },\n    {\n      \"id\": \"TC-CONN-001\",\n      \"category\": \"connectivity\",\n      \"priority\": \"high\",\n      \"description\": \"WebSocket server accepts connection in test mode\",\n      \"preconditions\": [\n        \"Game loaded with ?testMode=true\",\n        \"No existing WebSocket connections\"\n      ],\n      \"steps\": [\n        \"Load game with test mode enabled\",\n        \"Connect WebSocket client to ws://localhost:8765\",\n        \"Verify connection established\"\n      ],\n      \"expectedOutcome\": {\n        \"connection\": \"WebSocket connection established (readyState = 1)\",\n        \"console\": \"[TestingServer] Client connected\",\n        \"timing\": \"Connection established within 500ms\",\n        \"welcomeMessage\": {\n          \"type\": \"connected\",\n          \"message\": \"Testing interface ready\",\n          \"availableCommands\": [\"getShipState\", \"setThrottle\", \"dock\", \"undock\", \"fitItem\", \"unfitItem\", \"getInventory\", \"getSceneInfo\", \"setPosition\", \"addResource\", \"triggerCombat\"]\n        }\n      },\n      \"evidenceToCapture\": [\n        \"screenshot_test_mode_active.png\",\n        \"console_connection_established.txt\",\n        \"websocket_handshake_headers.txt\"\n      ],\n      \"successCriteria\": \"WebSocket connection successful and welcome message received\"\n    },\n    {\n      \"id\": \"TC-CONN-002\",\n      \"category\": \"connectivity\",\n      \"priority\": \"medium\",\n      \"description\": \"WebSocket handles reconnection after browser refresh\",\n      \"preconditions\": [\n        \"WebSocket connection established\",\n        \"Game running in test mode\"\n      ],\n      \"steps\": [\n        \"Establish WebSocket connection\",\n        \"Send getShipState command (verify it works)\",\n        \"Refresh browser (F5)\",\n        \"Reconnect WebSocket client\",\n        \"Send getShipState command again\"\n      ],\n      \"expectedOutcome\": {\n        \"beforeRefresh\": \"Command succeeds\",\n        \"afterRefresh\": \"New connection established successfully\",\n        \"secondCommand\": \"Command succeeds with fresh game state\",\n        \"console\": \"No connection errors or orphaned listeners\"\n      },\n      \"evidenceToCapture\": [\n        \"before_refresh_state.json\",\n        \"after_refresh_state.json\",\n        \"console_no_errors.txt\"\n      ],\n      \"successCriteria\": \"Reconnection works cleanly without orphaned resources\"\n    },\n    {\n      \"id\": \"TC-SHIP-001\",\n      \"category\": \"ship-control\",\n      \"priority\": \"high\",\n      \"description\": \"getShipState returns accurate ship information\",\n      \"preconditions\": [\n        \"Game loaded in space with default ship (Atron)\",\n        \"Ship stationary at starting position\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send command: {\\\"id\\\": \\\"test-1\\\", \\\"command\\\": \\\"getShipState\\\", \\\"params\\\": {}}\",\n        \"Parse response JSON\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": true,\n        \"data\": {\n          \"position\": {\"x\": 0, \"y\": 0, \"z\": 0},\n          \"velocity\": {\"x\": 0, \"y\": 0, \"z\": 0},\n          \"rotation\": {\"x\": 0, \"y\": 0, \"z\": 0, \"w\": 1},\n          \"throttle\": 0,\n          \"shipType\": \"Atron\",\n          \"hull\": 100,\n          \"capacitor\": 100,\n          \"fittedModules\": {\n            \"high1\": null,\n            \"high2\": null,\n            \"mid1\": null,\n            \"mid2\": null,\n            \"low1\": null,\n            \"low2\": null\n          },\n          \"isDocked\": false,\n          \"isWarping\": false\n        },\n        \"timing\": \"Response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"ship_state_response.json\",\n        \"screenshot_ship_in_space.png\"\n      ],\n      \"successCriteria\": \"All ship properties returned accurately match game state\"\n    },\n    {\n      \"id\": \"TC-SHIP-002\",\n      \"category\": \"ship-control\",\n      \"priority\": \"high\",\n      \"description\": \"setThrottle changes ship velocity\",\n      \"preconditions\": [\n        \"Ship stationary in space\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send getShipState (record initial velocity)\",\n        \"Send setThrottle command: {\\\"id\\\": \\\"test-2\\\", \\\"command\\\": \\\"setThrottle\\\", \\\"params\\\": {\\\"value\\\": 50}}\",\n        \"Wait 2 seconds\",\n        \"Send getShipState again (record new velocity)\",\n        \"Visually verify ship is moving forward\"\n      ],\n      \"expectedOutcome\": {\n        \"setThrottleResponse\": {\n          \"success\": true,\n          \"data\": {\"throttle\": 50}\n        },\n        \"initialVelocity\": {\"x\": 0, \"y\": 0, \"z\": 0},\n        \"finalVelocity\": \"velocity.z > 0 (ship moving forward)\",\n        \"visual\": \"Ship moving forward in game view\",\n        \"HUD\": \"Throttle indicator shows 50%\",\n        \"timing\": \"Command response within 50ms, velocity change observable within 2 seconds\"\n      },\n      \"evidenceToCapture\": [\n        \"before_throttle_state.json\",\n        \"after_throttle_state.json\",\n        \"screenshot_ship_moving.png\",\n        \"video_throttle_change.mp4\"\n      ],\n      \"successCriteria\": \"Throttle value changes and ship accelerates as expected\"\n    },\n    {\n      \"id\": \"TC-SHIP-003\",\n      \"category\": \"ship-control\",\n      \"priority\": \"high\",\n      \"description\": \"dock command initiates docking sequence\",\n      \"preconditions\": [\n        \"Ship within 5km of station\",\n        \"Ship not already docked\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Position ship near station (use setPosition if needed)\",\n        \"Send dock command: {\\\"id\\\": \\\"test-3\\\", \\\"command\\\": \\\"dock\\\", \\\"params\\\": {}}\",\n        \"Wait for docking animation to complete\",\n        \"Send getShipState to verify docked status\"\n      ],\n      \"expectedOutcome\": {\n        \"dockResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"status\": \"docking\",\n            \"targetStation\": \"Station Name\",\n            \"estimatedTime\": \"3000ms\"\n          }\n        },\n        \"visual\": \"Docking animation plays\",\n        \"finalState\": {\n          \"isDocked\": true,\n          \"dockedAt\": \"Station Name\"\n        },\n        \"UI\": \"Station UI appears after docking\",\n        \"timing\": \"Docking completes within 5 seconds\"\n      },\n      \"evidenceToCapture\": [\n        \"dock_command_response.json\",\n        \"screenshot_docking_animation.png\",\n        \"screenshot_station_ui.png\",\n        \"final_ship_state_docked.json\"\n      ],\n      \"successCriteria\": \"Ship successfully docks and isDocked flag becomes true\"\n    },\n    {\n      \"id\": \"TC-SHIP-004\",\n      \"category\": \"ship-control\",\n      \"priority\": \"high\",\n      \"description\": \"undock command launches ship from station\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Verify ship is docked (getShipState)\",\n        \"Send undock command: {\\\"id\\\": \\\"test-4\\\", \\\"command\\\": \\\"undock\\\", \\\"params\\\": {}}\",\n        \"Wait for undocking animation\",\n        \"Send getShipState to verify undocked status\"\n      ],\n      \"expectedOutcome\": {\n        \"undockResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"status\": \"undocking\",\n            \"estimatedTime\": \"2000ms\"\n          }\n        },\n        \"visual\": \"Undocking animation plays, ship appears in space\",\n        \"finalState\": {\n          \"isDocked\": false,\n          \"position\": \"Near station exit point\"\n        },\n        \"UI\": \"Station UI closes, HUD returns\",\n        \"timing\": \"Undocking completes within 3 seconds\"\n      },\n      \"evidenceToCapture\": [\n        \"undock_command_response.json\",\n        \"screenshot_undocking_animation.png\",\n        \"screenshot_ship_in_space_after_undock.png\",\n        \"final_ship_state_undocked.json\"\n      ],\n      \"successCriteria\": \"Ship successfully undocks and returns to space view\"\n    },\n    {\n      \"id\": \"TC-INV-001\",\n      \"category\": \"inventory-fitting\",\n      \"priority\": \"high\",\n      \"description\": \"getInventory returns current cargo contents\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"Player has some items in inventory (at least 1 resource)\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Ensure inventory has known items (manually add some tritanium if needed)\",\n        \"Send getInventory command: {\\\"id\\\": \\\"test-5\\\", \\\"command\\\": \\\"getInventory\\\", \\\"params\\\": {}}\",\n        \"Compare response with actual inventory UI\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": true,\n        \"data\": {\n          \"cargoCapacity\": 100,\n          \"cargoUsed\": \">0\",\n          \"items\": [\n            {\n              \"id\": \"item-id\",\n              \"name\": \"Tritanium\",\n              \"quantity\": \">0\",\n              \"type\": \"resource\",\n              \"volume\": 0.01\n            }\n          ]\n        },\n        \"timing\": \"Response within 50ms\",\n        \"accuracy\": \"All items match inventory UI exactly\"\n      },\n      \"evidenceToCapture\": [\n        \"inventory_response.json\",\n        \"screenshot_inventory_ui.png\",\n        \"comparison_data_vs_ui.txt\"\n      ],\n      \"successCriteria\": \"Inventory data exactly matches what's shown in UI\"\n    },\n    {\n      \"id\": \"TC-INV-002\",\n      \"category\": \"inventory-fitting\",\n      \"priority\": \"high\",\n      \"description\": \"fitItem equips module to ship slot\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"Inventory contains at least one fittable module (e.g., Mining Laser I)\",\n        \"High slot 1 is empty\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send getInventory to find a fittable module's ID\",\n        \"Send fitItem command: {\\\"id\\\": \\\"test-6\\\", \\\"command\\\": \\\"fitItem\\\", \\\"params\\\": {\\\"itemId\\\": \\\"found-module-id\\\", \\\"slot\\\": \\\"high1\\\"}}\",\n        \"Send getShipState to verify module is fitted\",\n        \"Visually verify in ship fitting UI\"\n      ],\n      \"expectedOutcome\": {\n        \"fitItemResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"slot\": \"high1\",\n            \"item\": \"Mining Laser I\",\n            \"cpuUsed\": \"Updated CPU usage\",\n            \"powerUsed\": \"Updated power usage\"\n          }\n        },\n        \"shipState\": {\n          \"fittedModules\": {\n            \"high1\": {\"name\": \"Mining Laser I\", \"id\": \"module-id\"}\n          }\n        },\n        \"UI\": \"Ship fitting UI shows module in high slot 1\",\n        \"inventory\": \"Module removed from cargo (quantity decreased)\",\n        \"timing\": \"Command completes within 100ms\"\n      },\n      \"evidenceToCapture\": [\n        \"fit_item_response.json\",\n        \"screenshot_fitted_module_ui.png\",\n        \"ship_state_after_fitting.json\",\n        \"inventory_after_fitting.json\"\n      ],\n      \"successCriteria\": \"Module appears in slot, CPU/power updated, inventory decremented\"\n    },\n    {\n      \"id\": \"TC-INV-003\",\n      \"category\": \"inventory-fitting\",\n      \"priority\": \"high\",\n      \"description\": \"unfitItem removes module from ship slot\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"High slot 1 has a fitted module\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send getShipState to verify module is fitted in high1\",\n        \"Send unfitItem command: {\\\"id\\\": \\\"test-7\\\", \\\"command\\\": \\\"unfitItem\\\", \\\"params\\\": {\\\"slot\\\": \\\"high1\\\"}}\",\n        \"Send getShipState to verify slot is now empty\",\n        \"Send getInventory to verify module returned to cargo\",\n        \"Visually verify in ship fitting UI\"\n      ],\n      \"expectedOutcome\": {\n        \"unfitItemResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"slot\": \"high1\",\n            \"item\": \"Mining Laser I (returned to cargo)\",\n            \"cpuUsed\": \"Reduced CPU usage\",\n            \"powerUsed\": \"Reduced power usage\"\n          }\n        },\n        \"shipState\": {\n          \"fittedModules\": {\n            \"high1\": null\n          }\n        },\n        \"inventory\": \"Module quantity increased by 1\",\n        \"UI\": \"Slot appears empty in fitting UI\",\n        \"timing\": \"Command completes within 100ms\"\n      },\n      \"evidenceToCapture\": [\n        \"unfit_item_response.json\",\n        \"screenshot_empty_slot_ui.png\",\n        \"ship_state_after_unfitting.json\",\n        \"inventory_after_unfitting.json\"\n      ],\n      \"successCriteria\": \"Module removed from slot, CPU/power reduced, inventory incremented\"\n    },\n    {\n      \"id\": \"TC-STATE-001\",\n      \"category\": \"state-queries\",\n      \"priority\": \"medium\",\n      \"description\": \"getSceneInfo returns current game scene/state\",\n      \"preconditions\": [\n        \"Ship in space (not docked, not warping)\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send getSceneInfo command: {\\\"id\\\": \\\"test-8\\\", \\\"command\\\": \\\"getSceneInfo\\\", \\\"params\\\": {}}\",\n        \"Dock at station\",\n        \"Send getSceneInfo again\",\n        \"Undock\",\n        \"Send getSceneInfo again\"\n      ],\n      \"expectedOutcome\": {\n        \"inSpaceResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"scene\": \"space\",\n            \"isDocked\": false,\n            \"isWarping\": false,\n            \"nearbyObjects\": [\"Asteroid\", \"Station\"],\n            \"currentSystem\": \"System Name\"\n          }\n        },\n        \"dockedResponse\": {\n          \"scene\": \"station\",\n          \"isDocked\": true\n        },\n        \"undockedResponse\": {\n          \"scene\": \"space\",\n          \"isDocked\": false\n        },\n        \"timing\": \"Response within 50ms for each query\"\n      },\n      \"evidenceToCapture\": [\n        \"scene_info_in_space.json\",\n        \"scene_info_docked.json\",\n        \"scene_info_undocked.json\"\n      ],\n      \"successCriteria\": \"Scene info accurately reflects current game state\"\n    },\n    {\n      \"id\": \"TC-DEBUG-001\",\n      \"category\": \"debug-commands\",\n      \"priority\": \"medium\",\n      \"description\": \"setPosition teleports ship to coordinates\",\n      \"preconditions\": [\n        \"Ship in space\",\n        \"WebSocket connected\",\n        \"Test mode enabled\"\n      ],\n      \"steps\": [\n        \"Send getShipState (record initial position)\",\n        \"Send setPosition command: {\\\"id\\\": \\\"test-9\\\", \\\"command\\\": \\\"setPosition\\\", \\\"params\\\": {\\\"x\\\": 10000, \\\"y\\\": 5000, \\\"z\\\": 2000}}\",\n        \"Send getShipState (verify new position)\",\n        \"Visually verify ship moved\"\n      ],\n      \"expectedOutcome\": {\n        \"setPositionResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"position\": {\"x\": 10000, \"y\": 5000, \"z\": 2000}\n          }\n        },\n        \"initialPosition\": {\"x\": 0, \"y\": 0, \"z\": 0},\n        \"finalPosition\": {\"x\": 10000, \"y\": 5000, \"z\": 2000},\n        \"visual\": \"Ship teleported to new location (camera follows)\",\n        \"timing\": \"Instant teleport (no animation)\"\n      },\n      \"evidenceToCapture\": [\n        \"before_teleport_state.json\",\n        \"after_teleport_state.json\",\n        \"screenshot_new_position.png\"\n      ],\n      \"successCriteria\": \"Ship position changes instantly to specified coordinates\"\n    },\n    {\n      \"id\": \"TC-DEBUG-002\",\n      \"category\": \"debug-commands\",\n      \"priority\": \"medium\",\n      \"description\": \"addResource adds resources to inventory\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\",\n        \"Test mode enabled\"\n      ],\n      \"steps\": [\n        \"Send getInventory (record initial tritanium quantity)\",\n        \"Send addResource command: {\\\"id\\\": \\\"test-10\\\", \\\"command\\\": \\\"addResource\\\", \\\"params\\\": {\\\"resourceType\\\": \\\"tritanium\\\", \\\"amount\\\": 1000}}\",\n        \"Send getInventory (verify quantity increased)\",\n        \"Visually verify in inventory UI\"\n      ],\n      \"expectedOutcome\": {\n        \"addResourceResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"resourceType\": \"tritanium\",\n            \"amountAdded\": 1000,\n            \"newQuantity\": \"initialQuantity + 1000\"\n          }\n        },\n        \"inventoryChange\": \"Tritanium quantity increased by exactly 1000\",\n        \"UI\": \"Inventory UI shows updated quantity\",\n        \"cargoUsed\": \"Cargo used increases appropriately\",\n        \"timing\": \"Command completes within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"before_add_resource_inventory.json\",\n        \"after_add_resource_inventory.json\",\n        \"screenshot_inventory_increased.png\"\n      ],\n      \"successCriteria\": \"Resource quantity increases by specified amount\"\n    },\n    {\n      \"id\": \"TC-DEBUG-003\",\n      \"category\": \"debug-commands\",\n      \"priority\": \"low\",\n      \"description\": \"triggerCombat spawns enemy ship\",\n      \"preconditions\": [\n        \"Ship in space\",\n        \"No existing combat\",\n        \"WebSocket connected\",\n        \"Test mode enabled\"\n      ],\n      \"steps\": [\n        \"Send getSceneInfo (verify no nearby enemies)\",\n        \"Send triggerCombat command: {\\\"id\\\": \\\"test-11\\\", \\\"command\\\": \\\"triggerCombat\\\", \\\"params\\\": {\\\"enemyType\\\": \\\"pirate_frigate\\\"}}\",\n        \"Send getSceneInfo (verify enemy spawned)\",\n        \"Visually verify enemy ship appears\"\n      ],\n      \"expectedOutcome\": {\n        \"triggerCombatResponse\": {\n          \"success\": true,\n          \"data\": {\n            \"enemyType\": \"pirate_frigate\",\n            \"enemyId\": \"generated-id\",\n            \"position\": \"Near player ship\",\n            \"status\": \"hostile\"\n          }\n        },\n        \"sceneInfo\": {\n          \"nearbyObjects\": [\"includes enemy ship\"]\n        },\n        \"visual\": \"Red enemy ship appears in space\",\n        \"combat\": \"Combat state becomes active\",\n        \"timing\": \"Enemy spawns within 500ms\"\n      },\n      \"evidenceToCapture\": [\n        \"trigger_combat_response.json\",\n        \"screenshot_enemy_spawned.png\",\n        \"scene_info_with_enemy.json\"\n      ],\n      \"successCriteria\": \"Enemy ship spawns and is visible/targetable\"\n    },\n    {\n      \"id\": \"TC-ERR-001\",\n      \"category\": \"error-handling\",\n      \"priority\": \"high\",\n      \"description\": \"Invalid command returns descriptive error\",\n      \"preconditions\": [\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send invalid command: {\\\"id\\\": \\\"test-12\\\", \\\"command\\\": \\\"invalidCommand\\\", \\\"params\\\": {}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"INVALID_COMMAND\",\n          \"message\": \"Command 'invalidCommand' is not recognized\",\n          \"availableCommands\": [\"getShipState\", \"setThrottle\", \"...\"]\n        },\n        \"timing\": \"Error response within 50ms\",\n        \"console\": \"No JavaScript errors thrown\"\n      },\n      \"evidenceToCapture\": [\n        \"invalid_command_error_response.json\",\n        \"console_no_errors.txt\"\n      ],\n      \"successCriteria\": \"Clear error message with available commands list\"\n    },\n    {\n      \"id\": \"TC-ERR-002\",\n      \"category\": \"error-handling\",\n      \"priority\": \"high\",\n      \"description\": \"Missing required parameters returns error\",\n      \"preconditions\": [\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send setThrottle without value parameter: {\\\"id\\\": \\\"test-13\\\", \\\"command\\\": \\\"setThrottle\\\", \\\"params\\\": {}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"MISSING_PARAMETER\",\n          \"message\": \"Required parameter 'value' is missing\",\n          \"requiredParams\": [\"value\"],\n          \"receivedParams\": {}\n        },\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"missing_parameter_error.json\"\n      ],\n      \"successCriteria\": \"Error clearly states which parameter is missing\"\n    },\n    {\n      \"id\": \"TC-ERR-003\",\n      \"category\": \"error-handling\",\n      \"priority\": \"high\",\n      \"description\": \"Invalid parameter values return error\",\n      \"preconditions\": [\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send setThrottle with invalid value: {\\\"id\\\": \\\"test-14\\\", \\\"command\\\": \\\"setThrottle\\\", \\\"params\\\": {\\\"value\\\": 150}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"INVALID_PARAMETER_VALUE\",\n          \"message\": \"Parameter 'value' must be between 0 and 100\",\n          \"parameterName\": \"value\",\n          \"receivedValue\": 150,\n          \"validRange\": \"0-100\"\n        },\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"invalid_parameter_value_error.json\"\n      ],\n      \"successCriteria\": \"Error explains valid range for parameter\"\n    },\n    {\n      \"id\": \"TC-ERR-004\",\n      \"category\": \"error-handling\",\n      \"priority\": \"medium\",\n      \"description\": \"fitItem with invalid item ID returns error\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send fitItem with non-existent item ID: {\\\"id\\\": \\\"test-15\\\", \\\"command\\\": \\\"fitItem\\\", \\\"params\\\": {\\\"itemId\\\": \\\"invalid-id-12345\\\", \\\"slot\\\": \\\"high1\\\"}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"ITEM_NOT_FOUND\",\n          \"message\": \"Item with ID 'invalid-id-12345' not found in inventory\",\n          \"itemId\": \"invalid-id-12345\"\n        },\n        \"gameState\": \"No changes to ship fitting or inventory\",\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"item_not_found_error.json\",\n        \"ship_state_unchanged.json\"\n      ],\n      \"successCriteria\": \"Error prevents invalid fitting, state unchanged\"\n    },\n    {\n      \"id\": \"TC-ERR-005\",\n      \"category\": \"error-handling\",\n      \"priority\": \"medium\",\n      \"description\": \"fitItem with invalid slot returns error\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send getInventory to find valid module ID\",\n        \"Send fitItem with invalid slot: {\\\"id\\\": \\\"test-16\\\", \\\"command\\\": \\\"fitItem\\\", \\\"params\\\": {\\\"itemId\\\": \\\"valid-module-id\\\", \\\"slot\\\": \\\"invalid_slot\\\"}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"INVALID_SLOT\",\n          \"message\": \"Slot 'invalid_slot' is not valid for this ship\",\n          \"validSlots\": [\"high1\", \"high2\", \"mid1\", \"mid2\", \"low1\", \"low2\"]\n        },\n        \"gameState\": \"No changes to ship fitting or inventory\",\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"invalid_slot_error.json\"\n      ],\n      \"successCriteria\": \"Error lists valid slots for ship\"\n    },\n    {\n      \"id\": \"TC-ERR-006\",\n      \"category\": \"error-handling\",\n      \"priority\": \"medium\",\n      \"description\": \"dock command fails when too far from station\",\n      \"preconditions\": [\n        \"Ship in space, >10km from station\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Use setPosition to move ship 20km from station\",\n        \"Send dock command: {\\\"id\\\": \\\"test-17\\\", \\\"command\\\": \\\"dock\\\", \\\"params\\\": {}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"OUT_OF_RANGE\",\n          \"message\": \"Must be within 5km of station to dock\",\n          \"currentDistance\": \"~20000m\",\n          \"requiredDistance\": \"5000m\",\n          \"nearestStation\": \"Station Name\"\n        },\n        \"gameState\": \"Ship remains in space (not docked)\",\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"out_of_range_error.json\",\n        \"screenshot_ship_far_from_station.png\"\n      ],\n      \"successCriteria\": \"Docking prevented when out of range\"\n    },\n    {\n      \"id\": \"TC-ERR-007\",\n      \"category\": \"error-handling\",\n      \"priority\": \"medium\",\n      \"description\": \"undock command fails when not docked\",\n      \"preconditions\": [\n        \"Ship in space (not docked)\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Verify ship is not docked (getShipState)\",\n        \"Send undock command: {\\\"id\\\": \\\"test-18\\\", \\\"command\\\": \\\"undock\\\", \\\"params\\\": {}}\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"NOT_DOCKED\",\n          \"message\": \"Ship is not currently docked at a station\",\n          \"currentState\": \"in_space\"\n        },\n        \"gameState\": \"No state change\",\n        \"timing\": \"Error response within 50ms\"\n      },\n      \"evidenceToCapture\": [\n        \"not_docked_error.json\"\n      ],\n      \"successCriteria\": \"Undocking prevented when already in space\"\n    },\n    {\n      \"id\": \"TC-ERR-008\",\n      \"category\": \"error-handling\",\n      \"priority\": \"low\",\n      \"description\": \"Malformed JSON returns error\",\n      \"preconditions\": [\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send malformed JSON: {invalid json here\"\n      ],\n      \"expectedOutcome\": {\n        \"success\": false,\n        \"error\": {\n          \"code\": \"MALFORMED_JSON\",\n          \"message\": \"Request is not valid JSON\",\n          \"details\": \"Parsing error details\"\n        },\n        \"timing\": \"Error response within 50ms\",\n        \"console\": \"Error logged but not thrown\"\n      },\n      \"evidenceToCapture\": [\n        \"malformed_json_error.json\",\n        \"console_error_log.txt\"\n      ],\n      \"successCriteria\": \"Server handles malformed JSON gracefully\"\n    },\n    {\n      \"id\": \"TC-INT-001\",\n      \"category\": \"integration\",\n      \"priority\": \"critical\",\n      \"description\": \"Regression test: Ship fitting persists after undocking\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\",\n        \"This tests the bug that originally motivated this feature\"\n      ],\n      \"steps\": [\n        \"Send getInventory to find a module\",\n        \"Send fitItem to fit module to high1\",\n        \"Send getShipState to verify module fitted\",\n        \"Send undock command\",\n        \"Wait for undocking to complete\",\n        \"Send getShipState to verify module still fitted\",\n        \"Visually verify module visible on ship in space\"\n      ],\n      \"expectedOutcome\": {\n        \"beforeUndock\": {\n          \"fittedModules\": {\"high1\": {\"name\": \"Module Name\"}}\n        },\n        \"afterUndock\": {\n          \"fittedModules\": {\"high1\": {\"name\": \"Module Name\"}},\n          \"isDocked\": false\n        },\n        \"visual\": \"Fitted module visible on ship in space view\",\n        \"functionality\": \"Module functions correctly (e.g., mining laser activates)\"\n      },\n      \"evidenceToCapture\": [\n        \"fitted_modules_before_undock.json\",\n        \"fitted_modules_after_undock.json\",\n        \"screenshot_module_in_space.png\",\n        \"video_module_functionality.mp4\"\n      ],\n      \"successCriteria\": \"Ship fitting persists correctly through undocking (regression prevented)\"\n    },\n    {\n      \"id\": \"TC-INT-002\",\n      \"category\": \"integration\",\n      \"priority\": \"high\",\n      \"description\": \"Full workflow: Mine → Dock → Fit → Undock → Mine\",\n      \"preconditions\": [\n        \"Ship in space near asteroid field\",\n        \"No mining laser fitted\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send setThrottle to approach asteroid\",\n        \"Attempt mining (should fail - no laser)\",\n        \"Dock at station\",\n        \"Fit mining laser\",\n        \"Undock\",\n        \"Approach asteroid again\",\n        \"Activate mining laser (should work)\",\n        \"Verify resources collected\"\n      ],\n      \"expectedOutcome\": {\n        \"beforeFitting\": \"Mining fails (no laser equipped)\",\n        \"afterFitting\": \"Mining succeeds, resources added to cargo\",\n        \"integrity\": \"All state transitions work smoothly\",\n        \"noErrors\": \"No console errors throughout workflow\"\n      },\n      \"evidenceToCapture\": [\n        \"workflow_step_1_no_laser.json\",\n        \"workflow_step_2_docked.json\",\n        \"workflow_step_3_fitted.json\",\n        \"workflow_step_4_undocked.json\",\n        \"workflow_step_5_mining.json\",\n        \"screenshot_resources_collected.png\"\n      ],\n      \"successCriteria\": \"Complete workflow executes without errors\"\n    },\n    {\n      \"id\": \"TC-INT-003\",\n      \"category\": \"integration\",\n      \"priority\": \"medium\",\n      \"description\": \"Multiple rapid commands handled correctly\",\n      \"preconditions\": [\n        \"Ship docked at station\",\n        \"WebSocket connected\"\n      ],\n      \"steps\": [\n        \"Send 10 getShipState commands in rapid succession (no waiting)\",\n        \"Send 5 getInventory commands in rapid succession\",\n        \"Verify all commands receive responses\",\n        \"Verify responses are correctly matched to request IDs\"\n      ],\n      \"expectedOutcome\": {\n        \"responses\": \"15 total responses received\",\n        \"matching\": \"Each response.id matches corresponding request.id\",\n        \"order\": \"Responses may arrive out of order, but all arrive\",\n        \"timing\": \"All responses within 500ms total\",\n        \"noErrors\": \"No dropped commands, no errors\"\n      },\n      \"evidenceToCapture\": [\n        \"rapid_commands_requests.json\",\n        \"rapid_commands_responses.json\",\n        \"timing_analysis.txt\"\n      ],\n      \"successCriteria\": \"All commands processed, responses correctly matched\"\n    },\n    {\n      \"id\": \"TC-PERF-001\",\n      \"category\": \"performance\",\n      \"priority\": \"medium\",\n      \"description\": \"Command response latency under 100ms\",\n      \"preconditions\": [\n        \"WebSocket connected\",\n        \"Game running at stable FPS\"\n      ],\n      \"steps\": [\n        \"Send 100 getShipState commands sequentially\",\n        \"Measure round-trip time for each (send → receive response)\",\n        \"Calculate average, min, max, and 95th percentile latency\"\n      ],\n      \"expectedOutcome\": {\n        \"averageLatency\": \"<50ms\",\n        \"maxLatency\": \"<100ms\",\n        \"95thPercentile\": \"<75ms\",\n        \"consistency\": \"No sudden spikes >200ms\"\n      },\n      \"evidenceToCapture\": [\n        \"latency_measurements.csv\",\n        \"latency_histogram.png\",\n        \"performance_summary.txt\"\n      ],\n      \"successCriteria\": \"95% of commands respond within 75ms\"\n    },\n    {\n      \"id\": \"TC-PERF-002\",\n      \"category\": \"performance\",\n      \"priority\": \"low\",\n      \"description\": \"WebSocket server has minimal impact on game FPS\",\n      \"preconditions\": [\n        \"Game running at 60 FPS\",\n        \"WebSocket not connected\"\n      ],\n      \"steps\": [\n        \"Measure baseline FPS for 30 seconds (no WebSocket)\",\n        \"Connect WebSocket\",\n        \"Send getShipState every 100ms for 30 seconds\",\n        \"Measure FPS during command stream\",\n        \"Calculate FPS drop\"\n      ],\n      \"expectedOutcome\": {\n        \"baselineFPS\": \"~60 FPS\",\n        \"activeFPS\": \">55 FPS\",\n        \"fpsDrop\": \"<5 FPS\",\n        \"noStuttering\": \"No visible frame drops or stuttering\"\n      },\n      \"evidenceToCapture\": [\n        \"baseline_fps_graph.png\",\n        \"active_fps_graph.png\",\n        \"fps_comparison.txt\"\n      ],\n      \"successCriteria\": \"WebSocket activity causes <5 FPS drop\"\n    }\n  ],\n  \"automatedTestScript\": {\n    \"path\": \"/mnt/c/github/superstarships/tests/websocket_integration_test.py\",\n    \"description\": \"Python script to execute all test cases\",\n    \"dependencies\": [\"websocket-client library\", \"pytest framework\"],\n    \"usage\": \"pytest tests/websocket_integration_test.py -v\"\n  },\n  \"manualTestChecklist\": [\n    \"[ ] TC-SEC-001: Test mode enforcement verified\",\n    \"[ ] TC-SEC-002: Localhost-only binding verified\",\n    \"[ ] TC-CONN-001: Connection established successfully\",\n    \"[ ] TC-CONN-002: Reconnection after refresh works\",\n    \"[ ] TC-SHIP-001: getShipState returns accurate data\",\n    \"[ ] TC-SHIP-002: setThrottle changes velocity\",\n    \"[ ] TC-SHIP-003: dock initiates docking\",\n    \"[ ] TC-SHIP-004: undock launches ship\",\n    \"[ ] TC-INV-001: getInventory returns cargo contents\",\n    \"[ ] TC-INV-002: fitItem equips module\",\n    \"[ ] TC-INV-003: unfitItem removes module\",\n    \"[ ] TC-STATE-001: getSceneInfo reflects state\",\n    \"[ ] TC-DEBUG-001: setPosition teleports ship\",\n    \"[ ] TC-DEBUG-002: addResource increases inventory\",\n    \"[ ] TC-DEBUG-003: triggerCombat spawns enemy\",\n    \"[ ] TC-ERR-001: Invalid command error\",\n    \"[ ] TC-ERR-002: Missing parameter error\",\n    \"[ ] TC-ERR-003: Invalid parameter value error\",\n    \"[ ] TC-ERR-004: Item not found error\",\n    \"[ ] TC-ERR-005: Invalid slot error\",\n    \"[ ] TC-ERR-006: Out of range dock error\",\n    \"[ ] TC-ERR-007: Not docked undock error\",\n    \"[ ] TC-ERR-008: Malformed JSON error\",\n    \"[ ] TC-INT-001: Ship fitting persists after undock (REGRESSION TEST)\",\n    \"[ ] TC-INT-002: Full mine→dock→fit→undock→mine workflow\",\n    \"[ ] TC-INT-003: Multiple rapid commands handled\",\n    \"[ ] TC-PERF-001: Command latency <100ms\",\n    \"[ ] TC-PERF-002: FPS impact <5 FPS\",\n    \"[ ] Visual inspection: UI reflects command changes\",\n    \"[ ] Console: No errors during testing\",\n    \"[ ] Network tab: WebSocket traffic looks correct\",\n    \"[ ] Documentation: All commands documented with examples\"\n  ],\n  \"evidenceRepository\": {\n    \"location\": \"/mnt/c/github/superstarships/tests/evidence/\",\n    \"structure\": {\n      \"screenshots\": \"screenshots/TC-XXX-YYY_description.png\",\n      \"videos\": \"videos/TC-XXX-YYY_description.mp4\",\n      \"jsonResponses\": \"responses/TC-XXX-YYY_response.json\",\n      \"consoleLogs\": \"logs/TC-XXX-YYY_console.txt\",\n      \"performanceData\": \"performance/TC-PERF-XXX_data.csv\"\n    }\n  },\n  \"testExecutionOrder\": {\n    \"phase1_security\": [\"TC-SEC-001\", \"TC-SEC-002\"],\n    \"phase2_connectivity\": [\"TC-CONN-001\", \"TC-CONN-002\"],\n    \"phase3_basic_commands\": [\"TC-SHIP-001\", \"TC-INV-001\", \"TC-STATE-001\"],\n    \"phase4_ship_control\": [\"TC-SHIP-002\", \"TC-SHIP-003\", \"TC-SHIP-004\"],\n    \"phase5_inventory_fitting\": [\"TC-INV-002\", \"TC-INV-003\"],\n    \"phase6_debug_commands\": [\"TC-DEBUG-001\", \"TC-DEBUG-002\", \"TC-DEBUG-003\"],\n    \"phase7_error_handling\": [\"TC-ERR-001\", \"TC-ERR-002\", \"TC-ERR-003\", \"TC-ERR-004\", \"TC-ERR-005\", \"TC-ERR-006\", \"TC-ERR-007\", \"TC-ERR-008\"],\n    \"phase8_integration\": [\"TC-INT-001\", \"TC-INT-002\", \"TC-INT-003\"],\n    \"phase9_performance\": [\"TC-PERF-001\", \"TC-PERF-002\"]\n  },\n  \"successMetrics\": {\n    \"critical\": \"All security, connectivity, and regression tests must pass\",\n    \"high\": \"All ship control and inventory commands must work correctly\",\n    \"medium\": \"Error handling must be clear and helpful\",\n    \"low\": \"Performance impact must be minimal (<5 FPS drop)\",\n    \"overall\": \"100% of critical/high priority tests pass, 90% of all tests pass\"\n  },\n  \"testDataRequirements\": {\n    \"knownGoodState\": \"Fresh game load with default Atron ship\",\n    \"testResources\": \"Inventory with at least 1000 tritanium for testing\",\n    \"testModules\": \"Mining Laser I, Cargo Expander I in inventory\",\n    \"testEnvironment\": \"Ship spawned near station and asteroid field\",\n    \"testMode\": \"Enabled via ?testMode=true URL parameter\"\n  },\n  \"riskAssessment\": {\n    \"high\": [\n      \"Security: Test mode accidentally enabled in production\",\n      \"Integration: Commands break existing game state management\",\n      \"Regression: Ship fitting persistence issue reintroduced\"\n    ],\n    \"medium\": [\n      \"Performance: WebSocket polling degrades FPS\",\n      \"Error handling: Poor errors confuse test developers\",\n      \"State corruption: Commands leave game in invalid state\"\n    ],\n    \"low\": [\n      \"Documentation: Commands not well documented\",\n      \"Latency: Slow response times for queries\"\n    ]\n  }\n}\n```\n\n## Test Plan Summary\n\nThis comprehensive test plan defines **32 test cases** across **9 categories** BEFORE any implementation begins. Key highlights:\n\n### Critical Pre-Implementation Expectations\n\n1. **Security (TC-SEC-001, TC-SEC-002)**: \n   - Test mode MUST be enforced - no commands work without it\n   - Server MUST only bind to localhost (127.0.0.1)\n\n2. **Regression Prevention (TC-INT-001)**:\n   - Ship fitting MUST persist after undocking\n   - This directly addresses the bug that motivated this feature\n\n3. **Command Accuracy (TC-SHIP-001 - TC-INV-003)**:\n   - All state queries return exact JSON matching game state\n   - All commands successfully modify state as specified\n   - Visual UI reflects command changes immediately\n\n4. **Error Handling (TC-ERR-001 - TC-ERR-008)**:\n   - Every error includes: code, message, helpful details\n   - Invalid commands don't crash or corrupt state\n   - Errors suggest valid alternatives\n\n5. **Performance (TC-PERF-001, TC-PERF-002)**:\n   - Command latency <100ms (95th percentile <75ms)\n   - FPS impact <5 FPS during active command streaming\n\n### Test Execution Strategy\n\n- **Phase 1-2**: Security and connectivity (must pass to proceed)\n- **Phase 3-6**: Core functionality (commands work correctly)\n- **Phase 7**: Error handling (graceful failure)\n- **Phase 8**: Integration (realistic workflows)\n- **Phase 9**: Performance (acceptable overhead)\n\n### Evidence Requirements\n\nEach test case specifies:\n- **Screenshots**: Visual proof of state changes\n- **JSON responses**: Exact command outputs\n- **Console logs**: No errors during execution\n- **Performance data**: Latency/FPS measurements\n\n### Success Criteria\n\n- **100% of critical/high priority tests** (20 tests) must pass\n- **90% of all tests** (29/32 tests) must pass\n- **No regressions** in existing functionality\n- **Documentation complete** with all command examples\n\nThis test plan establishes **objective, measurable expectations** that will be used to validate the implementation without confirmation bias.\n\nDECISION: test_plan_ready",
      "completedStagesCount": 2,
      "totalExecutions": 2
    },
    {
      "timestamp": "2025-11-16T20:12:48.272Z",
      "eventType": "stage_routed",
      "fromStage": "plan_tests",
      "toStage": "plan_implementation",
      "decision": "TEST_PLAN_READY",
      "reasoning": "Decision \"TEST_PLAN_READY\" matched connection condition"
    },
    {
      "timestamp": "2025-11-16T20:12:48.309Z",
      "eventType": "stage_started",
      "executionNumber": 3,
      "stageId": "plan_implementation",
      "stageName": "Implementation Planning",
      "agent": "implementation_planner",
      "stageType": "planner",
      "description": "Design technical approach and implementation strategy",
      "inputs": [
        "define_feature",
        "plan_tests"
      ]
    },
    {
      "timestamp": "2025-11-16T20:16:08.478Z",
      "eventType": "stage_completed",
      "executionNumber": 3,
      "stageId": "plan_implementation",
      "stageName": "Implementation Planning",
      "agent": "implementation_planner",
      "outputLength": 38316,
      "output": "## WebSocket Testing Server - Complete Implementation Plan\n\n### Executive Summary\n\nThis implementation plan details how to build a **WebSocket-based automation testing infrastructure** for the game. The system consists of a lightweight Node.js WebSocket server that connects to the browser-based game via a testing interface bridge. The server accepts JSON commands to control game state and query information, enabling automated integration tests to catch bugs like the recent ship fitting persistence issue.\n\n**Key Architecture Decision**: Use a **hybrid approach** with a Node.js WebSocket server that communicates with the browser game through a JavaScript testing interface. This avoids CORS/security issues while maintaining clean separation of concerns.\n\n---\n\n## Implementation Plan JSON\n\n```json\n{\n  \"architecture\": {\n    \"overallApproach\": \"Hybrid Node.js + Browser Bridge Architecture\",\n    \"rationale\": \"Browser-only WebSocket server has limitations (no true server mode). Node.js server with browser bridge provides clean API, avoids CORS issues, and enables robust test automation.\",\n    \"newClasses\": [\n      {\n        \"name\": \"TestModeManager\",\n        \"file\": \"/mnt/c/github/superstarships/js/debug/TestModeManager.js\",\n        \"responsibility\": \"Manages test mode flag, validates test mode is enabled, provides security gate for testing features\",\n        \"methods\": [\n          \"isTestModeEnabled()\",\n          \"enableTestMode()\",\n          \"disableTestMode()\",\n          \"requireTestMode()\",\n          \"getTestModeSource()\"\n        ],\n        \"properties\": [\n          \"testModeEnabled (boolean)\",\n          \"testModeSource (string: 'url' | 'localStorage' | 'manual')\",\n          \"testModeEnabledAt (timestamp)\"\n        ],\n        \"integration\": \"Initialized early in SpaceshipSimulator constructor, checked by GameTestingInterface before executing commands\"\n      },\n      {\n        \"name\": \"GameTestingInterface\",\n        \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n        \"responsibility\": \"Provides command handlers that interact with game systems, acts as bridge between WebSocket messages and simulator methods\",\n        \"methods\": [\n          \"constructor(simulator)\",\n          \"handleCommand(commandObj)\",\n          \"getShipState()\",\n          \"setThrottle(value)\",\n          \"dock()\",\n          \"undock()\",\n          \"fitItem(itemId, slot)\",\n          \"unfitItem(slot)\",\n          \"getInventory()\",\n          \"getSceneInfo()\",\n          \"setPosition(x, y, z)\",\n          \"addResource(resourceType, amount)\",\n          \"triggerCombat(enemyType)\",\n          \"resetGameState()\",\n          \"validateCommand(command, params)\"\n        ],\n        \"properties\": [\n          \"simulator (reference to SpaceshipSimulator)\",\n          \"commandHandlers (Map of command name -> handler function)\",\n          \"commandSchemas (validation schemas for each command)\"\n        ],\n        \"integration\": \"Created by SpaceshipSimulator when test mode is enabled, exposed via window.gameTestingInterface\"\n      },\n      {\n        \"name\": \"TestingWebSocketServer (Node.js)\",\n        \"file\": \"/mnt/c/github/superstarships/server/TestingWebSocketServer.js\",\n        \"responsibility\": \"WebSocket server that accepts test client connections, routes commands to browser via custom protocol\",\n        \"methods\": [\n          \"start(port)\",\n          \"stop()\",\n          \"handleConnection(ws)\",\n          \"handleMessage(ws, message)\",\n          \"sendCommand(command)\",\n          \"broadcastToClients(message)\",\n          \"validateClient(ws)\"\n        ],\n        \"properties\": [\n          \"wss (WebSocket.Server instance)\",\n          \"port (default 8765)\",\n          \"clients (Set of connected WebSocket clients)\",\n          \"pendingCommands (Map of request ID -> response callback)\"\n        ],\n        \"integration\": \"Standalone Node.js server started separately, communicates with browser via window.postMessage or custom WebSocket client in browser\"\n      },\n      {\n        \"name\": \"TestingBrowserBridge\",\n        \"file\": \"/mnt/c/github/superstarships/js/testing/TestingBrowserBridge.js\",\n        \"responsibility\": \"Browser-side WebSocket client that connects to Node.js server, forwards commands to GameTestingInterface\",\n        \"methods\": [\n          \"connect(serverUrl)\",\n          \"disconnect()\",\n          \"handleServerMessage(message)\",\n          \"sendResponse(id, response)\",\n          \"handleCommand(commandObj)\"\n        ],\n        \"properties\": [\n          \"ws (WebSocket connection to Node.js server)\",\n          \"gameInterface (reference to GameTestingInterface)\",\n          \"isConnected (boolean)\"\n        ],\n        \"integration\": \"Initialized by SpaceshipSimulator when test mode is enabled, connects to ws://localhost:8765\"\n      }\n    ],\n    \"modifiedClasses\": [\n      {\n        \"name\": \"SpaceshipSimulator\",\n        \"file\": \"/mnt/c/github/superstarships/js/SpaceshipSimulator.js\",\n        \"changes\": [\n          \"Add testModeManager property\",\n          \"Add gameTestingInterface property\",\n          \"Add testingBrowserBridge property\",\n          \"Initialize test mode manager in constructor\",\n          \"Check test mode and initialize testing systems if enabled\",\n          \"Add initializeTestingSystems() method\",\n          \"Expose global window.simulator reference (already exists)\"\n        ],\n        \"integrationPoint\": \"In constructor after core systems initialization\"\n      },\n      {\n        \"name\": \"index.html\",\n        \"file\": \"/mnt/c/github/superstarships/index.html\",\n        \"changes\": [\n          \"Add conditional script loading for testing systems (only if ?testMode=true)\",\n          \"Add TestModeManager script tag\",\n          \"Add GameTestingInterface script tag\",\n          \"Add TestingBrowserBridge script tag\",\n          \"Add test mode indicator in UI (optional)\"\n        ],\n        \"integrationPoint\": \"In <head> section with other script imports\"\n      }\n    ],\n    \"patterns\": [\n      \"Command Pattern: Each command (getShipState, setThrottle, etc.) is a discrete handler function\",\n      \"Bridge Pattern: TestingBrowserBridge connects Node.js server to browser game\",\n      \"Singleton Pattern: TestModeManager is singleton, only one test mode state\",\n      \"Strategy Pattern: Different command handlers for different game operations\",\n      \"Observer Pattern: WebSocket server broadcasts responses to all connected test clients\"\n    ],\n    \"dataFlow\": [\n      \"1. Test script (Python/JS) sends JSON command to Node.js WebSocket server (ws://localhost:8765)\",\n      \"2. Node.js server receives command, sends to browser via WebSocket\",\n      \"3. TestingBrowserBridge in browser receives command\",\n      \"4. TestingBrowserBridge calls GameTestingInterface.handleCommand(commandObj)\",\n      \"5. GameTestingInterface validates command, calls appropriate handler (e.g., getShipState())\",\n      \"6. Handler interacts with simulator (e.g., simulator.playerShip.position)\",\n      \"7. Handler returns response data\",\n      \"8. GameTestingInterface wraps response in JSON-RPC format\",\n      \"9. TestingBrowserBridge sends response back to Node.js server via WebSocket\",\n      \"10. Node.js server forwards response to original test client\",\n      \"11. Test script parses JSON response and validates expected state\"\n    ],\n    \"securityModel\": {\n      \"testModeGate\": \"TestModeManager.requireTestMode() throws error if test mode not enabled\",\n      \"localhostBinding\": \"Node.js server binds only to 127.0.0.1\",\n      \"browserOriginCheck\": \"TestingBrowserBridge only connects to ws://localhost:8765\",\n      \"commandValidation\": \"GameTestingInterface validates all command parameters before execution\",\n      \"productionSafeguard\": \"Test mode scripts not loaded in production builds (check URL param or build flag)\"\n    }\n  },\n  \"fileStructure\": {\n    \"create\": [\n      \"/mnt/c/github/superstarships/js/debug/TestModeManager.js\",\n      \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"/mnt/c/github/superstarships/js/testing/TestingBrowserBridge.js\",\n      \"/mnt/c/github/superstarships/server/TestingWebSocketServer.js\",\n      \"/mnt/c/github/superstarships/server/package.json\",\n      \"/mnt/c/github/superstarships/tests/websocket_integration_test.py\",\n      \"/mnt/c/github/superstarships/tests/test_helpers.py\",\n      \"/mnt/c/github/superstarships/tests/example_test_script.js\",\n      \"/mnt/c/github/superstarships/docs/TESTING_WEBSOCKET_API.md\",\n      \"/mnt/c/github/superstarships/docs/TESTING_SETUP_GUIDE.md\"\n    ],\n    \"modify\": [\n      \"/mnt/c/github/superstarships/js/SpaceshipSimulator.js\",\n      \"/mnt/c/github/superstarships/index.html\"\n    ]\n  },\n  \"implementationSteps\": [\n    {\n      \"order\": 1,\n      \"task\": \"Create TestModeManager class with URL/localStorage detection\",\n      \"file\": \"/mnt/c/github/superstarships/js/debug/TestModeManager.js\",\n      \"estimatedTime\": \"45 minutes\",\n      \"dependencies\": [],\n      \"details\": [\n        \"Detect ?testMode=true URL parameter\",\n        \"Check localStorage['testMode'] flag\",\n        \"Provide isTestModeEnabled() method\",\n        \"Provide requireTestMode() method that throws if not enabled\",\n        \"Add console warnings when test mode is active\"\n      ],\n      \"testValidation\": \"TC-SEC-001, TC-SEC-002\"\n    },\n    {\n      \"order\": 2,\n      \"task\": \"Create GameTestingInterface with basic command structure\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1 hour\",\n      \"dependencies\": [1],\n      \"details\": [\n        \"Create constructor that accepts simulator reference\",\n        \"Create handleCommand(commandObj) router\",\n        \"Implement command validation (check required params)\",\n        \"Create response format helpers (success/error)\",\n        \"Add command handler registry (Map)\"\n      ],\n      \"testValidation\": \"TC-ERR-001, TC-ERR-002\"\n    },\n    {\n      \"order\": 3,\n      \"task\": \"Implement ship state query commands (getShipState, getSceneInfo)\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1.5 hours\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"getShipState(): Query simulator.playerShip.position, velocity, rotation, etc.\",\n        \"getShipState(): Query ship fitting (fittedModules from ShipFittingManager)\",\n        \"getShipState(): Include docked status from StationManager\",\n        \"getSceneInfo(): Query current scene (docked vs in space)\",\n        \"getSceneInfo(): List nearby objects (asteroids, stations, ships)\"\n      ],\n      \"testValidation\": \"TC-SHIP-001, TC-STATE-001\"\n    },\n    {\n      \"order\": 4,\n      \"task\": \"Implement ship control commands (setThrottle, dock, undock)\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"2 hours\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"setThrottle(value): Set simulator.playerShip.physics.thrustInput\",\n        \"setThrottle(value): Validate value is 0-100\",\n        \"dock(): Call simulator.stationManager.requestDock()\",\n        \"dock(): Validate ship is within range of station\",\n        \"undock(): Call simulator.stationManager.undock()\",\n        \"undock(): Validate ship is currently docked\"\n      ],\n      \"testValidation\": \"TC-SHIP-002, TC-SHIP-003, TC-SHIP-004, TC-ERR-006, TC-ERR-007\"\n    },\n    {\n      \"order\": 5,\n      \"task\": \"Implement inventory and fitting commands (getInventory, fitItem, unfitItem)\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"2.5 hours\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"getInventory(): Query resourceManager.inventory and shipFittingManager.playerInventory\",\n        \"getInventory(): Include cargo capacity, cargo used, item quantities\",\n        \"fitItem(itemId, slot): Call shipFittingManager.fitItem()\",\n        \"fitItem(): Validate item exists in inventory\",\n        \"fitItem(): Validate slot is valid for ship\",\n        \"fitItem(): Validate ship is docked (fitting requires docking)\",\n        \"unfitItem(slot): Call shipFittingManager.unfitItem()\",\n        \"unfitItem(): Validate slot has fitted item\"\n      ],\n      \"testValidation\": \"TC-INV-001, TC-INV-002, TC-INV-003, TC-ERR-004, TC-ERR-005, TC-INT-001\"\n    },\n    {\n      \"order\": 6,\n      \"task\": \"Implement debug/cheat commands (setPosition, addResource, triggerCombat)\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1.5 hours\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"setPosition(x, y, z): Teleport ship to coordinates\",\n        \"setPosition(): Update simulator.playerShip.physics.position\",\n        \"addResource(resourceType, amount): Add resources to inventory\",\n        \"addResource(): Call resourceManager.addResource()\",\n        \"triggerCombat(enemyType): Spawn enemy ship near player\",\n        \"triggerCombat(): Use existing AI ship spawning logic\",\n        \"All debug commands check TestModeManager.requireTestMode()\"\n      ],\n      \"testValidation\": \"TC-DEBUG-001, TC-DEBUG-002, TC-DEBUG-003\"\n    },\n    {\n      \"order\": 7,\n      \"task\": \"Add comprehensive error handling to all commands\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1 hour\",\n      \"dependencies\": [3, 4, 5, 6],\n      \"details\": [\n        \"Wrap all command handlers in try-catch\",\n        \"Return consistent error format: {success: false, error: {code, message, details}}\",\n        \"Define error codes: INVALID_COMMAND, MISSING_PARAMETER, INVALID_PARAMETER_VALUE, etc.\",\n        \"Add parameter validation for all commands\",\n        \"Include helpful error messages with valid ranges/options\"\n      ],\n      \"testValidation\": \"TC-ERR-001 through TC-ERR-008\"\n    },\n    {\n      \"order\": 8,\n      \"task\": \"Create TestingBrowserBridge WebSocket client\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/TestingBrowserBridge.js\",\n      \"estimatedTime\": \"1.5 hours\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"Create WebSocket connection to ws://localhost:8765\",\n        \"Handle connection, disconnection, errors\",\n        \"Parse incoming messages as JSON commands\",\n        \"Forward commands to GameTestingInterface.handleCommand()\",\n        \"Send responses back to server via WebSocket\",\n        \"Handle reconnection after browser refresh\"\n      ],\n      \"testValidation\": \"TC-CONN-001, TC-CONN-002\"\n    },\n    {\n      \"order\": 9,\n      \"task\": \"Create Node.js WebSocket server\",\n      \"file\": \"/mnt/c/github/superstarships/server/TestingWebSocketServer.js\",\n      \"estimatedTime\": \"2 hours\",\n      \"dependencies\": [],\n      \"details\": [\n        \"Create WebSocket server using 'ws' library\",\n        \"Bind to localhost:8765 only (security)\",\n        \"Accept client connections from test scripts\",\n        \"Route commands from test clients to browser (via second WebSocket)\",\n        \"Route responses from browser back to test clients\",\n        \"Implement request/response matching using message IDs\",\n        \"Add connection logging and error handling\"\n      ],\n      \"testValidation\": \"TC-CONN-001, TC-SEC-002\"\n    },\n    {\n      \"order\": 10,\n      \"task\": \"Create Node.js package.json and server startup script\",\n      \"file\": \"/mnt/c/github/superstarships/server/package.json\",\n      \"estimatedTime\": \"30 minutes\",\n      \"dependencies\": [9],\n      \"details\": [\n        \"Create package.json with 'ws' dependency\",\n        \"Add start script: node TestingWebSocketServer.js\",\n        \"Add README with server startup instructions\",\n        \"Add environment variable support for port configuration\"\n      ],\n      \"testValidation\": \"Manual testing\"\n    },\n    {\n      \"order\": 11,\n      \"task\": \"Integrate testing systems into SpaceshipSimulator\",\n      \"file\": \"/mnt/c/github/superstarships/js/SpaceshipSimulator.js\",\n      \"estimatedTime\": \"1 hour\",\n      \"dependencies\": [1, 2, 8],\n      \"details\": [\n        \"Add testModeManager initialization in constructor\",\n        \"Add initializeTestingSystems() method\",\n        \"Initialize GameTestingInterface if test mode enabled\",\n        \"Initialize TestingBrowserBridge if test mode enabled\",\n        \"Expose window.gameTestingInterface for debugging\",\n        \"Add console message when test mode is active\"\n      ],\n      \"testValidation\": \"TC-SEC-001\"\n    },\n    {\n      \"order\": 12,\n      \"task\": \"Add conditional script loading to index.html\",\n      \"file\": \"/mnt/c/github/superstarships/index.html\",\n      \"estimatedTime\": \"30 minutes\",\n      \"dependencies\": [1, 2, 8],\n      \"details\": [\n        \"Add script tags for TestModeManager, GameTestingInterface, TestingBrowserBridge\",\n        \"Place script tags after other game system imports\",\n        \"Add HTML comment explaining test mode activation\",\n        \"Optionally add visual indicator (corner badge) when test mode is active\"\n      ],\n      \"testValidation\": \"Manual testing\"\n    },\n    {\n      \"order\": 13,\n      \"task\": \"Create Python test helper library\",\n      \"file\": \"/mnt/c/github/superstarships/tests/test_helpers.py\",\n      \"estimatedTime\": \"1.5 hours\",\n      \"dependencies\": [9],\n      \"details\": [\n        \"Create GameTestClient class that wraps WebSocket connection\",\n        \"Add methods for each command (get_ship_state(), set_throttle(), etc.)\",\n        \"Add assertion helpers (assert_ship_position(), assert_inventory_has(), etc.)\",\n        \"Add timeout handling and error reporting\",\n        \"Add context manager support for connection lifecycle\"\n      ],\n      \"testValidation\": \"Used by integration tests\"\n    },\n    {\n      \"order\": 14,\n      \"task\": \"Create Python integration test suite\",\n      \"file\": \"/mnt/c/github/superstarships/tests/websocket_integration_test.py\",\n      \"estimatedTime\": \"3 hours\",\n      \"dependencies\": [13],\n      \"details\": [\n        \"Implement all test cases from test plan (TC-SHIP-001 through TC-INT-003)\",\n        \"Use pytest framework with fixtures for game connection\",\n        \"Implement test fixtures for known game state\",\n        \"Add screenshot capture for visual validation (optional)\",\n        \"Add test reporting and evidence collection\",\n        \"Add test execution summary\"\n      ],\n      \"testValidation\": \"Runs all 32 test cases from test plan\"\n    },\n    {\n      \"order\": 15,\n      \"task\": \"Create JavaScript example test script\",\n      \"file\": \"/mnt/c/github/superstarships/tests/example_test_script.js\",\n      \"estimatedTime\": \"45 minutes\",\n      \"dependencies\": [9],\n      \"details\": [\n        \"Create Node.js script using 'ws' library\",\n        \"Demonstrate connecting to testing server\",\n        \"Show examples of all command types\",\n        \"Add response parsing and validation\",\n        \"Add detailed comments explaining usage\"\n      ],\n      \"testValidation\": \"Manual testing\"\n    },\n    {\n      \"order\": 16,\n      \"task\": \"Create comprehensive API documentation\",\n      \"file\": \"/mnt/c/github/superstarships/docs/TESTING_WEBSOCKET_API.md\",\n      \"estimatedTime\": \"2 hours\",\n      \"dependencies\": [7],\n      \"details\": [\n        \"Document all available commands with parameters\",\n        \"Include request/response examples for each command\",\n        \"Document error codes and their meanings\",\n        \"Add command reference table\",\n        \"Include JSON schema definitions\",\n        \"Add troubleshooting section\"\n      ],\n      \"testValidation\": \"Manual review\"\n    },\n    {\n      \"order\": 17,\n      \"task\": \"Create setup and usage guide\",\n      \"file\": \"/mnt/c/github/superstarships/docs/TESTING_SETUP_GUIDE.md\",\n      \"estimatedTime\": \"1.5 hours\",\n      \"dependencies\": [10, 13, 15],\n      \"details\": [\n        \"Document how to enable test mode (?testMode=true)\",\n        \"Document how to start Node.js WebSocket server\",\n        \"Document how to run Python integration tests\",\n        \"Document how to write custom test scripts\",\n        \"Add architecture diagram\",\n        \"Add security notes and warnings\",\n        \"Add example workflows\"\n      ],\n      \"testValidation\": \"Manual review\"\n    },\n    {\n      \"order\": 18,\n      \"task\": \"Add resetGameState() command for test cleanup\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1 hour\",\n      \"dependencies\": [2],\n      \"details\": [\n        \"Implement resetGameState() command\",\n        \"Reset ship position to origin\",\n        \"Reset ship velocity to zero\",\n        \"Unfit all modules\",\n        \"Clear inventory (or reset to default state)\",\n        \"Reset credits to starting amount\",\n        \"Undock if docked\",\n        \"Add flag to preserve/reset specific state\"\n      ],\n      \"testValidation\": \"TC-INT-002\"\n    },\n    {\n      \"order\": 19,\n      \"task\": \"Implement request/response ID matching in bridge\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/TestingBrowserBridge.js\",\n      \"estimatedTime\": \"45 minutes\",\n      \"dependencies\": [8],\n      \"details\": [\n        \"Track pending requests by ID\",\n        \"Match responses to original requests\",\n        \"Support out-of-order responses\",\n        \"Add timeout handling for stuck requests\",\n        \"Clean up completed requests\"\n      ],\n      \"testValidation\": \"TC-INT-003\"\n    },\n    {\n      \"order\": 20,\n      \"task\": \"Add performance optimization: command batching\",\n      \"file\": \"/mnt/c/github/superstarships/js/testing/GameTestingInterface.js\",\n      \"estimatedTime\": \"1 hour\",\n      \"dependencies\": [7],\n      \"details\": [\n        \"Add batch command handler: executeBatch([commands])\",\n        \"Execute multiple commands in single request\",\n        \"Return array of responses matching command order\",\n        \"Add transaction support (rollback if any command fails)\",\n        \"Useful for complex test setups\"\n      ],\n      \"testValidation\": \"TC-PERF-001\"\n    },\n    {\n      \"order\": 21,\n      \"task\": \"Final integration testing and bug fixes\",\n      \"file\": \"Multiple files\",\n      \"estimatedTime\": \"3 hours\",\n      \"dependencies\": [14],\n      \"details\": [\n        \"Run full Python test suite\",\n        \"Fix any failing tests\",\n        \"Validate all 32 test cases pass\",\n        \"Test edge cases and error conditions\",\n        \"Verify no console errors during testing\",\n        \"Validate ship fitting persistence regression (TC-INT-001)\",\n        \"Performance testing (latency, FPS impact)\"\n      ],\n      \"testValidation\": \"All test cases in test plan\"\n    },\n    {\n      \"order\": 22,\n      \"task\": \"Add visual test mode indicator in UI\",\n      \"file\": \"/mnt/c/github/superstarships/index.html and CSS\",\n      \"estimatedTime\": \"30 minutes\",\n      \"dependencies\": [11],\n      \"details\": [\n        \"Add corner badge showing 'TEST MODE' when active\",\n        \"Use bright color (orange/yellow) for visibility\",\n        \"Add pulsing animation to catch attention\",\n        \"Make it dismissible but remember preference\",\n        \"Add tooltip explaining test mode\"\n      ],\n      \"testValidation\": \"Manual testing\"\n    }\n  ],\n  \"technicalConsiderations\": {\n    \"performance\": {\n      \"commandLatency\": \"Target <50ms average, <100ms max (synchronous commands)\",\n      \"fpsImpact\": \"WebSocket polling at 10Hz max, should cause <2 FPS drop\",\n      \"memoryUsage\": \"Testing systems add ~500KB of JavaScript, negligible impact\",\n      \"optimization\": \"Command batching available for multiple commands in single request\"\n    },\n    \"memory\": {\n      \"connectionManagement\": \"Single WebSocket connection per browser tab, auto-reconnect on disconnect\",\n      \"requestTracking\": \"Pending requests cleared after 30 second timeout\",\n      \"eventListeners\": \"All testing event listeners cleaned up when test mode disabled\"\n    },\n    \"compatibility\": {\n      \"browsers\": \"Chrome 80+, Firefox 75+, Edge 80+ (WebSocket support required)\",\n      \"nodeVersion\": \"Node.js 14+ required for WebSocket server\",\n      \"pythonVersion\": \"Python 3.8+ for test scripts (websocket-client library)\",\n      \"osSupport\": \"Cross-platform (Windows, macOS, Linux)\"\n    },\n    \"security\": {\n      \"testModeEnforcement\": \"All commands check TestModeManager.requireTestMode() before execution\",\n      \"localhostOnly\": \"Node.js server binds to 127.0.0.1 only (not 0.0.0.0)\",\n      \"originValidation\": \"Browser bridge only connects to ws://localhost:8765\",\n      \"productionSafety\": \"Test mode scripts not loaded unless ?testMode=true\",\n      \"noAuth\": \"No authentication needed (localhost-only is sufficient security)\"\n    },\n    \"errorHandling\": {\n      \"commandValidation\": \"All parameters validated before execution\",\n      \"stateValidation\": \"Commands check preconditions (e.g., docked before fitting)\",\n      \"errorFormat\": \"Consistent JSON error format with codes and messages\",\n      \"gracefulFailure\": \"Errors don't crash game or corrupt state\",\n      \"logging\": \"All errors logged to console with stack traces\"\n    },\n    \"stateManagement\": {\n      \"atomicity\": \"Each command is atomic (succeeds completely or fails completely)\",\n      \"consistency\": \"Commands validate game state before and after execution\",\n      \"isolation\": \"Multiple rapid commands handled sequentially (queue)\",\n      \"durability\": \"State changes persist in game (use resetGameState() to clean up)\"\n    }\n  },\n  \"risks\": [\n    {\n      \"risk\": \"Test mode accidentally enabled in production\",\n      \"severity\": \"high\",\n      \"mitigation\": [\n        \"Test mode requires explicit ?testMode=true URL parameter\",\n        \"Add prominent visual indicator when test mode is active\",\n        \"Build system should strip test mode code from production builds (future)\",\n        \"Add warning in console when test mode is enabled\"\n      ]\n    },\n    {\n      \"risk\": \"Commands break existing game state management\",\n      \"severity\": \"high\",\n      \"mitigation\": [\n        \"All commands use existing game APIs (don't bypass managers)\",\n        \"Extensive integration testing before merging\",\n        \"Commands validate preconditions before execution\",\n        \"Add resetGameState() command for test cleanup\"\n      ]\n    },\n    {\n      \"risk\": \"Ship fitting persistence regression reintroduced\",\n      \"severity\": \"high\",\n      \"mitigation\": [\n        \"TC-INT-001 specifically tests this regression\",\n        \"Integration test runs on every code change\",\n        \"Document fitting persistence requirements\",\n        \"Add monitoring for fitted modules after undock\"\n      ]\n    },\n    {\n      \"risk\": \"WebSocket polling degrades game FPS\",\n      \"severity\": \"medium\",\n      \"mitigation\": [\n        \"Limit WebSocket message rate to 10Hz\",\n        \"Use requestAnimationFrame for command processing\",\n        \"TC-PERF-002 validates FPS impact is <5 FPS\",\n        \"Add performance monitoring in testing interface\"\n      ]\n    },\n    {\n      \"risk\": \"Poor error messages confuse test developers\",\n      \"severity\": \"medium\",\n      \"mitigation\": [\n        \"Comprehensive error codes with descriptive messages\",\n        \"Include valid options/ranges in error messages\",\n        \"TC-ERR-001 through TC-ERR-008 validate error clarity\",\n        \"Document all error codes in API reference\"\n      ]\n    },\n    {\n      \"risk\": \"Commands leave game in invalid state\",\n      \"severity\": \"medium\",\n      \"mitigation\": [\n        \"All commands validate preconditions\",\n        \"Add state validation after command execution\",\n        \"Provide resetGameState() for cleanup\",\n        \"Integration tests validate state consistency\"\n      ]\n    },\n    {\n      \"risk\": \"Test script connection issues\",\n      \"severity\": \"low\",\n      \"mitigation\": [\n        \"Add detailed connection error messages\",\n        \"Document server startup procedures\",\n        \"Add reconnection logic in browser bridge\",\n        \"Provide troubleshooting guide\"\n      ]\n    },\n    {\n      \"risk\": \"Incomplete command coverage\",\n      \"severity\": \"low\",\n      \"mitigation\": [\n        \"Implement all commands from requirements\",\n        \"Add extensibility for future commands\",\n        \"Document command registration pattern\",\n        \"Make it easy to add new commands\"\n      ]\n    }\n  ],\n  \"dependencies\": {\n    \"runtime\": [\n      {\n        \"name\": \"ws (WebSocket library for Node.js)\",\n        \"version\": \"^8.0.0\",\n        \"purpose\": \"Node.js WebSocket server implementation\",\n        \"installation\": \"npm install ws\"\n      },\n      {\n        \"name\": \"websocket-client (Python)\",\n        \"version\": \"^1.0.0\",\n        \"purpose\": \"Python WebSocket client for test scripts\",\n        \"installation\": \"pip install websocket-client\"\n      },\n      {\n        \"name\": \"pytest (Python)\",\n        \"version\": \"^7.0.0\",\n        \"purpose\": \"Python test framework\",\n        \"installation\": \"pip install pytest\"\n      }\n    ],\n    \"gameIntegration\": [\n      {\n        \"system\": \"SpaceshipSimulator\",\n        \"required\": true,\n        \"access\": \"window.simulator reference\"\n      },\n      {\n        \"system\": \"ShipFittingManager\",\n        \"required\": true,\n        \"access\": \"simulator.shipFittingManager\"\n      },\n      {\n        \"system\": \"StationManager\",\n        \"required\": true,\n        \"access\": \"simulator.stationManager\"\n      },\n      {\n        \"system\": \"ResourceManager\",\n        \"required\": true,\n        \"access\": \"simulator.resourceManager\"\n      },\n      {\n        \"system\": \"Ship (player ship)\",\n        \"required\": true,\n        \"access\": \"simulator.playerShip\"\n      },\n      {\n        \"system\": \"InventoryUI/CargoManager\",\n        \"required\": true,\n        \"access\": \"simulator.cargoManager or resourceManager.inventory\"\n      }\n    ]\n  },\n  \"testingStrategy\": {\n    \"unitTesting\": \"Each command handler tested in isolation with mocked game state\",\n    \"integrationTesting\": \"Full test suite (32 test cases) validates end-to-end workflows\",\n    \"regressionTesting\": \"TC-INT-001 specifically tests ship fitting persistence\",\n    \"performanceTesting\": \"TC-PERF-001 and TC-PERF-002 validate latency and FPS impact\",\n    \"securityTesting\": \"TC-SEC-001 and TC-SEC-002 validate test mode enforcement and localhost binding\",\n    \"manualTesting\": \"Visual validation of UI changes, console output, and game behavior\"\n  },\n  \"estimatedTotalTime\": {\n    \"development\": \"28 hours (Steps 1-22)\",\n    \"testing\": \"8 hours (Creating and running test suite)\",\n    \"documentation\": \"5 hours (API docs, setup guide)\",\n    \"totalEstimate\": \"41 hours (approximately 1 week of full-time work)\"\n  }\n}\n```\n\n---\n\n## Architecture Diagram (ASCII)\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                     TEST CLIENT (Python/JS)                  │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  Test Script (websocket_integration_test.py)        │     │\n│  │  - Connects to ws://localhost:8765                  │     │\n│  │  - Sends JSON commands                              │     │\n│  │  - Validates responses                              │     │\n│  └────────────────────────────────────────────────────┘     │\n└───────────────────────┬─────────────────────────────────────┘\n                        │ WebSocket (JSON-RPC)\n                        ▼\n┌─────────────────────────────────────────────────────────────┐\n│              NODE.JS WEBSOCKET SERVER (Localhost)            │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  TestingWebSocketServer.js                          │     │\n│  │  - Listens on 127.0.0.1:8765                        │     │\n│  │  - Routes commands browser ↔ test clients          │     │\n│  │  - Matches requests/responses by ID                 │     │\n│  └────────────────────────────────────────────────────┘     │\n└───────────────────────┬─────────────────────────────────────┘\n                        │ WebSocket (JSON-RPC)\n                        ▼\n┌─────────────────────────────────────────────────────────────┐\n│                 BROWSER (Game Running)                       │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  TestingBrowserBridge.js                            │     │\n│  │  - Connects to ws://localhost:8765                  │     │\n│  │  - Receives commands from server                    │     │\n│  │  - Sends responses back to server                   │     │\n│  └──────────────────┬─────────────────────────────────┘     │\n│                     │ JavaScript calls                       │\n│                     ▼                                        │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  GameTestingInterface.js                            │     │\n│  │  - handleCommand(commandObj)                        │     │\n│  │  - Validates commands and parameters                │     │\n│  │  - Routes to appropriate handler                    │     │\n│  └──────────────────┬─────────────────────────────────┘     │\n│                     │ Game API calls                         │\n│                     ▼                                        │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  SpaceshipSimulator + Game Systems                  │     │\n│  │  - Ship control (position, velocity, throttle)      │     │\n│  │  - ShipFittingManager (fitItem, unfitItem)          │     │\n│  │  - StationManager (dock, undock)                    │     │\n│  │  - ResourceManager (inventory, resources)           │     │\n│  │  - Returns state data                               │     │\n│  └────────────────────────────────────────────────────┘     │\n│                                                              │\n│  ┌────────────────────────────────────────────────────┐     │\n│  │  TestModeManager.js (Security Gate)                 │     │\n│  │  - Checks ?testMode=true URL parameter              │     │\n│  │  - requireTestMode() blocks if not enabled          │     │\n│  └────────────────────────────────────────────────────┘     │\n└─────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Command Protocol Format\n\n### Request Format (JSON-RPC Style)\n```json\n{\n  \"id\": \"unique-request-id-12345\",\n  \"command\": \"getShipState\",\n  \"params\": {\n    \"includeModules\": true,\n    \"includeInventory\": false\n  }\n}\n```\n\n### Success Response Format\n```json\n{\n  \"id\": \"unique-request-id-12345\",\n  \"success\": true,\n  \"data\": {\n    \"position\": {\"x\": 0, \"y\": 0, \"z\": 0},\n    \"velocity\": {\"x\": 0, \"y\": 0, \"z\": 0},\n    \"rotation\": {\"x\": 0, \"y\": 0, \"z\": 0, \"w\": 1},\n    \"throttle\": 0,\n    \"shipType\": \"Atron\",\n    \"hull\": 100,\n    \"capacitor\": 100,\n    \"fittedModules\": {\n      \"high1\": {\"name\": \"Mining Laser I\", \"id\": \"module-123\"},\n      \"high2\": null\n    },\n    \"isDocked\": false,\n    \"isWarping\": false\n  },\n  \"error\": null,\n  \"timestamp\": 1699564800000\n}\n```\n\n### Error Response Format\n```json\n{\n  \"id\": \"unique-request-id-12345\",\n  \"success\": false,\n  \"data\": null,\n  \"error\": {\n    \"code\": \"INVALID_PARAMETER_VALUE\",\n    \"message\": \"Parameter 'value' must be between 0 and 100\",\n    \"details\": {\n      \"parameterName\": \"value\",\n      \"receivedValue\": 150,\n      \"validRange\": \"0-100\"\n    }\n  },\n  \"timestamp\": 1699564800000\n}\n```\n\n---\n\n## Example Test Script Usage (Python)\n\n```python\nfrom test_helpers import GameTestClient\nimport pytest\n\ndef test_ship_fitting_persists_after_undock():\n    \"\"\"TC-INT-001: Regression test for ship fitting persistence\"\"\"\n    with GameTestClient() as client:\n        # Get initial state\n        state = client.get_ship_state()\n        assert not state['isDocked'], \"Ship should start undocked\"\n        \n        # Teleport near station and dock\n        client.set_position(1000, 0, 0)\n        client.dock()\n        \n        # Wait for docking\n        client.wait_for_docked(timeout=5)\n        \n        # Get a module from inventory\n        inventory = client.get_inventory()\n        module = next(i for i in inventory['items'] if i['name'] == 'Mining Laser I')\n        \n        # Fit the module\n        fit_result = client.fit_item(module['id'], 'high1')\n        assert fit_result['success'], \"Fitting should succeed\"\n        \n        # Verify fitted\n        state = client.get_ship_state()\n        assert state['fittedModules']['high1']['name'] == 'Mining Laser I'\n        \n        # Undock\n        client.undock()\n        client.wait_for_undocked(timeout=5)\n        \n        # CRITICAL: Verify module still fitted after undocking\n        state = client.get_ship_state()\n        assert state['fittedModules']['high1']['name'] == 'Mining Laser I', \\\n            \"REGRESSION: Fitted module disappeared after undocking!\"\n        \n        print(\"✅ Ship fitting persists correctly after undocking\")\n```\n\n---\n\n## Security Considerations Summary\n\n1. **Test Mode Enforcement**: All commands blocked unless `?testMode=true` is in URL\n2. **Localhost Only**: Node.js server binds to `127.0.0.1` (not `0.0.0.0`)\n3. **No Authentication**: Not needed since localhost-only is sufficient\n4. **Production Safety**: Test mode scripts not loaded in production builds\n5. **Visual Warning**: Prominent \"TEST MODE\" indicator in UI when active\n\n---\n\n## File Creation Checklist\n\n- [ ] `/mnt/c/github/superstarships/js/debug/TestModeManager.js` (Step 1)\n- [ ] `/mnt/c/github/superstarships/js/testing/GameTestingInterface.js` (Steps 2-7, 18, 20)\n- [ ] `/mnt/c/github/superstarships/js/testing/TestingBrowserBridge.js` (Steps 8, 19)\n- [ ] `/mnt/c/github/superstarships/server/TestingWebSocketServer.js` (Step 9)\n- [ ] `/mnt/c/github/superstarships/server/package.json` (Step 10)\n- [ ] `/mnt/c/github/superstarships/tests/test_helpers.py` (Step 13)\n- [ ] `/mnt/c/github/superstarships/tests/websocket_integration_test.py` (Step 14)\n- [ ] `/mnt/c/github/superstarships/tests/example_test_script.js` (Step 15)\n- [ ] `/mnt/c/github/superstarships/docs/TESTING_WEBSOCKET_API.md` (Step 16)\n- [ ] `/mnt/c/github/superstarships/docs/TESTING_SETUP_GUIDE.md` (Step 17)\n\n## File Modification Checklist\n\n- [ ] `/mnt/c/github/superstarships/js/SpaceshipSimulator.js` (Step 11)\n- [ ] `/mnt/c/github/superstarships/index.html` (Steps 12, 22)\n\n---\n\n## Next Steps After Implementation\n\n1. **Run Integration Tests**: Execute full Python test suite (32 test cases)\n2. **Validate Regression Fix**: Specifically run TC-INT-001 (ship fitting persistence)\n3. **Performance Validation**: Run TC-PERF-001 and TC-PERF-002\n4. **Security Audit**: Verify test mode enforcement works correctly\n5. **Documentation Review**: Ensure all commands documented with examples\n6. **Example Workflows**: Create example test scripts for common scenarios\n\n---\n\nDECISION: implementation_plan_ready",
      "completedStagesCount": 3,
      "totalExecutions": 3
    },
    {
      "timestamp": "2025-11-16T20:16:09.078Z",
      "eventType": "stage_routed",
      "fromStage": "plan_implementation",
      "toStage": "implement_feature",
      "decision": "IMPLEMENTATION_PLAN_READY",
      "reasoning": "Decision \"IMPLEMENTATION_PLAN_READY\" matched connection condition"
    },
    {
      "timestamp": "2025-11-16T20:16:09.125Z",
      "eventType": "stage_started",
      "executionNumber": 4,
      "stageId": "implement_feature",
      "stageName": "Feature Implementation",
      "agent": "code_implementer",
      "stageType": "executor",
      "description": "Write code to implement the feature",
      "inputs": [
        "plan_implementation"
      ]
    }
  ],
  "lastUpdated": "2025-11-16T20:16:09.125Z"
}