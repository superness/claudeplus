Now I have all the design documentation. Let me compile the comprehensive requirements extraction for the Items/Loot system.

## Feature: Items/Loot System

### Specifications from Design Docs

#### Technical/Visual Requirements

From **data-model.md** - Item Instance Schema:
```sql
CREATE TABLE items (
    item_id             UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id         INTEGER NOT NULL REFERENCES item_templates(template_id),
    owner_character_id  UUID REFERENCES characters(character_id),
    owner_account_id    UUID REFERENCES accounts(account_id),
    location_type       VARCHAR(20) NOT NULL,  -- INVENTORY, EQUIPPED, BANK, AUCTION, MAIL
    inventory_slot      INTEGER,
    equipment_slot      item_slot,
    rolled_stats        JSONB DEFAULT '{}',
    active_effects      VARCHAR(50)[],
    refinement_level    INTEGER DEFAULT 0,
    infusion_effect     VARCHAR(50),
    is_bound            BOOLEAN DEFAULT FALSE,
    bound_to            UUID,
    max_durability      INTEGER DEFAULT 100,
    current_durability  INTEGER DEFAULT 100,
    stack_count         INTEGER DEFAULT 1,
    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by          VARCHAR(50),  -- DROP, CRAFT, VENDOR, TRADE
    source_details      JSONB DEFAULT '{}'
);
```

#### Loot Drop Tables (combat-design.md Section VII)

**Common Enemy Drops:**
```
COMMON ENEMY (e.g., Guardsman, Fire Warrior, Slugga Boy)
├── Currency: 10-25 Thrones (100%)
├── T1 Material: 60% chance, 1-2 quantity
├── T2 Material: 15% chance, 1 quantity
├── T3 Material: 1% chance
├── T1 Consumable: 10% chance
├── T2 Consumable: 2% chance
├── Equipment: 0.5% chance (T1-T2)
└── Special: 0.1% chance named item
```

**Elite Enemy Drops:**
```
ELITE ENEMY (e.g., Space Marine, Crisis Suit, Nob)
├── Currency: 35-60 Thrones (100%)
├── T1 Material: 30% chance, 2-3 quantity
├── T2 Material: 40% chance, 1-2 quantity
├── T3 Material: 15% chance, 1 quantity
├── T4 Material: 5% chance
├── T2 Consumable: 20% chance
├── T3 Consumable: 5% chance
├── Equipment: 5% chance (T2-T3)
└── Special: 1% chance named item
```

**Boss Enemy Drops:**
```
BOSS ENEMY (e.g., Warboss, Commander)
├── Currency: 200-500 Thrones (100%)
├── T3 Material: 100% chance, 2-4 quantity
├── T4 Material: 50% chance, 1-2 quantity
├── T5 Material: 10% chance
├── T3 Consumable: 50% chance
├── T4 Consumable: 20% chance
├── Equipment: 25% chance (T3-T4)
├── Named Equipment: 5% chance
└── Special: 1% chance legendary
```

#### Enemy Threat Tiers (henchmen-heroes-design.md Section V.B)

```
MINORIS (WHITE) - Cannon Fodder
├── HP: 80-150, DPS: 15-25
├── Examples: Gretchin, Cultists, Gue'vesa
└── Loot: T1-T2 materials, 5-15 Thrones

MAJORIS (BLUE) - Standard Troops
├── HP: 180-350, DPS: 35-55
├── Examples: Guardsmen, Fire Warriors, Boyz
└── Loot: T2-T3 materials, 15-35 Thrones

EXTREMIS (YELLOW) - Elite Enemies
├── HP: 400-800, DPS: 60-100
├── Examples: Space Marine, Crisis Suit, Nob
└── Loot: T3-T4 materials, 40-80 Thrones, rare gear

TERMINUS (PURPLE) - Boss-Class Enemies
├── HP: 2,000-8,000, DPS: 120-200
├── Examples: Daemon Prince, Riptide, Warboss
└── Loot: T4-T5 materials, 200-500 Thrones, named gear

APEX (GOLD) - World Bosses / Raid Bosses
├── HP: 8,000-20,000+, DPS: 200-400
├── Examples: Greater Daemon, Titan, Gargant
└── Loot: Legendary materials, unique rewards
```

#### Equipment Tiers (combat-design.md Section VII.B)

```
TIER 1: BASIC (Levels 1-5)
├── Stats: Base values only, no bonuses
├── Sources: Starting gear, tutorial rewards, common vendors
├── Cost: 50-200 Thrones
├── Example: Standard Lasgun - 40 damage

TIER 2: IMPROVED (Levels 6-10)
├── Stats: +15% base stats, 1 bonus stat (+5-15 attribute)
├── Sources: Quest rewards, T2 drops, basic crafting
├── Cost: 300-600 Thrones
├── Example: Kantrael Lasgun - 46 damage, +10 Ballistics

TIER 3: SUPERIOR (Levels 11-15)
├── Stats: +30% base stats, 2 stats (+10-20 each)
├── Sources: Hard mode, elite drops, advanced crafting
├── Cost: 800-1,500 Thrones
├── Example: Hellgun - 52 damage, +15 Ballistics, +10% crit

TIER 4: EXCEPTIONAL (Levels 16-20)
├── Stats: +50% base stats, 3 stats (+15-25 each), 1 special effect
├── Sources: Veteran mode, boss drops, master crafting
├── Cost: 2,500-5,000 Thrones
├── Example: Hot-Shot Lasgun - 60 damage, +20 Ballistics, +15% crit, "Armor Piercing"

TIER 5: MASTERWORK (Levels 21-30)
├── Stats: +75% base stats, 4 stats (+20-30 each), 1-2 special effects
├── Sources: Nightmare mode, raid content, legendary crafting
├── Cost: 8,000-15,000 Thrones
├── Example: Artificer Hellgun - 70 damage, +25 Ballistics, +20% crit, "Emperor's Wrath", "Armor Bane"

LEGENDARY: NAMED ITEMS (Level 20+)
├── Stats: Unique - often +100% base or unusual combinations
├── Sources: Specific bosses, quest chains, world events
├── Cost: Cannot be purchased
├── Example: "Saint Celestine's Grace" - unique weapon, unlocks special skill
```

#### Item Slots (data-model.md)

```sql
CREATE TYPE item_slot AS ENUM (
    'WEAPON_PRIMARY',
    'WEAPON_SECONDARY',
    'WEAPON_TWO_HANDED',
    'ARMOR_HEAD',
    'ARMOR_CHEST',
    'ARMOR_HANDS',
    'ARMOR_FEET',
    'ACCESSORY_1',
    'ACCESSORY_2'
);
```

#### Special Effects (combat-design.md Section VII.C)

| Effect Name | Description | Equipment Slots |
|-------------|-------------|-----------------|
| Armor Piercing | Ignore 25% of enemy armor | Weapons |
| Armor Bane | +50% damage vs heavily armored | Weapons |
| Holy | +50% damage vs Daemons/Chaos | Weapons |
| Blessed | +20% healing received | Armor |
| Fortified | -15% damage from crits | Armor |
| Swift | +10% movement speed | Boots |
| Energized | +5 energy regeneration | Accessories |
| Vampiric | Heal 5% of damage dealt | Weapons |
| Explosive | 20% chance for AoE on hit | Ranged Weapons |
| Chained | 15% chance to hit additional target | Ranged Weapons |

#### Item Sets (progression-design.md Section V.C)

```
SET BONUS SYSTEM
Sets provide bonuses when multiple pieces equipped.
Each set has 5 pieces (weapon, chest, head, hands, feet).

2-PIECE BONUS: Minor enhancement
4-PIECE BONUS: Major enhancement
5-PIECE BONUS: Unique ability

EXAMPLE SETS:

IMPERIAL - "Martyred Saint's Raiment"
├── 2-piece: +10% healing received
├── 4-piece: Death resurrects allies within 300 range (120s CD)
├── 5-piece: "Saint's Blessing" - active ability, party invulnerability 3s
└── Acquisition: Cathedral of Thorns (Hard+)

TAU - "Commander's Panoply"
├── 2-piece: +15% to allies you buff
├── 4-piece: Markerlights spread to adjacent enemies
├── 5-piece: "Supreme Command" - all allies gain free skill use
└── Acquisition: Tau Sept Command (Veteran+)

ORK - "Warboss's Mega Armour"
├── 2-piece: +20% health
├── 4-piece: WAAAGH! abilities cost 20% less
├── 5-piece: "WAAAGH! Eruption" - massive AoE when below 25% HP
└── Acquisition: Rok Da Big Boss (Nightmare)
```

#### Material Tiers (data-model.md)

```sql
CREATE TYPE material_tier AS ENUM ('T1', 'T2', 'T3', 'T4', 'T5', 'LEGENDARY');

INSERT INTO materials (material_code, display_name, tier, source_description) VALUES
('SCRAP_METAL', 'Scrap Metal', 'T1', 'Common drop from enemies'),
('REFINED_METAL', 'Refined Metal', 'T2', 'Crafted from Scrap Metal or elite drops'),
('PLASTEEL', 'Plasteel', 'T3', 'Hard mode enemy drops'),
('ADAMANTIUM_SHARD', 'Adamantium Shard', 'T4', 'Veteran content drops'),
('LIVING_METAL', 'Living Metal', 'T5', 'Nightmare content drops'),
('CELESTINE_FRAGMENT', 'Celestine Fragment', 'LEGENDARY', 'Legendary bosses only');
```

#### Loot Table System (data-model.md)

```sql
CREATE TABLE loot_tables (
    table_id            SERIAL PRIMARY KEY,
    table_code          VARCHAR(50) NOT NULL UNIQUE,
    description         TEXT
);

CREATE TABLE loot_table_entries (
    entry_id            SERIAL PRIMARY KEY,
    table_id            INTEGER NOT NULL REFERENCES loot_tables(table_id),
    drop_type           VARCHAR(20) NOT NULL,  -- ITEM, MATERIAL, CURRENCY
    item_template_id    INTEGER REFERENCES item_templates(template_id),
    material_code       VARCHAR(50),
    currency_min        INTEGER,
    currency_max        INTEGER,
    drop_chance         DECIMAL(5,4) NOT NULL,  -- 0.0001 to 1.0000
    quantity_min        INTEGER DEFAULT 1,
    quantity_max        INTEGER DEFAULT 1,
    difficulty_min      difficulty_level,
    first_kill_bonus    DECIMAL(4,2) DEFAULT 1.0  -- 2.0 = double chance on first kill
);
```

#### Henchmen/Hero Loot Rules (henchmen-heroes-design.md)

```
LOOT WITH HENCHMEN/HEROES

DROP RULES:
├── All loot drops go to PLAYERS only
├── Henchmen/Heroes receive NOTHING
├── XP is NOT split (full XP to all players)
├── Currency drops unchanged
└── Material drops unchanged
```

#### Difficulty Multipliers (systems-integration.md)

```
COMBAT VICTORY DATA FLOW:
├── EXPERIENCE: 15-25 XP (Common), 50-80 XP (Elite), 200-500 XP (Boss)
├── CURRENCY: 10-25 Thrones (Common), 35-60 Thrones (Elite), 200-500 Thrones (Boss)
├── MATERIALS: T1-T2 (Levels 1-10), T2-T3 (Levels 11-20), T4-T5 (Levels 21-30+)
```

#### First-Kill Bonuses (progression-design.md)

```
FIRST-TIME KILL BONUSES:
├── First kill of enemy type: +50% XP
├── First boss kill: +100% XP
├── First Nightmare kill: +200% XP
└── These stack with difficulty multipliers
```

### Implementation Checklist

**Core Loot System:**
- [ ] LootTable entity with entries for drop rates
- [ ] LootDrop interface: { type, itemTemplateId?, materialCode?, quantity, currencyAmount? }
- [ ] calculateLoot(enemyTemplate, difficulty, isFirstKill) function
- [ ] Roll drop chances per loot table entry
- [ ] Support quantity ranges (min/max)
- [ ] First-kill bonus multiplier on drop rates

**Enemy-Based Drop Tables:**
- [ ] MINORIS (white): T1-T2 materials, 5-15 Thrones
- [ ] MAJORIS (blue): T2-T3 materials, 15-35 Thrones
- [ ] EXTREMIS (yellow): T3-T4 materials, 40-80 Thrones, rare gear
- [ ] TERMINUS (purple): T4-T5 materials, 200-500 Thrones, named gear
- [ ] APEX (gold): Legendary materials, unique rewards

**Item Instance Creation:**
- [ ] createItemFromTemplate() with random stat rolls (±20% variance)
- [ ] Roll active effects from possibleEffects array
- [ ] Set isBound based on template.isBoundOnPickup
- [ ] Record createdBy source (DROP, CRAFT, VENDOR, TRADE, QUEST)
- [ ] Store sourceDetails { enemyId, zoneId, difficulty }

**Drop Visualization (Client):**
- [ ] Loot drop entity spawns at enemy death position
- [ ] Color-coded by tier: white/gray (T1), green (T2), blue (T3), purple (T4), orange (T5), gold (Legendary)
- [ ] Pickup radius interaction
- [ ] Loot notification in UI
- [ ] Auto-pickup option for materials/currency

**Material Drops:**
- [ ] T1 materials from levels 1-10 content
- [ ] T2 materials from levels 6-15 content
- [ ] T3 materials from levels 11-20 content (Hard mode)
- [ ] T4 materials from levels 16-25 content (Veteran)
- [ ] T5 materials from levels 21-30 content (Nightmare)
- [ ] Legendary materials from specific bosses only

**Currency Drops:**
- [ ] Always 100% drop rate
- [ ] Range based on enemy threat tier
- [ ] Difficulty multiplier: Normal 1.0×, Hard 1.25×, Veteran 1.5×, Nightmare 2.0×

**Integration Points:**
- [ ] CombatManager.onEnemyDeath() triggers loot generation
- [ ] Inventory system receives dropped items
- [ ] Material storage receives materials
- [ ] Currency added to character.currency_thrones
- [ ] Loot event logged to game_events table

DECISION: requirements_extracted