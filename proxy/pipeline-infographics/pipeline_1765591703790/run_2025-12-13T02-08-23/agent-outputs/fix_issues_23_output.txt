## Fixes Applied

### Issue 1: Companion AI Disconnected from Update Loop
- **File:** `client/src/game/companions/PartyManager.ts`
- **Problem:** `PartyManager.update()` was only calling `companion.update(deltaTime)` but never calling `companion.updateAI(deltaTime, context)`. The AI requires an `AIContext` object that was never built or passed.
- **Fix:** 
  1. Added imports for `AIContext`, `AITarget`, `AIAlly`, `AIDecision`, and `StatusEffectType`
  2. Added interface definitions for `PartyManagerPlayerRef` and `PartyManagerEntityRef` to avoid circular dependencies
  3. Added `setPlayerRef()` and `setEntityRef()` methods to inject dependencies
  4. Added `buildAIContext()` method that constructs the AI context from game state (enemies, allies, player position)
  5. Added `buildCompanionContext()` method that creates companion-specific context with self-data
  6. Updated `update()` method to call `companion.updateAI(deltaTime, context)` with the built context
  7. Added `onCompanionDecisionCallback()` to notify when companions make skill decisions

- **File:** `client/src/game/Game.ts`
- **Fix:** Added calls to wire up the party manager with player and entity manager references:
  ```typescript
  this.partyManager.setPlayerRef(this.player);
  this.partyManager.setEntityRef(this.entityManager);
  ```

### Issue 2: Integration Tests Spawn Enemies Out of Range
- **File:** `client/tests/combat.spec.ts`
- **Status:** Already fixed - Tests already spawn enemies at positions like `(1, 1)` and `(1, 0)` which are within melee range (distance ~1.4 units, skill range is 2). No additional changes needed.

DECISION: retry