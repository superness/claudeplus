Now I have enough context to create a comprehensive plan for building the bitcoin_daemon_manager agent.

---

**UNDERSTANDING:** User wants me to create a detailed plan for building a bitcoin_daemon_manager agent based on section 2.1 of MINING_CYCLE_AUTOMATION_PLAN.md. The agent must manage Bitcoin daemon lifecycle in regtest mode with capabilities including: installation verification, configuration generation, daemon start/stop, status queries (getblockchaininfo, getnetworkinfo), block generation (generatetoaddress), and wallet creation/funding. The agent JSON file should be written to /mnt/c/github/claudeplus/agents/bitcoin_daemon_manager.json with specified permissions and decision outputs.

**APPROACH:** I will analyze the existing bitcoin_daemon_manager.json structure from the SuperCoinServ project, examine the requirements from section 2.1 of the plan, and design a comprehensive agent specification that follows the established agent pattern (similar to pool_server_manager and miner_manager in claudeplus directory). The plan will detail the agent's structure including: core configuration, capabilities/responsibilities, RPC endpoints, command handlers, error handling, validation rules, and integration points. I'll ensure the agent design aligns with the regtest testing workflow and supports all required Bitcoin daemon operations.

**STEPS:**

1) **Read MINING_CYCLE_AUTOMATION_PLAN.md section 2.1** - Use Read tool to examine lines 115-138 to extract complete requirements and success criteria for bitcoin_daemon_manager
   
2) **Analyze existing agent structures** - Compare the two existing agent formats:
   - SuperCoinServ format: /mnt/c/github/private-SuperCoinServ/build/bin/Debug/config/agents/bitcoin_daemon_manager.json (detailed with RPC endpoints, error handling, metrics)
   - ClaudePlus format: /mnt/c/github/claudeplus/agents/*.json (simpler systemPrompt-based format)

3) **Determine target agent format** - Based on claudeplus directory structure and existing agents (pool_server_manager.json, miner_manager.json), use the simpler systemPrompt format for consistency

4) **Design agent structure** with these sections:
   - id, name, role fields
   - expertise array covering all capabilities from requirements
   - Comprehensive systemPrompt covering:
     - Installation/verification of bitcoind
     - Regtest configuration generation (bitcoin.conf parameters)
     - Daemon lifecycle commands (start/stop/restart)
     - RPC operations (getblockchaininfo, getnetworkinfo, getblockcount)
     - Block generation (generatetoaddress with mature coinbase requirements)
     - Wallet operations (createwallet, loadwallet, funding)
     - Error handling scenarios
     - WSL/Linux path considerations
     - Success criteria and validation
   - outputFormat: "markdown"
   - validationCriteria array matching success criteria from section 2.1

5) **Document required Bitcoin daemon operations** in systemPrompt:
   - bitcoind installation paths and verification
   - Regtest-specific configuration parameters (rpcuser, rpcpassword, rpcport=18443, port=18444, regtest=1, server=1, daemon=1, fallbackfee)
   - Startup verification (wait for RPC, check getblockchaininfo)
   - Block generation for coinbase maturity (101 blocks minimum)
   - Wallet creation and initial funding workflow
   - Graceful shutdown procedures

6) **Define decision outputs** - Map agent outcomes to required decisions:
   - daemon_started: Successful daemon launch and RPC ready
   - daemon_stopped: Clean shutdown completed
   - daemon_error: Startup failure, RPC timeout, crash, etc.
   - error: General error condition

7) **Create validation criteria** based on section 2.1 success criteria:
   - Can start daemon from cold state
   - Can generate 101 blocks (mature coinbase)
   - RPC interface responds correctly
   - Clean shutdown with no corruption

8) **Write comprehensive systemPrompt** covering:
   - Command syntax for bitcoind and bitcoin-cli
   - Configuration file generation and locations
   - RPC authentication and connectivity testing
   - Error scenarios (port conflicts, data corruption, RPC timeouts)
   - Regtest workflow best practices
   - Integration with pool_server_manager (RPC connection info)

9) **Structure JSON file** with proper formatting:
   - Use consistent indentation (2 spaces)
   - Include all required fields
   - Ensure JSON validity
   - Add helpful comments in systemPrompt

10) **Write final JSON to target path** - Use Write tool to create /mnt/c/github/claudeplus/agents/bitcoin_daemon_manager.json

**TEST_CONSIDERATIONS:** The plan addresses test scenarios through:

1. **Cold Start Testing**: Agent design includes verification of bitcoind installation, data directory initialization, and first-time configuration generation
2. **RPC Connectivity**: SystemPrompt will detail RPC connection testing procedures (getblockchaininfo, getnetworkinfo) with timeout handling
3. **Block Generation**: Explicit coverage of generatetoaddress command with 101-block requirement for coinbase maturity
4. **Wallet Lifecycle**: Create/load wallet operations with funding workflows for regtest testing
5. **Error Scenarios**: Coverage of port conflicts, RPC failures, daemon crashes, and recovery procedures
6. **Graceful Shutdown**: Procedures for clean daemon termination without data corruption
7. **Integration Testing**: RPC configuration output for pool_server_manager consumption
8. **Edge Cases**: Empty blockchain state, existing data directory, running daemon detection, network type validation

**EVIDENCE:** Upon completion, the plan will specify collection of:

1. Complete bitcoin_daemon_manager.json file content showing all sections
2. List of capabilities mapped to requirements from section 2.1
3. Decision output mappings (daemon_started, daemon_stopped, daemon_error, error)
4. ValidationCriteria matching success criteria from MINING_CYCLE_AUTOMATION_PLAN.md
5. SystemPrompt sections addressing each required capability:
   - Installation verification commands
   - Configuration generation templates
   - Startup procedures
   - RPC query examples
   - Block generation workflows
   - Wallet creation/funding steps
   - Error handling strategies
6. JSON structure validation (proper syntax, required fields, format consistency)
7. Alignment with existing claudeplus agent patterns (pool_server_manager, miner_manager formats)

**CONFIDENCE:** High

**Reasoning:**
- Clear requirements in section 2.1 with explicit capabilities and success criteria
- Existing agent examples in both SuperCoinServ and claudeplus formats provide structural templates
- Bitcoin daemon RPC interface is well-documented and standardized
- Regtest mode operations are straightforward and deterministic
- Agent pattern is established and consistent across existing agents
- File path and permissions are explicitly specified
- Decision outputs are clearly defined
- All required capabilities map directly to standard bitcoin-cli/bitcoind operations

**Potential Challenges (mitigated):**
- Format choice between detailed (SuperCoinServ) vs simple (claudeplus) → Use claudeplus format for consistency with target directory
- WSL/Linux path handling → Document in systemPrompt with examples
- RPC timeout scenarios → Include retry logic and error handling guidance
- Daemon state detection → Provide commands for process checking and port verification

DECISION: design_complete