## Fixes Applied

### Issue 1: Unreliable `waitForFrames` implementation causing timeouts
- File: `client/src/tests/test-hooks.ts`
- Fix: Replaced the pure `requestAnimationFrame` implementation with a hybrid approach that:
  - Uses `performance.now()` to track elapsed time
  - Falls back to `setTimeout` when `requestAnimationFrame` is being throttled (common in headless browsers)
  - Resolves when either the frame count is reached OR enough time has passed
  - Added a new `waitForMs(ms)` utility method for direct time-based waits

### Issue 2: Excessive wait times in companion tests causing timeouts
- File: `client/tests/companions.spec.ts`
- Fix: Reduced wait frame counts and added explicit test timeouts:
  - `companions make AI decisions over time`: 120 → 60 frames, added 45s timeout
  - `companions use SKILL action when enemy is nearby`: 300 → 150 frames, added 45s timeout
  - `companions follow player when in GUARD stance`: 120 → 60 frames, added 45s timeout
  - `companions deal damage to enemies`: 10 iterations × 60 frames → 6 iterations × 30 frames, added 60s timeout
  - `companions generate combat events when using skills`: 360 → 180 frames, added 45s timeout
  - `party coordination - all companions engage same target`: 240 → 120 frames, added 45s timeout

### Issue 3: Test infrastructure timing issues
- File: `client/tests/companions.spec.ts`
- Fix: All tests that use `waitForFrames` now have explicit `test.setTimeout()` calls to prevent Playwright's default 30s timeout from cutting tests short during slow CI environments.

The visual-validation tests already had increased timeouts and reduced wait times from a previous fix (90 frames instead of 180 in several places), so no changes were needed there.

DECISION: retry