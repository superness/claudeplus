# Feature Definition: Reset Player State Debug Option

## Feature Specification

```json
{
  "featureName": "Reset Player State Debug Option",
  "userStory": "As a developer/tester, I want to completely reset all player progress from the debug menu so that I can quickly test the new player experience without manually clearing browser data or restarting the game.",
  "description": "Add a 'Reset Player State' option to the existing debug menu (DebugMenu.js) that completely resets all player progress and state back to starting conditions. This includes clearing all inventory, removing fitted modules, resetting player location to starting position, clearing skill points, resetting currency to starting amount, clearing unlocked items, and removing all localStorage persistence. The feature includes a confirmation dialog to prevent accidental resets and fully reinitializes the player as if starting the game for the first time.",
  "acceptanceCriteria": [
    "Debug menu contains a clearly labeled 'Reset Player State' or 'Start Over' button/option",
    "Clicking the reset option triggers a confirmation dialog with 'Confirm' and 'Cancel' buttons",
    "Confirmation dialog warns user that all progress will be lost",
    "Clicking 'Cancel' closes dialog without changes",
    "Clicking 'Confirm' executes complete state reset",
    "All ship cargo/inventory is cleared (ResourceManager)",
    "All fitted modules are removed (ShipFittingManager)",
    "Player ship position is reset to starting coordinates (NavigationManager)",
    "All skill points and trained skills are cleared (SkillSystem)",
    "Player currency/credits reset to starting amount (EconomyManager)",
    "All unlocked items/blueprints reset to starting set (CraftingManager)",
    "All localStorage keys related to player state are cleared",
    "Game state is reinitialized to default starting conditions",
    "UI updates immediately to reflect reset state (HUD, inventory panels, etc.)",
    "No errors or console warnings during reset process",
    "Feature works whether player is in space, at station, or in any game state"
  ],
  "scope": {
    "inScope": [
      "Add UI button/option to debug menu",
      "Create confirmation dialog component",
      "Reset ship inventory/cargo to empty or starting state",
      "Reset fitted modules to default ship configuration",
      "Reset player position to starting location",
      "Clear skill points and skill training",
      "Reset currency to starting amount",
      "Clear unlocked blueprints/items to starting set",
      "Clear relevant localStorage entries",
      "Reinitialize all affected game managers",
      "Update all UI elements to reflect reset state"
    ],
    "outOfScope": [
      "Resetting game settings/preferences (graphics, controls, audio)",
      "Clearing browser cache or non-player-state data",
      "Implementing multiple save slots or profiles",
      "Undo/redo functionality for resets",
      "Partial resets (reset only inventory, only skills, etc.)",
      "Exporting/importing save states",
      "Cloud save synchronization",
      "Resetting tutorial/onboarding completion flags (unless explicitly part of player state)"
    ]
  },
  "affectedSystems": [
    "DebugMenu.js (UI: add reset button)",
    "ResourceManager.js (reset inventory/cargo)",
    "EconomyManager.js (reset credits/currency)",
    "SkillSystem.js (clear skills)",
    "ShipFittingManager.js (clear fitted modules)",
    "NavigationManager.js (reset position)",
    "CraftingManager.js (reset unlocked blueprints)",
    "StationManager.js (reset station states if applicable)",
    "localStorage (clear player state keys)",
    "HUDManager.js (update displays)",
    "CargoManager.js (refresh cargo UI)",
    "InventoryUI.js (refresh inventory display)",
    "ShipFittingUI.js (refresh fitting display)",
    "SkillUI.js (refresh skill display)"
  ],
  "dependencies": [
    "Existing DebugMenu.js infrastructure",
    "UI confirmation dialog system (may need to create if doesn't exist)",
    "Access to all game manager instances (ResourceManager, EconomyManager, etc.)",
    "Knowledge of default starting values for all reset systems",
    "localStorage API access",
    "Game state initialization/reinitialization methods in each manager"
  ],
  "edgeCases": [
    "What if player is mid-warp when reset is triggered?",
    "What if confirmation dialog is open when game is paused?",
    "What if some managers haven't been initialized yet?",
    "What if localStorage is disabled/blocked by browser?",
    "What if player has open UI panels (fitting, cargo) during reset?",
    "What if reset is triggered during combat or active mining?",
    "What if there are pending asynchronous operations (saves, loads)?",
    "What if custom/modded ships or items exist that don't have default states?",
    "Should the camera reset to default position/angle?",
    "Should active targeting/navigation be cleared?"
  ],
  "technicalImplementation": {
    "estimatedFiles": [
      "js/debug/DebugMenu.js (add reset button + confirmation logic)",
      "js/systems/ResourceManager.js (add resetPlayerState() method)",
      "js/systems/EconomyManager.js (add resetPlayerState() method)",
      "js/skills/SkillSystem.js (add resetPlayerState() method)",
      "js/systems/ShipFittingManager.js (add resetPlayerState() method)",
      "js/systems/NavigationManager.js (add resetPlayerPosition() method)",
      "js/systems/CraftingManager.js (add resetPlayerState() method)",
      "js/core/SpaceshipSimulator.js (orchestrate full reset if needed)",
      "css/debug-menu.css (styling for reset button + confirmation dialog)"
    ],
    "estimatedComplexity": "Medium-High",
    "estimatedLOC": "150-250 lines (including confirmation dialog, reset methods, and coordination logic)",
    "testingApproach": [
      "Manual test: Verify reset button appears in debug menu",
      "Manual test: Verify confirmation dialog appears on click",
      "Manual test: Verify 'Cancel' does nothing",
      "Manual test: Verify 'Confirm' clears all state",
      "Manual test: Verify UI updates correctly after reset",
      "Manual test: Test reset from different game states (space, station, warp)",
      "Manual test: Verify localStorage is cleared",
      "Manual test: Verify no console errors during reset",
      "Edge case test: Reset during combat/mining/warp",
      "Edge case test: Reset with UI panels open",
      "Regression test: Verify debug menu other functions still work"
    ]
  },
  "userFlowDiagram": {
    "steps": [
      "1. Player opens debug menu (F1 or debug button)",
      "2. Player clicks 'Reset Player State' button",
      "3. Confirmation dialog appears: 'Are you sure? All progress will be lost. [Cancel] [Confirm]'",
      "4a. Player clicks [Cancel] → Dialog closes, no changes",
      "4b. Player clicks [Confirm] → Reset process begins",
      "5. Game clears all player state (inventory, skills, currency, position, etc.)",
      "6. Game reinitializes to starting state",
      "7. UI updates to reflect reset state",
      "8. Confirmation dialog closes",
      "9. Player is now in fresh starting state (default ship, starting location, no skills, starting credits)"
    ]
  },
  "mockup": {
    "debugMenuButton": "[Reset Player State] - Red background, warning icon",
    "confirmationDialog": {
      "title": "Reset Player State",
      "message": "⚠️ This will completely reset all player progress including inventory, skills, credits, and position. This cannot be undone.",
      "buttons": ["Cancel (gray)", "Confirm Reset (red)"]
    }
  }
}
```

## Implementation Notes

### Default Starting Values (Must Define)
Before implementation, verify/define these default starting values:
- **Starting Credits**: (check EconomyManager for initial value)
- **Starting Ship**: (likely Atron or basic frigate)
- **Starting Position**: (coordinates of starting system/station)
- **Starting Inventory**: (empty or tutorial items?)
- **Starting Modules**: (default ship fitting)
- **Starting Skills**: (none or basic skills?)
- **Starting Blueprints**: (basic blueprints unlocked by default?)

### localStorage Keys to Clear
Identify all localStorage keys used for persistence:
- Player inventory data
- Fitted modules data
- Skill progress data
- Currency/credits data
- Unlocked items/blueprints
- Player position/navigation state
- Any other player-specific state

### Safety Considerations
- Confirmation dialog MUST be impossible to accidentally confirm (no default focus on Confirm button)
- Consider adding a secondary confirmation (type "RESET" to confirm) for extra safety
- Log the reset action to console for debugging
- Consider telemetry/analytics if implemented

DECISION: feature_defined