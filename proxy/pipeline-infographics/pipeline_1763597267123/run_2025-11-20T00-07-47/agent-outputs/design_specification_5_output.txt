Now I have all the context I need. Let me create a comprehensive plan.

---

**UNDERSTANDING:** User wants me to create a complete agent JSON definition for `miner_manager` based on section 2.1 of the MINING_CYCLE_AUTOMATION_PLAN.md. This agent should manage mining software (cpuminer/other miners), handle miner configuration, wallet setup for rewards, monitor hashrate/submissions, and control miner lifecycle. The agent should be written to `/mnt/c/github/claudeplus/agents/miner_manager.json` with specific permissions (Read, Write, Edit, Bash, Glob, Grep) and decisions (miner_started, miner_stopped, miner_error, error).

**APPROACH:** I will analyze section 2.1 (lines 116-186) of the MINING_CYCLE_AUTOMATION_PLAN.md to extract all requirements for the miner_manager agent, then examine the existing miner_manager.json agent structure (which appears to be for pool-side miner management) and other similar agent definitions (bitcoin_daemon_manager, pool_server_manager, wallet_manager) to understand the JSON schema pattern used in this project. I'll then create a comprehensive agent definition that follows the established patterns while implementing the specific capabilities required for mining software management.

**STEPS:**

1. **Analyze Section 2.1 Requirements** (lines 116-186)
   - Extract all capabilities: Install/verify cpuminer, generate miner config, create/import wallet, start miner with pool connection, monitor hashrate/submissions, stop miner gracefully
   - Note success criteria: Miner connects to pool, hashrate reported correctly, wallet address configured, share submissions attempted
   - Identify key files to create: agents/miner_manager.json, scripts/miner-control.sh, scripts/wallet-setup.sh

2. **Examine Existing Agent Pattern** 
   - Read existing agents (bitcoin_daemon_manager.json if exists, pool_server_manager.json, wallet_manager.json) to understand schema
   - Identify common fields: agent_name, agent_type, group, version, description, configuration, responsibilities, dependencies, rpc_endpoints, outputs, error_handling, logging, metrics, validation
   - Note that wallet_manager.json has comprehensive structure with detailed error_handling, logging, metrics sections

3. **Determine Agent Structure**
   - agent_type: "mining_client" or "infrastructure_core" (based on managing mining software)
   - group: Likely 2 or 3 (infrastructure level)
   - Configuration: miner executable path, pool connection settings (URL, port, worker credentials), wallet address, hashrate monitoring interval, log paths
   - Responsibilities: Match the 7 requirements listed by user
   - Dependencies: pool_server_manager (for connection), wallet_manager (for reward addresses), bitcoin_daemon_manager (for network validation)
   - Tools: Bash (for running miner binaries), Read (for config files), Write (for creating config), Edit (for modifying config), Glob (for finding miners), Grep (for log parsing)

4. **Map Capabilities to RPC Endpoints**
   - POST /install - Install/verify mining software
   - POST /configure - Generate miner configuration
   - POST /start - Start miner with pool connection
   - POST /stop - Stop miner gracefully
   - GET /status - Get miner status (hashrate, shares, connection)
   - GET /hashrate - Get current hashrate
   - GET /submissions - Get share submission statistics
   - POST /wallet/setup - Create/import wallet for rewards

5. **Define Configuration Schema**
   - miner_executable: Path to cpuminer binary (or auto-detect)
   - miner_type: "cpuminer", "cgminer", "bfgminer", etc.
   - pool_config: {url, port, worker_name, worker_password}
   - wallet_address: Address for mining rewards
   - mining_algorithm: "scrypt", "sha256d", etc.
   - threads: Number of CPU threads
   - scan_time: Work scan time
   - monitoring: {hashrate_check_interval, log_parsing_enabled}

6. **Define Events and Outputs**
   - Events: miner_started, miner_stopped, miner_error, miner_connected, miner_disconnected, share_submitted, share_accepted, share_rejected, hashrate_updated
   - Metrics: current_hashrate, accepted_shares, rejected_shares, total_shares, uptime_seconds, pool_connection_status
   - Status fields: miner_running, pool_connected, wallet_configured, current_difficulty, last_share_time

7. **Define Error Handling**
   - miner_binary_not_found: attempt_install or notify user
   - pool_connection_failed: retry_with_backoff, notify pool_server_manager
   - wallet_not_configured: trigger wallet_manager dependency
   - low_hashrate_detected: log_warning, check CPU usage
   - excessive_rejects: notify diagnostics_agent, check difficulty
   - miner_crash: attempt_restart, notify error_recovery_agent

8. **Define Decisions** (as specified by user)
   - miner_started: Miner successfully started and connected
   - miner_stopped: Miner gracefully stopped
   - miner_error: Error occurred during operation
   - error: Generic error condition

9. **Create Comprehensive JSON Structure**
   - Combine all sections following the pattern from wallet_manager.json (most comprehensive)
   - Include: agent_name, agent_type, group, version, description, configuration, responsibilities, inputs, outputs, rpc_endpoints, dependencies, error_handling, logging, metrics, validation, decisions

10. **Write to Target File**
    - Use Write tool to create `/mnt/c/github/claudeplus/agents/miner_manager.json`
    - Format JSON with proper indentation (2 spaces)
    - Validate JSON structure mentally before writing

**TEST_CONSIDERATIONS:**

The plan addresses the following test scenarios:

1. **Miner Installation Test**: Configuration includes auto-detection of miner binary, fallback paths, and installation verification steps
2. **Configuration Generation Test**: Templates for different miner types (cpuminer, cgminer), algorithm-specific settings
3. **Pool Connection Test**: Connection validation, retry logic with exponential backoff, stratum protocol handshake verification
4. **Wallet Setup Test**: Integration with wallet_manager agent, address validation, proper formatting for different address types
5. **Hashrate Monitoring Test**: Configurable polling intervals, log parsing for hashrate extraction, metric collection
6. **Share Submission Test**: Event tracking for submissions/accepts/rejects, statistics aggregation
7. **Graceful Shutdown Test**: Proper process termination (SIGTERM before SIGKILL), cleanup of temp files, state preservation
8. **Error Recovery Test**: Multiple error scenarios defined with specific recovery actions
9. **Multi-Miner Support Test**: Configuration supports different miner types through miner_type field
10. **Cross-Platform Test**: WSL-aware path handling (Windows miner executable from WSL bash)

**EVIDENCE:**

To validate the agent definition, I will provide:

1. **Complete JSON Structure**: The full agent definition with all required sections
2. **Schema Compliance**: Demonstrate that the JSON follows the pattern from existing agents (wallet_manager structure)
3. **Requirements Mapping**: Show how each requirement from section 2.1 maps to specific configuration/responsibilities/endpoints
4. **Decision Coverage**: Verify all 4 required decisions are included in the decisions section
5. **Tool Authorization**: Confirm all 5 specified permissions (Read, Write, Edit, Bash, Glob, Grep) are documented
6. **Dependency Graph**: Show proper dependencies on pool_server_manager, wallet_manager, bitcoin_daemon_manager
7. **Success Criteria Alignment**: Map the 4 success criteria from section 2.1 to specific outputs/events
8. **Integration Points**: Demonstrate how this agent integrates with existing mining infrastructure agents

**CONFIDENCE:** High

**Reasoning:**
- Section 2.1 provides clear, detailed requirements for the miner_manager agent
- Existing agent definitions (especially wallet_manager.json) provide excellent schema template
- Requirements are well-scoped and achievable with specified tools (Bash for process control, Read/Write/Edit for config, Grep for log parsing)
- Similar agents (bitcoin_daemon_manager, pool_server_manager) provide reference patterns for lifecycle management
- All success criteria and test scenarios are directly addressable through the configuration schema
- The agent focuses on well-defined external software (cpuminer) rather than custom code development
- Decision points and error handling paths are clearly defined in requirements

[DECISION: design_complete]

DECISION: design_complete