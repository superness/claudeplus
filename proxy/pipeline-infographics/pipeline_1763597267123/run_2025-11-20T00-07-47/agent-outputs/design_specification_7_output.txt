Perfect! Now I have all the information I need to create a comprehensive plan.

---

**UNDERSTANDING:** User wants me to create a complete agent JSON specification for the `miner_manager` agent based on section 2.1 of MINING_CYCLE_AUTOMATION_PLAN.md. This agent should configure and run mining software (cpuminer), install/verify the miner, generate configuration, create/import wallets, start the miner with pool connection, monitor hashrate and submissions, and stop the miner gracefully. The agent should output decisions: miner_started, miner_stopped, miner_error, error. The file should be written to `/mnt/c/github/claudeplus/agents/miner_manager.json`.

**APPROACH:** 
1. Analyze section 2.1 (lines 115-186) of MINING_CYCLE_AUTOMATION_PLAN.md to extract all miner_manager requirements
2. Study the existing agent JSON structure patterns from bitcoin_daemon_manager.json and pool_server_manager.json to understand the schema format
3. Identify the conflicting miner_manager.json in the build directory (which handles pool-side miner connections) vs. the new requirement (which manages actual mining software execution)
4. Design a comprehensive agent specification that includes:
   - Basic agent metadata (name, type, group, version, description)
   - Configuration settings for miner software (cpuminer path, pool connection, wallet address)
   - Responsibilities as outlined in section 2.1
   - Input commands and events
   - Output events and status fields aligned with the required decisions
   - RPC endpoints for control and monitoring
   - Dependencies on other agents
   - Error handling strategies
   - Logging and metrics configuration
   - Validation rules
5. Write the complete JSON to the specified path

**STEPS:**
1. Use Read tool to examine section 2.1 (already completed - lines 165-186)
2. Use Read tool to examine existing agent patterns (already completed - bitcoin_daemon_manager.json and pool_server_manager.json)
3. Design the agent JSON structure with the following sections:
   - `agent_name`: "miner_manager"
   - `agent_type`: "infrastructure_core" (similar to bitcoin_daemon_manager)
   - `group`: 1 (infrastructure tier)
   - `version`: "1.0.0"
   - `description`: Based on line 166 - "Configure and run mining software"
   - `configuration`: Include miner_executable, pool_connection, wallet_address, mining_threads, health_check settings
   - `responsibilities`: Map from lines 169-174 capabilities
   - `inputs.commands`: install, verify, configure, start, stop, getHashrate, getStatus, healthCheck
   - `inputs.events`: pool_connected, pool_disconnected, emergency_stop_trigger
   - `outputs.events`: Include required decisions - miner_started, miner_stopped, miner_error, error, plus health/monitoring events
   - `outputs.status_fields`: process_id, uptime, hashrate, shares_submitted, shares_accepted, wallet_address
   - `rpc_endpoints`: POST /install, POST /start, POST /stop, GET /status, GET /hashrate, GET /health
   - `dependencies.agents`: ["pool_server_manager", "wallet_manager"]
   - `error_handling`: Strategies for installation failure, connection failure, miner crash, wallet missing
   - `logging`: Configuration for log files and events
   - `metrics`: Track hashrate, submission rate, uptime, crashes
   - `validation`: Schema and validation rules
4. Use Write tool to create `/mnt/c/github/claudeplus/agents/miner_manager.json` with the complete specification

**TEST_CONSIDERATIONS:**
The agent specification will handle these test scenarios:
- **Cold start installation**: The agent should detect if cpuminer is not installed and provide installation capabilities
- **Configuration generation**: Should create proper miner command-line arguments with pool URL, worker credentials, and wallet address
- **Wallet verification**: Should validate wallet address exists before starting mining
- **Connection monitoring**: Should track Stratum connection state and detect disconnections
- **Hashrate tracking**: Should monitor and report hashrate from miner output
- **Share monitoring**: Should parse miner logs to track submissions and acceptances
- **Graceful shutdown**: Should use proper signals (SIGTERM/SIGINT) to stop miner without corrupting state
- **Error recovery**: Should handle miner crashes, pool disconnections, and invalid configurations
- **Multiple start attempts**: Should detect if miner is already running before starting
- **Missing dependencies**: Should validate pool server is running before attempting connection

**EVIDENCE:**
I will provide:
1. Complete agent JSON file with all required sections
2. Properly formatted JSON matching the schema patterns from existing agents
3. All capabilities from section 2.1 mapped to configuration/responsibilities
4. All required decision outputs (miner_started, miner_stopped, miner_error, error)
5. Comprehensive error handling for miner-specific failure modes
6. RPC endpoints for all control operations
7. Dependencies properly declared for pool_server_manager and wallet_manager
8. Metrics and logging configurations for monitoring
9. File written to exact path: `/mnt/c/github/claudeplus/agents/miner_manager.json`

**CONFIDENCE:** High

This is a well-specified requirement with clear inputs (section 2.1 documentation), clear outputs (JSON file with specific decisions), and good examples of the JSON schema pattern from existing agents. The plan maps all capabilities from the documentation to agent configuration, includes comprehensive error handling, and follows the established patterns from bitcoin_daemon_manager.json.

[DECISION: design_complete]

DECISION: design_complete