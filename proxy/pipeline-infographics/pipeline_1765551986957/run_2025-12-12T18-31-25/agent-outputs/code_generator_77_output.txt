All critical issues have been fixed. Let me provide a summary of the changes made:

## Summary of Critical Fixes Made

### Files Modified:

**1. `/mnt/c/github/40kgw/output/src/index.ts`**
- Fixed import/export mismatch: Changed `initializePool/closePool` to `initializeDatabase/closeDatabase`

**2. `/mnt/c/github/40kgw/output/src/services/auth.service.ts`** (NEW)
- Created complete auth service with:
  - bcrypt password hashing (12 rounds)
  - JWT token generation/verification
  - Refresh token management with secure token generation
  - Account lockout after failed login attempts
  - Token rotation on refresh
  - Periodic cleanup of expired tokens

**3. `/mnt/c/github/40kgw/output/src/data/database.ts`**
- Fixed SQL injection vulnerabilities:
  - Added table name whitelist validation
  - Added column name format validation (regex + SQL keyword blacklist)
  - Added orderBy column whitelist
  - Added proper identifier quoting
- Fixed SSL configuration: `rejectUnauthorized` is now `true` in production

**4. `/mnt/c/github/40kgw/output/src/api/index.ts`**
- Added Helmet.js security middleware with CSP, HSTS
- Fixed `authMiddleware` to actually validate JWT tokens
- Fixed `characterOwnershipMiddleware` with UUID validation
- Fixed rate limiting memory leak with cleanup interval
- Removed duplicate imports
- Added CORS configuration
- Added `sanitize` utilities for input sanitization (XSS prevention)
- Extended Express Request type properly

**5. `/mnt/c/github/40kgw/output/src/api/auth.api.ts`**
- Implemented actual registration with password hashing
- Implemented actual login with credential verification
- Implemented token refresh with rotation
- Proper error handling with appropriate HTTP status codes

**6. `/mnt/c/github/40kgw/output/src/api/combat.api.ts`**
- Fixed WebSocket URL parsing bug (handles missing/malformed URLs)
- Implemented WebSocket authentication with JWT verification
- Added heartbeat/ping-pong for connection health
- Added proper error codes for WebSocket close

**7. `/mnt/c/github/40kgw/output/src/data/repositories/account.repository.ts`**
- Added `findByDisplayName` method
- Added `displayNameExists` method
- Added `display_name` field to row mapping

**8. `/mnt/c/github/40kgw/output/src/services/index.ts`**
- Added auth.service export

DECISION: code_complete