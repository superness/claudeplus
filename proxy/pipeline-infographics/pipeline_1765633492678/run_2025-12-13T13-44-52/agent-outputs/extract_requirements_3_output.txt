I have now extracted all the relevant design specifications for Companion AI Skill Execution from the design documents. Let me compile the complete requirements.

## Feature: Companion AI Skill Execution

### Specifications from Design Docs

#### Technical Requirements

From `henchmen-heroes-design.md` lines 607-642:
```
AI DECISION TREE (Every 0.5 seconds)

1. SURVIVAL CHECK
   ├── Health < 25%? → Emergency survival skill
   ├── Health < 50% + defensive skill ready? → Use defensive
   └── Continue to next check

2. SUPPORT CHECK (Healers/Support only)
   ├── Ally below 40% HP? → Heal priority target
   ├── Ally has dangerous condition? → Cleanse
   ├── Buff expired on priority ally? → Rebuff
   └── Continue to next check

3. CONTROL CHECK (Tank/Control roles)
   ├── Enemy attacking ally? → Taunt if available
   ├── Enemy casting dangerous skill? → Interrupt
   ├── Enemy fleeing? → Control/slow
   └── Continue to next check

4. DAMAGE CHECK
   ├── Marked enemy in range? → Attack marked
   ├── Lowest HP enemy in range? → Attack lowest
   ├── Closest enemy in range? → Attack closest
   └── Move toward nearest valid target

5. POSITIONING
   ├── Ranged: Maintain 600-1000 range
   ├── Melee: Close to melee range
   ├── Healers: Stay behind frontline
   └── Tanks: Position between enemies and allies
```

#### Role-Specific AI Behaviors

From `henchmen-heroes-design.md` lines 646-728:

**Tank AI** (lines 648-668):
```
TANK AI PRIORITY

THREAT MAINTENANCE:
├── Track threat on all enemies
├── Prioritize highest-threat enemy
├── Use taunt when threat drops below threshold
├── Position to intercept enemy charges
└── Block line of sight to ranged allies

DEFENSIVE TIMING:
├── Major cooldowns: Save for boss attacks
├── Minor cooldowns: Use on sustained damage
├── Emergency skills: Below 25% HP only
└── Never use immunity while full HP

POSITIONING:
├── Always frontline (closest to enemies)
├── Face enemies (frontal block)
├── Maintain aggro range on all enemies
└── Retreat only if ordered (Passive stance)
```

**Healer AI** (lines 672-698):
```
HEALER AI PRIORITY

HEAL PRIORITY:
1. Self (if < 30% HP)
2. Tank (if < 50% HP)
3. Lowest HP ally (if < 60% HP)
4. Player character (if < 80% HP)
5. Any ally if heal will be fully utilized

CONDITION MANAGEMENT:
├── Cleanse: Stun > Control > Damage conditions
├── Prioritize dangerous conditions
├── Save big cleanses for multi-condition
└── Use preventive buffs during downtime

MANA MANAGEMENT:
├── Don't overheal (waste)
├── Maintain 30%+ energy for emergencies
├── Use efficient heals over big heals
└── Regen skills during low-damage phases

POSITIONING:
├── Backline (1000+ range from enemies)
├── Line of sight to all allies
├── Near terrain for cover
└── Escape route planned
```

**DPS AI** (lines 702-728):
```
DPS AI PRIORITY

TARGET SELECTION:
1. Marked enemy (highest priority)
2. Enemy attacking healer
3. Lowest HP enemy (execute range)
4. Closest enemy
5. Random if tied

BURST TIMING:
├── Use cooldowns on marked targets
├── Save AoE for grouped enemies (3+)
├── Execute skills on targets < 25% HP
└── Save elite for boss/high-value targets

POSITIONING:
├── Ranged: Maintain optimal range (600-1000)
├── Melee: Flank when possible
├── Avoid cleave attacks
└── Stack for AoE heals

SAFETY:
├── Retreat if health < 25%
├── Use survival skills proactively
├── Don't chase beyond healer range
└── Follow tank positioning
```

#### Behavior Configuration Options

From `henchmen-heroes-design.md` lines 730-763:
```
PLAYER-CONFIGURABLE BEHAVIOR

COMBAT STANCE:
├── AGGRESSIVE: +15% damage, -15% survival
│   └── Uses offensive skills on cooldown
├── BALANCED: Default behavior
│   └── Context-aware decision making
├── DEFENSIVE: -15% damage, +15% survival
│   └── Prioritizes survival and support
└── PASSIVE: Follows player, minimal action
    └── Only attacks when attacked

TARGET PRIORITY (Dropdown):
├── Marked First: Always attack marked enemies
├── Player's Target: Attack what player attacks
├── Lowest HP: Execute strategy
├── Closest: Cleave/AoE optimization
└── Highest HP: Focus fire big targets

HEAL PRIORITY (Healers only):
├── Self First: Survive to heal others
├── Tank First: Keep tank alive
├── Lowest First: Save critical allies
└── Player First: VIP protection

POSITION PREFERENCE:
├── Frontline: Tank position
├── Midline: Melee DPS position
├── Backline: Ranged/Healer position
└── Follow Player: Stay within 200 range
```

#### Effectiveness Values

From `henchmen-heroes-design.md` lines 900-932:
```
EFFECTIVENESS FORMULA

HENCHMEN (70% effectiveness):
├── DPS: Player DPS × 0.70
├── Healing: Player healing × 0.70
├── Survivability: Player HP × 0.80 (slightly tankier)
├── AI Efficiency: ~90% optimal skill usage
└── Net Party Value: ~60% of a player

HEROES (90% effectiveness):
├── DPS: Player DPS × 0.90
├── Healing: Player healing × 0.90
├── Survivability: Player HP × 0.90
├── AI Efficiency: ~95% optimal skill usage
└── Net Party Value: ~85% of a player
```

#### AI Decision Update Interval

From `henchmen-heroes-design.md` line 612:
```
AI DECISION TREE (Every 0.5 seconds)
```

#### Henchman-Specific AI Examples

From `henchmen-heroes-design.md` lines 148-183 (Militant Elena):
```
AI Priority: Attack > Heal self > Heal allies
```

From `henchmen-heroes-design.md` lines 178-184 (Crusader Marcus):
```
AI BEHAVIOR:
├── PRIORITY: Maintain threat on highest danger enemy
├── Uses Provoke on cooldown
├── Uses defensives when health < 50%
├── Positions between enemies and allies
└── Does NOT chase fleeing enemies
```

From `henchmen-heroes-design.md` lines 216-222 (Shas'la Kais):
```
AI BEHAVIOR:
├── Maintains max range from enemies
├── Uses Markerlight on priority targets
├── Focus fires marked enemies
├── Retreats if enemies close to melee
└── Uses Mont'ka for burst windows
```

From `henchmen-heroes-design.md` lines 254-260 (Gutsmasha):
```
AI BEHAVIOR:
├── ALWAYS charges to melee
├── Prioritizes wounded enemies (execute)
├── Uses survival skills below 40% HP
├── Never retreats (Orks don't run!)
└── Generates WAAAGH! for Weirdboy allies
```

#### Hero AI Behavior Configuration

From `henchmen-heroes-design.md` lines 389-394 (Sister Verity example):
```
AI BEHAVIOR CONFIGURATION:
├── AGGRESSIVE: Prioritize damage over survival
├── DEFENSIVE: Prioritize healing and protection
├── BALANCED: Context-aware (default)
└── PASSIVE: Follow and support only
```

#### Required AI Efficiency Levels

From `henchmen-heroes-design.md` lines 1169-1174 (Phase 1 - Henchmen):
```
HENCHMEN AI:
├── Simple priority system
├── Role-appropriate behavior
├── No configuration options
└── Reliable but not optimal
```

From `henchmen-heroes-design.md` lines 1196-1201 (Phase 2 - Heroes):
```
HERO AI:
├── Full priority system
├── Player-configurable stances
├── Target priority options
├── Heal priority options
└── 90%+ optimal behavior
```

#### Skill Execution Mechanics

From `combat-design.md` lines 22-39:
```
COMBAT FLOW

Real-Time Movement + Skill-Based Abilities
├── No auto-attack (all damage from skills)
├── 8-skill hotbar (Guild Wars 1 style)
├── Skills have activation times (0.25-3 seconds)
├── Skill queue allows 1 action buffer
├── Movement during activation (varies by skill)
└── No global cooldown (individual skill cooldowns)
```

### Implementation Checklist

[ ] **Wire up the callback** - Register `partyManager.onCompanionDecisionCallback()` in `Game.ts` to receive AI decisions
[ ] **Route decisions to CombatManager** - When AI decides `action: 'SKILL'`, call CombatManager to execute the skill
[ ] **Execute companion skills** - Companions use same skill execution path as player (damage calculation, cooldowns, energy costs)
[ ] **Apply effectiveness multiplier** - Henchmen at 70% effectiveness, Heroes at 90% effectiveness
[ ] **Validate skill usage** - Check cooldowns, energy cost, range requirements before execution
[ ] **Update companion state** - Track cooldowns per companion, deduct energy
[ ] **Apply positioning behavior** - Ranged maintain 600-1000 range, melee close to targets, tanks stay frontline
[ ] **Implement role-specific priorities** - Tank prioritizes taunt, Healer prioritizes healing, DPS prioritizes damage
[ ] **Visual feedback** - Show skill effects/animations when companions use skills
[ ] **Combat log integration** - Log companion skill usage to combat log

### Key Values Summary

| Parameter | Value |
|-----------|-------|
| AI decision interval | 0.5 seconds |
| Henchman effectiveness | 70% |
| Hero effectiveness | 90% |
| Henchman AI efficiency | ~90% optimal |
| Hero AI efficiency | ~95% optimal |
| Ranged optimal range | 600-1000 units |
| Follow player range | 200 units |
| Healer backline range | 1000+ units from enemies |
| Health threshold for retreat | < 25% |
| Health threshold for emergency skills | < 25% |
| Health threshold for defensive skills | < 50% |
| Heal trigger threshold (ally) | < 40% HP |
| Tank heal priority threshold | < 50% HP |
| Healer self-heal threshold | < 30% HP |
| Player heal threshold | < 80% HP |

DECISION: requirements_extracted