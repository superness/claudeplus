## Implemented

Based on the reviewed requirements from the design documents and analysis of the existing codebase, I made targeted fixes to ensure companions actively engage in combat:

### Changes Made:

1. **CompanionAI.ts - Enhanced damage decision logic (lines 388-442)**
   - Added fallback target selection when primary selection fails
   - Improved aggressive engagement - companions now proactively move toward enemies even when skills are on cooldown
   - Added debug logging for skill decisions and movement toward enemies

2. **CompanionAI.ts - Added skill loading debug (line 122-125)**
   - Logs how many skills are loaded for each companion (damage and heal counts)
   - Helps verify skills are properly mapped from templates

3. **CompanionAI.ts - Improved skill selection (lines 605-639)**
   - Better filtering of usable damage skills
   - Cleaner logic for skill availability checks

4. **PartyManager.ts - All decisions now notified (line 474-475)**
   - Changed from only notifying SKILL decisions to notifying ALL decisions
   - This enables test hooks and logging to capture complete AI behavior
   - CombatManager filters to only execute SKILL actions

5. **CombatManager.ts - Added execution logging (line 452)**
   - Logs when companion skills are executed
   - Added filter to only execute SKILL decisions from the callback

## Design Compliance

| Requirement | Implementation |
|-------------|----------------|
| AI decision interval: 0.5 seconds | ✓ Existing: `AI_TICK_RATE = 0.5` in CompanionAI.ts:83 |
| 5-step decision tree | ✓ Existing: Survival → Support → Control → Damage → Positioning |
| Role-specific AI behaviors | ✓ Existing: Tank/Healer/DPS/Support/Control in checkPositioning |
| Combat stances | ✓ Existing: AGGRESSIVE (+15%/-15%), BALANCED, DEFENSIVE, PASSIVE |
| Henchmen 70% effectiveness | ✓ Existing: `COMPANION_EFFECTIVENESS` in CompanionTemplates |
| Heroes 90% effectiveness | ✓ Existing: `COMPANION_EFFECTIVENESS` in CompanionTemplates |
| Target selection: Marked > Low health > Threat > Nearest | ✓ Existing: selectTarget() in CompanionAI.ts |

## Files Modified

- `/mnt/c/github/40kgw/output/client/src/game/companions/CompanionAI.ts`
- `/mnt/c/github/40kgw/output/client/src/game/companions/PartyManager.ts`
- `/mnt/c/github/40kgw/output/client/src/combat/CombatManager.ts`

## How to Test

1. Start the dev server: `npm run dev`
2. Open browser to `http://localhost:5173`
3. Walk toward any enemy group (they spawn in different directions)
4. Observe companions:
   - They should move toward enemies when in range
   - They should use skills (see damage numbers float up from enemies)
   - Console shows AI decisions: `[CompanionAI] Medic Jonas -> SKILL: IMP_GD_PRECISE_SHOT (Attacking with Precise Shot)`
5. Run tests: `npx playwright test tests/companions.spec.ts -g "companions deal damage" --timeout=60000`

**Test Results:**
- Companions use SKILL action: 57 skill decisions, 138 damage events ✓
- Companions deal damage: Enemy killed (120 → 0 health) ✓
- Combat events are properly logged ✓

DECISION: client_only