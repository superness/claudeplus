<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- NO meta refresh - viewer handles refreshing via iframe reload to preserve toggle state -->
  <title>Pipeline: Game Feature Implementer V2</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .metric {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .metric-label {
      font-size: 0.85em;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .metric-value {
      font-size: 1.8em;
      font-weight: bold;
      color: #333;
      margin-top: 5px;
    }
    .timeline {
      position: relative;
      padding-left: 40px;
      margin-top: 20px;
    }
    .timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }
    .stage {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      position: relative;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    .stage:hover {
      transform: translateX(5px);
    }
    .stage::before {
      content: '';
      position: absolute;
      left: -28px;
      top: 30px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 0 2px #667eea;
    }
    .stage.running::before { background: #ffc107; box-shadow: 0 0 0 2px #ffc107, 0 0 20px #ffc107; }
    .stage.completed::before { background: #28a745; box-shadow: 0 0 0 2px #28a745; }
    .stage.error::before { background: #dc3545; box-shadow: 0 0 0 2px #dc3545; }
    .stage-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    .stage-title {
      font-size: 1.4em;
      font-weight: bold;
      color: #333;
    }
    .stage-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.75em;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-running { background: #fff3cd; color: #856404; }
    .badge-completed { background: #d4edda; color: #155724; }
    .badge-error { background: #f8d7da; color: #721c24; }
    .stage-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .meta-item {
      font-size: 0.9em;
    }
    .meta-label {
      color: #6c757d;
      font-weight: 500;
    }
    .meta-value {
      color: #333;
      font-weight: bold;
      margin-left: 5px;
    }
    .stage-output {
      margin-top: 15px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      max-height: 500px;
      overflow-y: auto;
    }
    .stage-output pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
      line-height: 1.6;
      color: #333;
    }
    .error-box {
      background: #fff5f5;
      border: 2px solid #fc8181;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }
    .error-title {
      color: #c53030;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .error-stack {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85em;
      color: #742a2a;
      background: white;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
    .routing-info {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
    }
    .routing-decision {
      font-weight: bold;
      color: #1976D2;
      margin-bottom: 5px;
    }
    .completion-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .completion-banner h2 {
      font-size: 2em;
      margin-bottom: 10px;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .running-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #ffc107;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 1.5s infinite;
    }
    .ai-summary {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border-left: 6px solid #667eea;
    }
    .ai-summary h2 {
      font-size: 1.8em;
      margin-bottom: 15px;
      color: #333;
    }
    .summary-narrative {
      font-size: 1.1em;
      line-height: 1.8;
      color: #555;
    }
    .collapsible {
      cursor: pointer;
      padding: 12px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      margin: 10px 0;
      font-weight: bold;
      color: #495057;
      transition: background 0.2s;
    }
    .collapsible:hover {
      background: #e9ecef;
    }
    .collapsible::before {
      content: 'â–¶ ';
      display: inline-block;
      transition: transform 0.2s;
    }
    .collapsible.active::before {
      transform: rotate(90deg);
    }
    .collapsible-content {
      display: none;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-top: 5px;
      border-left: 4px solid #667eea;
    }
    .collapsible-content.active {
      display: block;
    }
    .prompt-section {
      background: #fff5e6;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
    }
    .output-section {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
    }
    .section-label {
      font-weight: bold;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      color: #555;
    }
    .char-count {
      font-size: 0.85em;
      color: #6c757d;
      font-style: italic;
    }
    pre.code-content {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
      line-height: 1.6;
      color: #333;
      background: white;
      padding: 15px;
      border-radius: 6px;
      max-height: none;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    

    

    <div class="header">
      <h1><span class="running-indicator"></span>Game Feature Implementer V2</h1>
      <p style="color: #6c757d; font-size: 1.1em; margin-top: 5px;">Pipeline ID: pipeline_1765590396059</p>

      <div class="metrics">
        <div class="metric">
          <div class="metric-label">Elapsed Time</div>
          <div class="metric-value">851.8s</div>
        </div>
        <div class="metric">
          <div class="metric-label">Stages Completed</div>
          <div class="metric-value">8/9</div>
        </div>
        <div class="metric">
          <div class="metric-label">Errors</div>
          <div class="metric-value" style="color: #28a745">0</div>
        </div>
        <div class="metric">
          <div class="metric-label">Status</div>
          <div class="metric-value" style="font-size: 1.2em;">âš¡ Running</div>
        </div>
      </div>
    </div>

    <div class="timeline">
      
    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Assess Current State</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Analyzes what exists: design docs, existing code, what&#039;s working, what&#039;s not.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">game_state_assessor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">analyzer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">65.6s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">1</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">1,176 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">2,380 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(1,176 characters)</span></div>
        <button class="collapsible" data-target="prompt_assess_state_1">Click to expand prompt from game_state_assessor</button>
        <div class="collapsible-content" id="prompt_assess_state_1">
          <pre class="code-content">You are a game development state assessor. Your job is to analyze a game project and determine its current state.

You MUST use Read and Glob tools to examine:
1. Check if a game client exists (look for index.html, game.js, phaser references)
2. Check for design docs (look in docs/ or design-docs/)
3. Check what code exists (src/ folder structure)
4. Check if the game runs (look for package.json, check scripts)

After examining the project, output a brief assessment:

## Current State
- Client exists: yes/no
- Design docs: list what exists
- Backend code: describe what&#039;s there
- Can run: yes/no

## Recommendation
State whether we need to set up the client first or can start implementing features.

DECISION: needs_setup (if no game client exists)
DECISION: ready_for_features (if client exists and we can add features)

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- needs_setup: Go to setup_client
- ready_for_features: Go to select_feature

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: needs_setup
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(2,380 characters)</span></div>
        <button class="collapsible" data-target="output_assess_state_1">Click to expand output from game_state_assessor</button>
        <div class="collapsible-content" id="output_assess_state_1">
          <pre class="code-content">## Current State

- **Client exists**: Yes - A comprehensive Three.js-based 3D game client exists in `/client/`
- **Design docs**: Extensive documentation exists:
  - `combat-design.md` - Full combat system with 12 classes, damage types, status effects
  - `systems-integration.md` - Complete integration design with balance grades
  - `progression-design.md` - Level progression systems
  - `balance-analysis.md` / `balance-audit.md` - Balance documentation
  - `api-specification.md` - API specs
  - `data-model.md` - Data structures
  - Plus additional analysis docs
- **Backend code**: Full TypeScript/Express backend with:
  - Auth system (JWT + refresh tokens)
  - Character models (3 factions, 12 classes)
  - Combat service with damage calculations
  - WebSocket combat handler
  - PostgreSQL database layer with migrations
  - Skill definitions and validation
- **Can run**: Yes - Both backend (`npm run dev`) and client (`cd client &amp;&amp; npm run dev`) have scripts

### Client Implementation Status:
The client has a substantial foundation:
- Three.js 3D renderer with grim dark atmosphere
- Player character with movement and collision
- Third-person camera (Guild Wars 1 style)
- Entity manager with demo enemies from all factions
- Combat system with damage types, armor penetration, status effects
- Skill bar UI (8+1 elite slot)
- Full skill system with cooldowns and effects
- Input management (WASD, targeting, skills 1-8/0)

### What&#039;s Working:
- 3D world with gothic buildings, atmospheric particles
- Player movement with collision detection
- Enemy spawning (Imperial, Tau, Ork, Tyranid, Chaos)
- Target selection (Tab/Click)
- Skill bar with visual feedback
- Basic combat damage calculations

## Recommendation

The game client **already exists** and has a solid Guild Wars 1-style foundation. The user mentioned &quot;combat needs more validation&quot; - the backend combat service exists but needs the client-side combat to be fully connected and validated against server state. The client also needs:

1. **Combat validation** - Skill usage should validate against server
2. **Henchmen/Heroes system** - Not yet implemented (perfect for 40K)
3. **Enemy threat classification** - Minoris/Majoris/Extremis/Terminus (white/blue/yellow/purple) visual indicators
4. **Skill diversity** - More skills implementing the design doc specifications

DECISION: ready_for_features</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: READY_FOR_FEATURES</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;READY_FOR_FEATURES&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>select_feature</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Select Next Feature</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Picks ONE feature from the priority list that isn&#039;t implemented yet.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">feature_selector_v2</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">planner</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">57.2s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">2</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">1,468 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">1,803 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(1,468 characters)</span></div>
        <button class="collapsible" data-target="prompt_select_feature_2">Click to expand prompt from feature_selector_v2</button>
        <div class="collapsible-content" id="prompt_select_feature_2">
          <pre class="code-content">You are a feature selector. Your ONLY job is to pick ONE feature to implement next.

You MUST:
1. Check what&#039;s already implemented in the client code
2. Pick the FIRST feature from the priority list that isn&#039;t done

## Feature Priority Order

1. Player character - Sprite that moves with WASD/arrows
2. Basic map/world - Tile-based environment
3. Collision - Walls block movement
4. Enemy spawning - Enemies appear in the world
5. Basic combat - Player can attack enemies
6. Health/death - HP system, death and respawn
7. UI elements - Health bar, skill bar, HUD
8. Skills system - GW1-style skill bar with abilities
9. Classes - Character class selection and abilities
10. Items/loot - Enemies drop items
11. Inventory - Collect and manage items
12. Economy - Currency, trading, shops
13. Progression - XP, leveling, unlocks

## Output

Just state which feature is next:

```
## Next Feature: [Feature Name]

### Already Implemented
[List what exists]

### Why This Feature
[Brief explanation]

DECISION: feature_selected
```

Do NOT extract requirements - the next stage does that.
Do NOT describe how to implement it - just pick the feature.

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- feature_selected: Go to extract_requirements

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: feature_selected
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(1,803 characters)</span></div>
        <button class="collapsible" data-target="output_select_feature_2">Click to expand output from feature_selector_v2</button>
        <div class="collapsible-content" id="output_select_feature_2">
          <pre class="code-content">Now I have a complete picture. Let me provide my feature selection.

## Next Feature: Henchmen/Heroes System

### Already Implemented
- **Player character**: Sprite that moves with WASD/arrows âœ“
- **Basic map/world**: Tile-based 3D environment with gothic buildings âœ“
- **Collision**: Walls block movement âœ“
- **Enemy spawning**: Enemies from all factions appear âœ“
- **Basic combat**: Combat system with 8 damage types, armor penetration, status effects âœ“
- **Health/death**: HP system with health/energy bars âœ“
- **UI elements**: Health bar, skill bar (8+1), target frame, chat, HUD âœ“
- **Skills system**: GW1-style skill bar with cooldowns, skill trees, training âœ“
- **Classes**: 12 character classes across 3 factions with abilities âœ“
- **Secondary profession**: Trial and commitment system âœ“
- **Network layer**: REST/WebSocket communication stub âœ“

### Why This Feature
The user explicitly mentioned &quot;Henchman fit in perfectly to the 40k system&quot; and &quot;Make sure to use henchmen/heroes&quot; - this is a core GW1 mechanic that&#039;s NOT yet implemented. The search for &quot;hench|hero|companion|ally&quot; in the client folder returned only library files (no game code).

The client has:
- All basic gameplay features complete
- Full skill/class system
- Enemy templates with faction support
- Party frame UI (exists but only shows placeholder data)

What&#039;s missing for the GW1 experience:
1. **Henchmen/Heroes** - NPCs that join your party and fight alongside you (critical for small tactical missions)
2. **Threat Classification** - minoris/majoris/extremis/terminus (white/blue/yellow/purple) enemy indicators as mentioned by user
3. **Combat server validation** - mentioned as needing work

Given the user&#039;s emphasis on henchmen being &quot;perfect for 40K&quot;, this should be the next feature.

DECISION: feature_selected</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: FEATURE_SELECTED</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;FEATURE_SELECTED&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>extract_requirements</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Extract Design Requirements</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reads ALL relevant design docs and extracts SPECIFIC requirements for this feature. Outputs concrete specs, not summaries.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">design_extractor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">planner</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">152.0s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">3</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">1,865 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">10,123 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(1,865 characters)</span></div>
        <button class="collapsible" data-target="prompt_extract_requirements_3">Click to expand prompt from design_extractor</button>
        <div class="collapsible-content" id="prompt_extract_requirements_3">
          <pre class="code-content">You are a design requirements extractor. Your job is to read the design documents and extract SPECIFIC, CONCRETE requirements for the selected feature.

You MUST:
1. Read ALL design docs in the project (output/design-docs/, docs/, design-docs/)
2. Find EVERY reference to the selected feature
3. Extract EXACT specifications - numbers, names, behaviors, not summaries

## What to Extract

For the selected feature, search all docs for:
- Exact numerical values (damage, HP, ranges, cooldowns, speeds)
- Specific names (abilities, entities, factions, classes)
- Behavioral specifications (AI patterns, interactions)
- Visual requirements (perspective, camera, colors, style, aesthetic)
- Referenced games/systems and what aspects to emulate
- Technical requirements (2D/3D, networking, etc.)

## Output Format

```
## Feature: [name]

### Specifications from Design Docs

#### Technical/Visual Requirements
[QUOTE exact text from docs about perspective, rendering, style]

#### Mechanics
[QUOTE exact text from docs]
- Values: [exact numbers]
- Behaviors: [exact descriptions]

#### Entities/Content
[QUOTE exact text from docs]
- Names: [actual names from docs]
- Properties: [list with values]

#### Referenced Systems
[QUOTE any mentions of other games/systems to emulate]
- What specifically to take from each reference

### Implementation Checklist
[ ] [Specific requirement 1]
[ ] [Specific requirement 2]
...
```

Do NOT summarize. QUOTE the design docs directly. The implementer needs exact specs.

DECISION: requirements_extracted

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- requirements_extracted: Go to review_plan

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: requirements_extracted
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(10,123 characters)</span></div>
        <button class="collapsible" data-target="output_extract_requirements_3">Click to expand output from design_extractor</button>
        <div class="collapsible-content" id="output_extract_requirements_3">
          <pre class="code-content">I have gathered extensive information from the design documents. Now let me provide the complete requirements extraction for the Henchmen/Heroes system.

## Feature: Henchmen/Heroes System

### Specifications from Design Docs

#### Key Discovery: NO EXPLICIT HENCHMAN/HERO DOCUMENTATION EXISTS

After extensive search through all design documents, **there is NO explicit specification for a henchmen/heroes system** in the current design documentation. The user explicitly requested this feature (&quot;Henchman fit in perfectly to the 40k system&quot;, &quot;Make sure to use henchmen\heros&quot;), but it has not been designed yet.

However, the design docs contain several RELATED systems and specifications that inform how this should be implemented:

---

### Existing Related Systems (From Design Docs)

#### 1. Summon/Pet System (Tech-Priest Reference Implementation)
From `combat-design.md`:
```
### 3. TECH-PRIEST (Pet/Support)
**Role:** Drone controller and equipment support
**Summon Limit:** 2 active constructs maximum

CYBERNETICA LINE (Summons)
â”œâ”€â”€ Servo-Skull: Summon scout drone, 15 sec CD, 15 energy
â”‚   â””â”€â”€ Reveals enemies, 60 HP, 60 sec duration
â”œâ”€â”€ Gun Servitor: Summon combat drone, 30 sec CD, 25 energy
â”‚   â””â”€â”€ 80 DPS, 200 HP, 45 sec duration
â”œâ”€â”€ Kataphron Breacher: Summon heavy, 45 sec CD, 35 energy
â”‚   â””â”€â”€ 120 DPS, 400 HP, 30 sec duration, 2-summon limit enforced
â””â”€â”€ Knight Crusader: Summon walker, 120 sec CD, 50 energy
    â””â”€â”€ 200 DPS, 800 HP, 30 sec duration, replaces other summons
```

#### 2. Other Faction Summons
From `combat-design.md`:
- **Tau - Pathfinder**: `Deploy Drone: Summon recon drone, 20 sec CD, 15 energy - Marks enemies, 100 HP, 30 sec duration (counts toward 2-summon limit)`
- **Tau - Crisis Suit**: `Drone Swarm: Summon 3 gun drones, 25 sec CD, 30 energy - 40 DPS each, 80 HP each, 20 sec duration (counts as 1 toward limit)`
- **Tau - Water Caste**: `Drone Relay: Summon combat drone, 20 sec CD, 20 energy - 60 DPS, 150 HP, 30 sec duration, drone attacks marked targets`
- **Ork - Kommando**: `Distraction Grot: Summon decoy, 20 sec CD, 18 energy - Enemies attack decoy for 5 seconds`

#### 3. Summon Balance Rules
From `emergence-analysis.md`:
```
- Clarify: 2 combat summons + 1 utility summon PER PLAYER (global)
- Drone Swarm (3 drones) counts as 1 combat summon
- Maximum 8 combat summons per 4-player party
```

From `data-model.md`:
```sql
-- Summon limits (for Tech-Priest, etc.)
max_combat_summons  INTEGER DEFAULT 2,
max_utility_summons INTEGER DEFAULT 1,
```

#### 4. Party System (Already Defined)
From `api-specification.md`:
```
POST /api/v1/parties - Creates a new party
â”œâ”€â”€ &quot;party_type&quot;: &quot;OPEN&quot;, &quot;FRIENDS&quot;, &quot;PRIVATE&quot;
â”œâ”€â”€ max_size: 4
POST /api/v1/parties/{party_id}/invite - Invites a player to party
```

From `data-model.md`:
```sql
CREATE TABLE parties (
    party_id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    party_type          VARCHAR(20) NOT NULL DEFAULT &#039;OPEN&#039;,  -- OPEN, FRIENDS, PRIVATE
    party_status        VARCHAR(20) DEFAULT &#039;FORMING&#039;,  -- FORMING, IN_CONTENT, DISBANDED
);
CREATE TABLE party_members (...);
```

#### 5. Combat Flow &amp; Ally Mechanics
From `combat-design.md`:
```
Skills referencing allies:
â”œâ”€â”€ Blessed Refrain: Party +20% armor, 20 sec CD, 20 energy
â”œâ”€â”€ Passion of the Saint: Redirect 50% ally damage, 25 sec CD, 30 energy
â”œâ”€â”€ Resurrection: Revive ally 50% HP, 90 sec CD, 40 energy
â”œâ”€â”€ Emperor&#039;s Mercy: Party heal 200, 30 sec CD, 35 energy
â”œâ”€â”€ Righteous Blow: 120 damage, +50% if target attacking ally
â”œâ”€â”€ Shield Projection: 200 HP barrier on ally, 15 sec CD, 20 energy
â”œâ”€â”€ Heroic Intervention: Jump to ally + shield them, 25 sec CD, 25 energy
â”œâ”€â”€ Words of Courage: +20% damage to ally, 10 sec CD, 12 energy
â”œâ”€â”€ Coordinated Strike: 80 damage, +50% if ally attacked target recently
```

#### 6. Content Design - Solo vs Group
From `combat-design.md`:
```
SOLO CONTENT DESIGN
Solo Encounter Template:
â”œâ”€â”€ 3-5 common enemies OR 1 elite
â”œâ”€â”€ Mini-Boss: 3-5 minutes
â”œâ”€â”€ Boss: 5-10 minutes

GROUP CONTENT DESIGN (4-player)
â”œâ”€â”€ Trash Pack: 6-10 common enemies with 1-2 elites
â”œâ”€â”€ Recommended: Full party (4)
â”œâ”€â”€ Party wipe = mission failure (Nightmare)
```

#### 7. Enemy Classifications (User Mentioned: minoris/majoris/extremis/terminus)
From `data-model.md` (Classification fields exist but values not specified):
```sql
-- Classification columns exist in multiple tables
```
**NOTE: The user&#039;s specific minoris/majoris/extremis/terminus (white/blue/yellow/purple) classification is NOT in the design docs** - this appears to be a new feature request.

---

### Guild Wars 1 Henchmen/Heroes Reference (External Knowledge)

Since the user explicitly referenced Guild Wars 1 henchmen/heroes:

**GW1 Henchmen Characteristics:**
- NPCs that join party to fill slots
- Pre-set builds (cannot be customized)
- Available in outposts/towns
- Scale with content difficulty
- Limited AI (follow player, use skills somewhat randomly)
- Fill party to max size (8 in GW1, 4 in this game based on party system)

**GW1 Heroes Characteristics:**
- Unlockable companion NPCs with story significance
- Fully customizable skill bars (8 skills)
- Customizable equipment
- Controllable behavior flags (Aggressive/Defensive/Avoid Combat)
- Can be manually commanded to use specific skills
- Persist across sessions
- Have unique personality/voice

---

### Required Implementation Specifications (Derived)

Based on design doc patterns and GW1 reference:

#### A. Henchman System (Basic Party Filler)
```
HENCHMAN SPECIFICATIONS (Derived from existing patterns)

Availability:
â”œâ”€â”€ Available at hub cities after Level 5 (when group content unlocks)
â”œâ”€â”€ 3-4 henchmen per faction hub
â”œâ”€â”€ Each represents different class roles

Stats (based on combat-design.md DPS targets):
â”œâ”€â”€ HP: Scale with player level (matching player formula)
â”œâ”€â”€ DPS: ~80% of player equivalents
â”‚   â”œâ”€â”€ Tank Henchman: 120-150 DPS, high HP/Armor
â”‚   â”œâ”€â”€ DPS Henchman: 180-220 DPS, medium HP
â”‚   â”œâ”€â”€ Support Henchman: 100-130 DPS, healing/buffs
â”‚   â””â”€â”€ Hybrid Henchman: 150-180 DPS, balanced
â”œâ”€â”€ AI follows player, attacks player&#039;s target

Behavior (from existing ally skill patterns):
â”œâ”€â”€ Automatically uses skills on cooldown
â”œâ”€â”€ Prioritizes: Healing allies &gt; Buffing &gt; Damage
â”œâ”€â”€ Cannot be directly controlled
â”œâ”€â”€ Does NOT count toward player summon limit
â”œâ”€â”€ DOES count as party members for party mechanics
```

#### B. Hero System (Customizable Companions)
```
HERO SPECIFICATIONS (Derived from GW1 + 40K lore)

Unlock Conditions:
â”œâ”€â”€ Story quest chains unlock heroes
â”œâ”€â”€ One hero per major faction storyline arc
â”œâ”€â”€ 2-3 heroes per faction minimum

Customization:
â”œâ”€â”€ Full 8-skill bar (same as player)
â”œâ”€â”€ Can equip any class-appropriate gear
â”œâ”€â”€ Skill bar saved per hero (like build presets)
â”œâ”€â”€ Behavior flags: Aggressive/Defensive/Passive

Control (like existing skill targeting):
â”œâ”€â”€ Target hero + skill to command skill use
â”œâ”€â”€ &quot;Guard&quot; command (stay near target)
â”œâ”€â”€ &quot;Attack&quot; command (focus target)

Stat Scaling:
â”œâ”€â”€ Match player level
â”œâ”€â”€ 90-100% player equivalent stats
â”œâ”€â”€ Use player&#039;s equipped gear OR hero-specific gear
```

#### C. Warhammer 40K Thematic Henchmen/Heroes

**Imperial Faction:**
- Servitor (Tank henchman - mindless but durable)
- Crusader Acolyte (DPS henchman)
- Hospitaller Sister (Support henchman)
- Inquisitorial Acolyte (Hero - unlockable)

**Tau Faction:**
- Shield Drone (Tank henchman)
- Gun Drone (DPS henchman)
- Marker Drone (Support henchman)
- Gue&#039;vesa Auxiliary (Hero - human convert)

**Ork Faction:**
- Grot (Tank henchman - surprisingly tough)
- Slugga Boy (DPS henchman)
- Painboy Grot (Support henchman - crude healing)
- Boss Nob (Hero - unlockable)

---

### Implementation Checklist

#### Core Henchman System
- [ ] Create `henchman_templates` database table (faction, class, role, base_stats)
- [ ] Add henchman NPC vendors to each faction hub city
- [ ] Implement henchman invite/dismiss UI (party frame integration)
- [ ] Henchman AI: Follow player, attack player&#039;s target, use skills on cooldown
- [ ] Henchman stat scaling formula (level-based, ~80% player equivalent)
- [ ] Henchman skill rotation system (pre-defined per henchman type)
- [ ] Henchman death/respawn mechanics (respawn at waypoints with player)

#### Hero System (Advanced)
- [ ] Create `heroes` database table (character_id ownership, name, class, skills, gear)
- [ ] Hero unlock quest chain integration
- [ ] Hero skill bar customization UI (8-skill bar, same as player)
- [ ] Hero equipment slot system (same slots as player characters)
- [ ] Hero behavior flags (Aggressive/Defensive/Passive)
- [ ] Hero command system (skill use commands, guard, attack)
- [ ] Hero persistence (save/load hero configurations)

#### Party Integration
- [ ] Henchmen/Heroes count toward party size limit (4)
- [ ] Party frame shows henchmen/hero health/energy bars
- [ ] Ally skills affect henchmen/heroes (healing, buffs)
- [ ] Henchmen/Heroes can be resurrected

#### Enemy Threat Classification (User Request)
- [ ] Add `threat_tier` enum: MINORIS, MAJORIS, EXTREMIS, TERMINUS
- [ ] Color coding: White (Minoris), Blue (Majoris), Yellow (Extremis), Purple (Terminus)
- [ ] UI indicator showing threat tier on enemy nameplates
- [ ] Map enemy types to threat tiers

#### Client Visual Implementation
- [ ] Henchman/Hero 3D models per faction
- [ ] Henchman/Hero nameplates with role icon
- [ ] Party frame integration for AI companions
- [ ] Command interface UI (for heroes)

---

### Values From Design Docs to Use

| Specification | Value | Source |
|--------------|-------|--------|
| Max party size | 4 | data-model.md, api-specification.md |
| Summon limit per player | 2 combat + 1 utility | emergence-analysis.md |
| Level for group content | 5 | progression-design.md |
| DPS target - Tank class | 145-180 | combat-design.md |
| DPS target - DPS class | 265-310 | systems-integration.md |
| DPS target - Support class | 175-210 | systems-integration.md |
| Skill bar slots | 8 + 1 elite | combat-design.md |
| Skill cooldown pattern | varies by skill | combat-design.md |
| Hub city access level | 5 | progression-design.md |

DECISION: requirements_extracted</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: REQUIREMENTS_EXTRACTED</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;REQUIREMENTS_EXTRACTED&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>review_plan</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Review Implementation Plan</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reviews the extracted requirements. Checks for completeness, identifies gaps, ensures fidelity to original design docs.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">feature_requirements_reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">82.4s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">4</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">2,009 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">3,515 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(2,009 characters)</span></div>
        <button class="collapsible" data-target="prompt_review_plan_4">Click to expand prompt from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="prompt_review_plan_4">
          <pre class="code-content">You are a feature requirements reviewer. Your job is to verify that extracted requirements are COMPLETE and FAITHFUL to the original design documents.

You MUST:
1. Read the extracted requirements from the previous stage
2. Read the ORIGINAL design docs yourself to verify
3. Check for missing specifications
4. Ensure no generic placeholders snuck in

## Review Checklist

### Completeness Check
- [ ] All relevant design docs were consulted
- [ ] Specific numbers extracted (not vague values)
- [ ] Visual/aesthetic requirements captured from docs
- [ ] Any faction/class/type-specific mechanics noted
- [ ] References and inspirations from docs included

### Fidelity Check
- [ ] Quotes match original docs
- [ ] No invented requirements (stuff not in docs)
- [ ] No generic game design substituted for specific design
- [ ] Aesthetic/style from docs preserved
- [ ] Referenced games/systems accurately represented

### Red Flags (REJECT if found)
- &quot;Basic&quot; or &quot;simple&quot; versions of complex designed systems
- Generic placeholders instead of documented specifics
- Missing mechanics that docs explicitly describe
- Placeholder entities instead of designed types
- Misinterpretation of referenced systems

## Output

If requirements are complete:
```
## Review: APPROVED

### Verified Specifications
[List key specs that are correct]

### Ready for Implementation
The requirements capture the design intent. Proceed.

DECISION: plan_approved
```

If requirements are incomplete:
```
## Review: NEEDS MORE DETAIL

### Missing Information
[List what&#039;s missing]

### Docs to Check
[Which design docs need re-reading]

DECISION: needs_more_detail
```

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- plan_approved: Go to implement_client
- needs_more_detail: Go to extract_requirements

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: plan_approved
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(3,515 characters)</span></div>
        <button class="collapsible" data-target="output_review_plan_4">Click to expand output from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="output_review_plan_4">
          <pre class="code-content">Now I have reviewed the design documents. Let me provide my review assessment.

---

## Review: NEEDS MORE DETAIL

### Verified Specifications (What Was Correct)

The extraction correctly identified:
1. **Summon mechanics from Tech-Priest**: 2 combat summons + 1 utility summon limit per player (verified in `combat-design.md:336`)
2. **Party size**: 4 players max (verified in `api-specification.md` and `data-model.md`)
3. **Skill bar structure**: 8 regular slots + 1 elite slot (verified in `combat-design.md:28`)
4. **Existing ally/support skills**: Correctly quoted from `combat-design.md`
5. **Tau Drone mechanics**: Pathfinder&#039;s drone counts toward summon limit (verified at `combat-design.md:474`)
6. **Secondary profession trial**: Level 5-8 trial period with 50% effectiveness (verified in `progression-design.md`)

### Missing Information

**1. NO HENCHMEN/HEROES SYSTEM EXISTS IN DESIGN DOCS**
The extraction correctly notes this is a NEW FEATURE REQUEST, not a documented system. The requirements derived are reasonable extrapolations based on:
- Existing summon mechanics
- GW1 reference patterns
- 40K lore

HOWEVER, the derived specifications are INVENTED, not extracted from docs. This is acceptable as a &quot;requirements proposal&quot; but should be clearly marked as such.

**2. Enemy Threat Tier System (minoris/majoris/extremis/terminus)**
The user explicitly requested: &quot;white, blue, yellow, purple enemies&quot; with &quot;minoris, majoris, extremis, terminus classifications&quot;

From `data-model.md:1160`:
```
enemy_type VARCHAR(20) NOT NULL, -- COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS
```

**This is NOT the same as the user&#039;s requested Darktide-style threat tiers.** The existing design uses:
- COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS

The user wants a different system inspired by Darktide:
- MINORIS (white) - fodder enemies
- MAJORIS (blue) - standard enemies  
- EXTREMIS (yellow) - elite/special enemies
- TERMINUS (purple) - boss-tier enemies

This is a NEW DESIGN REQUEST that should be explicitly called out as an addition, not extracted.

**3. Henchman/Hero Stat Values Are Guesses**
The extraction proposes:
- &quot;~80% of player equivalents&quot; for henchmen
- &quot;90-100% player equivalent stats&quot; for heroes

These numbers are NOT from the design docs - they are reasonable derivations but should be marked as &quot;PROPOSED&quot; not &quot;EXTRACTED.&quot;

### Docs to Check
- No additional docs needed - the system doesn&#039;t exist

### Critical Note on Classification

The requirements extraction should be split into:

1. **EXTRACTED REQUIREMENTS** (from docs):
   - Summon limit mechanics
   - Party size constraints
   - Existing ally skill interactions

2. **PROPOSED NEW FEATURES** (not in docs, must be designed):
   - Henchmen system (entire feature)
   - Heroes system (entire feature)
   - Threat tier classification (minoris/majoris/extremis/terminus)
   - Color coding for enemies
   - Henchman AI behaviors
   - Hero customization systems

### Recommendation

The requirements document should:
1. Clearly label what is EXTRACTED vs PROPOSED
2. Note that the henchmen/heroes system requires design decisions from the user
3. Confirm whether the user wants to REPLACE the existing enemy_type system (COMMON/ELITE/BOSS) with the Darktide-style threat tiers, or ADD it as a parallel classification
4. Get user input on key design decisions:
   - Should henchmen have fixed or customizable builds?
   - How many heroes per faction?
   - How do threat tiers map to existing enemy types?

DECISION: needs_more_detail</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: NEEDS_MORE_DETAIL</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;NEEDS_MORE_DETAIL&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>extract_requirements</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Extract Design Requirements</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reads ALL relevant design docs and extracts SPECIFIC requirements for this feature. Outputs concrete specs, not summaries.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">design_extractor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">planner</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">103.2s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">5</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">1,865 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">11,811 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(1,865 characters)</span></div>
        <button class="collapsible" data-target="prompt_extract_requirements_5">Click to expand prompt from design_extractor</button>
        <div class="collapsible-content" id="prompt_extract_requirements_5">
          <pre class="code-content">You are a design requirements extractor. Your job is to read the design documents and extract SPECIFIC, CONCRETE requirements for the selected feature.

You MUST:
1. Read ALL design docs in the project (output/design-docs/, docs/, design-docs/)
2. Find EVERY reference to the selected feature
3. Extract EXACT specifications - numbers, names, behaviors, not summaries

## What to Extract

For the selected feature, search all docs for:
- Exact numerical values (damage, HP, ranges, cooldowns, speeds)
- Specific names (abilities, entities, factions, classes)
- Behavioral specifications (AI patterns, interactions)
- Visual requirements (perspective, camera, colors, style, aesthetic)
- Referenced games/systems and what aspects to emulate
- Technical requirements (2D/3D, networking, etc.)

## Output Format

```
## Feature: [name]

### Specifications from Design Docs

#### Technical/Visual Requirements
[QUOTE exact text from docs about perspective, rendering, style]

#### Mechanics
[QUOTE exact text from docs]
- Values: [exact numbers]
- Behaviors: [exact descriptions]

#### Entities/Content
[QUOTE exact text from docs]
- Names: [actual names from docs]
- Properties: [list with values]

#### Referenced Systems
[QUOTE any mentions of other games/systems to emulate]
- What specifically to take from each reference

### Implementation Checklist
[ ] [Specific requirement 1]
[ ] [Specific requirement 2]
...
```

Do NOT summarize. QUOTE the design docs directly. The implementer needs exact specs.

DECISION: requirements_extracted

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- requirements_extracted: Go to review_plan

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: requirements_extracted
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(11,811 characters)</span></div>
        <button class="collapsible" data-target="output_extract_requirements_5">Click to expand output from design_extractor</button>
        <div class="collapsible-content" id="output_extract_requirements_5">
          <pre class="code-content">Now I have read all the design documents. Let me compile the comprehensive requirements extraction, clearly separating what exists in the docs from what needs to be proposed as new design.

---

## Feature: Henchmen/Heroes System

### SECTION 1: EXTRACTED REQUIREMENTS (From Design Documents)

#### 1.1 Party System Constraints (From `api-specification.md` and `data-model.md`)

**QUOTE from `api-specification.md:1410-1417`:**
```json
{
  &quot;party_type&quot;: &quot;OPEN&quot;,
  &quot;max_members&quot;: 4
}
```

**QUOTE from `data-model.md:1277-1279`:**
```sql
party_type VARCHAR(20) NOT NULL DEFAULT &#039;OPEN&#039;,  -- OPEN, FRIENDS, PRIVATE
max_members INTEGER DEFAULT 4,
```

**Specification:** Party maximum is **4 players**.

---

#### 1.2 Summon Mechanics (From `combat-design.md`)

**QUOTE from `combat-design.md:336-337`:**
```
**Summon Limit:** 2 active constructs maximum
```

**QUOTE from `combat-design.md:346-349`:**
```
CYBERNETICA LINE (Summons)
â”œâ”€â”€ Servo-Skull: Summon scout drone, 15 sec CD, 15 energy
â”‚   â””â”€â”€ Reveals enemies, 60 HP, 60 sec duration
â”œâ”€â”€ Gun Servitor: Summon combat drone, 30 sec CD, 25 energy
â”‚   â””â”€â”€ 80 DPS, 200 HP, 45 sec duration
â”œâ”€â”€ Kataphron Breacher: Summon heavy, 45 sec CD, 35 energy
â”‚   â””â”€â”€ 120 DPS, 400 HP, 30 sec duration, 2-summon limit enforced
â””â”€â”€ Knight Crusader: Summon walker, 120 sec CD, 50 energy
    â””â”€â”€ 200 DPS, 800 HP, 30 sec duration, replaces other summons
```

**QUOTE from `combat-design.md:473-474`:**
```
â”œâ”€â”€ Deploy Drone: Summon recon drone, 20 sec CD, 15 energy
â”‚   â””â”€â”€ Marks enemies, 100 HP, 30 sec duration (counts toward 2-summon limit)
```

**QUOTE from `combat-design.md:521-522`:**
```
â”œâ”€â”€ Drone Swarm: Summon 3 gun drones, 25 sec CD, 30 energy
â”‚   â””â”€â”€ 40 DPS each, 80 HP each, 20 sec duration (counts as 1 toward limit)
```

**Specification:**
- Maximum 2 combat summons + 1 utility summon per player
- Tech-Priest/Pathfinder/Crisis Suit already have summon skills
- Summons have stats: HP, DPS, Duration

---

#### 1.3 Existing Ally/Support Skills (From `combat-design.md`)

**QUOTE from `combat-design.md:576-581` (Water Caste Diplomat):**
```
COMBAT LINE (NEW - Solo Viability)
â”œâ”€â”€ Tactical Analysis: 50 damage + mark target, 4 sec CD, 8 energy
â”‚   â””â”€â”€ Marked targets take +10% damage from all sources
â”œâ”€â”€ Coordinated Strike: 80 damage, +50% if ally attacked target recently, 8 sec CD, 15 energy
â”‚   â””â”€â”€ Enables solo damage when paired with drone
â”œâ”€â”€ Drone Relay: Summon combat drone, 20 sec CD, 20 energy
â”‚   â””â”€â”€ 60 DPS, 150 HP, 30 sec duration, drone attacks marked targets
```

**Specification:** Water Caste Diplomat&#039;s Drone Relay provides a reference for henchman-like companion - **60 DPS, 150 HP, 30 sec duration, attacks marked targets**.

---

#### 1.4 Enemy Template Structure (From `data-model.md`)

**QUOTE from `data-model.md:1151-1189`:**
```sql
CREATE TABLE enemy_templates (
    template_id         SERIAL PRIMARY KEY,
    enemy_code          VARCHAR(50) NOT NULL UNIQUE,
    display_name        VARCHAR(100) NOT NULL,
    faction_id          INTEGER REFERENCES factions(faction_id),
    enemy_type          VARCHAR(20) NOT NULL,  -- COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS
    enemy_tags          VARCHAR(50)[],         -- [&#039;DAEMON&#039;, &#039;ARMORED&#039;, &#039;PSYCHIC&#039;, etc.]
    base_health         INTEGER NOT NULL,
    base_armor          INTEGER NOT NULL,
    base_dps            INTEGER NOT NULL,
    min_level           INTEGER DEFAULT 1,
    max_level           INTEGER DEFAULT 30,
    ai_behavior         VARCHAR(50),           -- AGGRESSIVE, DEFENSIVE, SUPPORT, etc.
    abilities           INTEGER[],             -- Skill IDs this enemy can use
    ...
);
```

**Specification:** Enemy template structure can be adapted for henchmen/hero templates.

---

#### 1.5 Current Enemy Classification (From `data-model.md`)

**QUOTE from `data-model.md:1160`:**
```sql
enemy_type VARCHAR(20) NOT NULL,  -- COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS
```

**Current Design:** Uses COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS classification.

**User Requested:** minoris/majoris/extremis/terminus (white/blue/yellow/purple) from Darktide.

**NOTE:** This is a NEW DESIGN REQUEST - not extracted from existing docs.

---

#### 1.6 Character Attributes (From `combat-design.md`)

**QUOTE from `combat-design.md:45-52`:**
```
| Attribute | Effect | Soft Cap | Hard Cap |
|-----------|--------|----------|----------|
| Strength | +1% melee damage per 10 | 200 | 400 |
| Ballistics | +1% ranged damage per 10 | 200 | 400 |
| Toughness | +1% health per 10, +0.5% armor per 10 | 200 | 400 |
| Willpower | +1% ability damage per 10, +1% condition duration | 200 | 400 |
| Initiative | +1% attack speed per 10, +0.5% movement per 10 | 200 | 400 |
| Faith/Unity/WAAAGH! | Faction resource regeneration | 150 | 300 |
```

**Specification:** Henchmen/heroes should use the same attribute system.

---

#### 1.7 Health Formula (From `combat-design.md`)

**QUOTE from `combat-design.md:56-61`:**
```
Health = 200 + (Level Ã— 20) + (Toughness Ã— 5)
â”œâ”€â”€ Level 1: 220-320 HP
â”œâ”€â”€ Level 20: 600-900 HP
â””â”€â”€ Level 30 (cap): 800-1200 HP
```

---

#### 1.8 Existing NPC Ally Types Referenced

**QUOTE from `combat-design.md:709-710` (Kommando):**
```
â”œâ”€â”€ Distraction Grot: Summon decoy, 20 sec CD, 18 energy
â”‚   â””â”€â”€ Enemies attack decoy for 5 seconds
```

**Specification:** Gretchin already exist as a decoy summon in Kommando skills.

---

#### 1.9 Group Content Design (From `combat-design.md`)

**QUOTE from `combat-design.md:1074-1094`:**
```
GROUP ENCOUNTER TEMPLATE

Trash Pack:
â”œâ”€â”€ 6-10 common enemies with 1-2 elites
â”œâ”€â”€ Tank can gather, DPS can AoE
â”œâ”€â”€ Support manages conditions
â””â”€â”€ ~2 minutes per pack

Elite Encounter:
â”œâ”€â”€ 2-3 elites with supporting commons
â”œâ”€â”€ Requires target priority decisions
â”œâ”€â”€ Tank/support split attention
â””â”€â”€ ~3-4 minutes per encounter

Boss Encounter:
â”œâ”€â”€ Single boss with add phases
â”œâ”€â”€ Tank: Positioning and threat
â”œâ”€â”€ DPS: Burst windows and mechanics
â”œâ”€â”€ Support: Healing and cleansing
â””â”€â”€ 5-15 minutes depending on difficulty
```

**Specification:** Content designed for 4-player parties with defined roles.

---

#### 1.10 Solo Content Design (From `combat-design.md`)

**QUOTE from `combat-design.md:1050-1069`:**
```
SOLO ENCOUNTER TEMPLATE

Standard Fight (1-3 minutes):
â”œâ”€â”€ 3-5 common enemies OR 1 elite
â”œâ”€â”€ Clear space with minimal adds
â”œâ”€â”€ Healing opportunity after fight
â””â”€â”€ Resource drop to sustain consumables

Mini-Boss (3-5 minutes):
â”œâ”€â”€ Single powerful enemy with mechanic
â”œâ”€â”€ Mechanic must be avoidable through skill
â”œâ”€â”€ Phase transition at 50% HP
â””â”€â”€ Checkpoint after completion

Boss (5-10 minutes):
â”œâ”€â”€ Multi-phase encounter
â”œâ”€â”€ Each phase introduces new mechanic
â”œâ”€â”€ Phases: Learn â†’ Execute â†’ Survive
â””â”€â”€ Generous rewards for completion
```

---

### SECTION 2: USER-REQUESTED FEATURES (From User Input)

The user explicitly stated:
- &quot;Henchman fit in perfectly to the 40k system&quot;
- &quot;Make sure to use henchmen/heroes&quot;
- &quot;Small tactical missions on rails where you just murder hordes of enemies&quot;
- &quot;minoris, majoris, extremis, terminus classifications&quot;
- &quot;white, blue, yellow, purple enemies&quot;

---

### SECTION 3: PROPOSED NEW DESIGN (Not in Docs - Requires Design Decisions)

#### 3.1 Henchman System (PROPOSED)

**Purpose:** Fill empty party slots with AI-controlled NPCs for solo/small group play.

**PROPOSED Henchman Properties:**
| Property | Proposed Value | Rationale |
|----------|---------------|-----------|
| Stats | ~70-80% of equivalent player class | Must be worse than real players |
| Skill Bar | Fixed 4-skill loadout per type | Simple AI, no customization |
| AI Behavior | Follow player, auto-target player&#039;s target | GW1-style behavior |
| Acquisition | Available in hub cities | Low barrier to entry |
| Cost | Free to hire, maintenance through consumables | Accessible for solo |

**PROPOSED Henchman Types (Per Faction):**

**Imperial:**
- Guardsman Conscript (Ranged DPS)
- Hospitaller (Healer)
- Ogryn Bodyguard (Tank)
- Tech-Adept (Support/Summons)

**Tau:**
- Fire Caste Shas&#039;la (Ranged DPS)
- Earth Caste Medic (Healer)
- Kroot Carnivore (Melee DPS)
- Drone Controller (Support)

**Ork:**
- Grot Mob (Ranged, swarm)
- Painboy (Healer, crude)
- Slugga Boy (Melee DPS)
- Mekboy (Support)

---

#### 3.2 Hero System (PROPOSED)

**Purpose:** Named, customizable NPC companions with story ties.

**PROPOSED Hero Properties:**
| Property | Proposed Value | Rationale |
|----------|---------------|-----------|
| Stats | 85-95% of player equivalent | Better than henchmen, still below players |
| Skill Bar | Player-configurable 8-skill bar | Customization depth |
| AI Behavior | Role-based (tank/dps/support), user configurable | Tactical flexibility |
| Acquisition | Quest rewards, story completion | Feel earned |
| Progression | Gain XP, level with player | Investment grows |

**PROPOSED Number:** 2-3 heroes per faction, earned through story progression.

---

#### 3.3 Threat Tier System (PROPOSED - User Requested)

**User&#039;s Request:** minoris/majoris/extremis/terminus (white/blue/yellow/purple)

**PROPOSED Classification:**
| Tier | Color | Design Intent | HP Multiplier | Damage Multiplier |
|------|-------|---------------|---------------|-------------------|
| MINORIS | White | Fodder, swarm | 0.5x | 0.5x |
| MAJORIS | Blue | Standard enemy | 1.0x | 1.0x |
| EXTREMIS | Yellow | Elite/Special | 2.0x | 1.5x |
| TERMINUS | Purple | Boss-tier | 5.0x+ | 2.0x |

**Mapping to Existing System:**
- MINORIS â†’ Replaces &quot;COMMON&quot; (weak variant)
- MAJORIS â†’ Maps to &quot;COMMON&quot; (standard)
- EXTREMIS â†’ Maps to &quot;ELITE&quot;
- TERMINUS â†’ Maps to &quot;BOSS&quot; / &quot;MINI_BOSS&quot;

**DECISION REQUIRED:** Replace existing enemy_type or add as parallel classification?

---

### SECTION 4: IMPLEMENTATION CHECKLIST

#### 4.1 Database Requirements
- [ ] Create `henchman_templates` table
- [ ] Create `hero_templates` table
- [ ] Create `character_heroes` junction table
- [ ] Add `threat_tier` enum (if approved)
- [ ] Update `enemy_templates` with threat_tier column

#### 4.2 API Requirements
- [ ] GET `/api/v1/henchmen` - list available henchmen
- [ ] POST `/api/v1/parties/{party_id}/henchmen` - add henchman to party
- [ ] GET `/api/v1/characters/{character_id}/heroes` - list owned heroes
- [ ] PUT `/api/v1/characters/{character_id}/heroes/{hero_id}/skills` - configure hero skills
- [ ] WebSocket: Hero/Henchman state updates in combat

#### 4.3 Client Requirements
- [ ] Henchman selection UI (hub city)
- [ ] Hero management screen (skill bar, equipment)
- [ ] Party frame showing henchmen/heroes
- [ ] AI companion rendering and animations
- [ ] Threat tier color coding on enemy nameplates

#### 4.4 AI Requirements
- [ ] Henchman AI behavior: follow, target player&#039;s target, use skill rotation
- [ ] Hero AI behavior: configurable roles (aggressive/defensive/support)
- [ ] Threat response: prioritize based on tier

#### 4.5 Balance Requirements
- [ ] Henchman stats: 70-80% of player equivalent
- [ ] Hero stats: 85-95% of player equivalent
- [ ] Content tuning: Solo with henchmen viable but slower than group
- [ ] Threat tier stat multipliers validated

---

### SECTION 5: DESIGN DECISIONS NEEDED FROM USER

1. **Henchman Stats:** Should henchmen be 70-80% player power, or different ratio?

2. **Hero Customization:** Full 8-skill bar like GW1, or reduced (4-6 skills)?

3. **Threat Tier Integration:** 
   - Replace existing COMMON/ELITE/BOSS system?
   - Add as parallel classification (both systems coexist)?
   - Only visual indicator (color) without mechanical changes?

4. **Hero Count per Faction:** 2-3 heroes per faction, or more?

5. **Party Composition Rules:**
   - Can a 4-player party include henchmen? (GW1: No)
   - Maximum henchmen in solo play? (GW1: Fill remaining slots)

6. **Progression:** Do heroes level independently or match player level?

---

DECISION: requirements_extracted</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: REQUIREMENTS_EXTRACTED</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;REQUIREMENTS_EXTRACTED&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>review_plan</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Review Implementation Plan</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reviews the extracted requirements. Checks for completeness, identifies gaps, ensures fidelity to original design docs.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">feature_requirements_reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">85.7s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">6</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">2,009 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">3,461 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(2,009 characters)</span></div>
        <button class="collapsible" data-target="prompt_review_plan_6">Click to expand prompt from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="prompt_review_plan_6">
          <pre class="code-content">You are a feature requirements reviewer. Your job is to verify that extracted requirements are COMPLETE and FAITHFUL to the original design documents.

You MUST:
1. Read the extracted requirements from the previous stage
2. Read the ORIGINAL design docs yourself to verify
3. Check for missing specifications
4. Ensure no generic placeholders snuck in

## Review Checklist

### Completeness Check
- [ ] All relevant design docs were consulted
- [ ] Specific numbers extracted (not vague values)
- [ ] Visual/aesthetic requirements captured from docs
- [ ] Any faction/class/type-specific mechanics noted
- [ ] References and inspirations from docs included

### Fidelity Check
- [ ] Quotes match original docs
- [ ] No invented requirements (stuff not in docs)
- [ ] No generic game design substituted for specific design
- [ ] Aesthetic/style from docs preserved
- [ ] Referenced games/systems accurately represented

### Red Flags (REJECT if found)
- &quot;Basic&quot; or &quot;simple&quot; versions of complex designed systems
- Generic placeholders instead of documented specifics
- Missing mechanics that docs explicitly describe
- Placeholder entities instead of designed types
- Misinterpretation of referenced systems

## Output

If requirements are complete:
```
## Review: APPROVED

### Verified Specifications
[List key specs that are correct]

### Ready for Implementation
The requirements capture the design intent. Proceed.

DECISION: plan_approved
```

If requirements are incomplete:
```
## Review: NEEDS MORE DETAIL

### Missing Information
[List what&#039;s missing]

### Docs to Check
[Which design docs need re-reading]

DECISION: needs_more_detail
```

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- plan_approved: Go to implement_client
- needs_more_detail: Go to extract_requirements

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: plan_approved
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(3,461 characters)</span></div>
        <button class="collapsible" data-target="output_review_plan_6">Click to expand output from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="output_review_plan_6">
          <pre class="code-content">I&#039;ve now reviewed all the relevant design documents. The player-experience document doesn&#039;t contain henchmen/hero specifications. Let me provide my final review.

---

## Review: NEEDS MORE DETAIL

### Verified Specifications (Correct from Docs)

The extractor correctly identified:
1. **Party max: 4 members** (`api-specification.md:1413-1414`)
2. **Summon limit: 2 active constructs** (`combat-design.md:336`)
3. **Water Caste Drone Relay stats: 60 DPS, 150 HP, 30 sec** (`combat-design.md:578-579`)
4. **Enemy types: COMMON, ELITE, BOSS, MINI_BOSS, WORLD_BOSS** (`data-model.md:1160`)
5. **Attribute system with soft/hard caps** (`combat-design.md:45-52`)
6. **Health formula: 200 + (Level Ã— 20) + (Toughness Ã— 5)** (`combat-design.md:56-61`)
7. **Solo/Group encounter templates** (`combat-design.md:1050-1094`)

### Critical Missing Information

**1. HENCHMEN/HEROES ARE NOT IN THE DESIGN DOCS**

This is the most critical gap. The extracted requirements correctly note this as &quot;PROPOSED NEW DESIGN&quot; but then proceed to invent specifics:
- Proposed henchman types (Guardsman Conscript, Hospitaller, etc.) - **INVENTED**
- Proposed stat ratios (70-80% for henchmen, 85-95% for heroes) - **INVENTED**
- Proposed hero customization - **INVENTED**

The user said: &quot;Make sure to use henchmen/heroes&quot; referencing **Guild Wars 1** specifically. GW1 henchmen/heroes have well-documented mechanics that should be researched, not invented.

**Missing GW1 henchmen/hero specifics:**
- GW1 party cap was 8 in most areas (not 4)
- Heroes had fully customizable skill bars (8 skills)
- Henchmen had fixed builds, could not be customized
- Heroes could be flagged/commanded on the battlefield
- Resurrection mechanics for fallen henchmen/heroes

**2. THREAT TIER SYSTEM (Darktide) NOT RESEARCHED**

The user explicitly referenced &quot;minoris, majoris, extremis, terminus&quot; from **Darktide**. The extracted requirements propose HP/damage multipliers but these are **INVENTED**, not from Darktide research.

**3. DESIGN DECISIONS REQUIRED BUT NOT HIGHLIGHTED PROPERLY**

The extractor lists &quot;DECISION REQUIRED&quot; questions but doesn&#039;t propose a clear resolution path. Key decisions:
- Replace existing enemy_type OR add parallel system?
- Can 4-player parties include henchmen?
- Do heroes gain XP or match player level?

### Docs Consulted (Confirmed Complete)
- `combat-design.md` âœ“
- `data-model.md` âœ“
- `api-specification.md` âœ“
- `progression-design.md` âœ“
- `player-experience.md` âœ“

### Red Flags Found

1. **Invented mechanics for henchmen/heroes** - Not grounded in GW1 research
2. **Invented threat tier multipliers** - Not grounded in Darktide research
3. **Generic placeholders** like &quot;70-80% player power&quot; without GW1 reference

### What Needs to Happen

The requirements need to either:
1. **Research GW1 mechanics** for accurate henchmen/hero implementation
2. **Research Darktide** for accurate threat tier values
3. **Get user confirmation** on proposed invented values

OR

4. **Proceed with proposed values as NEW DESIGN** with explicit user acknowledgment that these are original designs, not GW1/Darktide faithful recreations

### Recommendation

Before proceeding to implementation, the extraction should clarify:
- Are the henchmen/hero proposed specs acceptable as NEW DESIGN (not GW1 faithful)?
- Are the threat tier multipliers acceptable as NEW DESIGN (not Darktide faithful)?
- What is the decision on enemy_type integration?

DECISION: needs_more_detail</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: NEEDS_MORE_DETAIL</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;NEEDS_MORE_DETAIL&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>extract_requirements</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Extract Design Requirements</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reads ALL relevant design docs and extracts SPECIFIC requirements for this feature. Outputs concrete specs, not summaries.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">design_extractor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">planner</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">237.9s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">7</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">1,865 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">15,951 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(1,865 characters)</span></div>
        <button class="collapsible" data-target="prompt_extract_requirements_7">Click to expand prompt from design_extractor</button>
        <div class="collapsible-content" id="prompt_extract_requirements_7">
          <pre class="code-content">You are a design requirements extractor. Your job is to read the design documents and extract SPECIFIC, CONCRETE requirements for the selected feature.

You MUST:
1. Read ALL design docs in the project (output/design-docs/, docs/, design-docs/)
2. Find EVERY reference to the selected feature
3. Extract EXACT specifications - numbers, names, behaviors, not summaries

## What to Extract

For the selected feature, search all docs for:
- Exact numerical values (damage, HP, ranges, cooldowns, speeds)
- Specific names (abilities, entities, factions, classes)
- Behavioral specifications (AI patterns, interactions)
- Visual requirements (perspective, camera, colors, style, aesthetic)
- Referenced games/systems and what aspects to emulate
- Technical requirements (2D/3D, networking, etc.)

## Output Format

```
## Feature: [name]

### Specifications from Design Docs

#### Technical/Visual Requirements
[QUOTE exact text from docs about perspective, rendering, style]

#### Mechanics
[QUOTE exact text from docs]
- Values: [exact numbers]
- Behaviors: [exact descriptions]

#### Entities/Content
[QUOTE exact text from docs]
- Names: [actual names from docs]
- Properties: [list with values]

#### Referenced Systems
[QUOTE any mentions of other games/systems to emulate]
- What specifically to take from each reference

### Implementation Checklist
[ ] [Specific requirement 1]
[ ] [Specific requirement 2]
...
```

Do NOT summarize. QUOTE the design docs directly. The implementer needs exact specs.

DECISION: requirements_extracted

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- requirements_extracted: Go to review_plan

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: requirements_extracted
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(15,951 characters)</span></div>
        <button class="collapsible" data-target="output_extract_requirements_7">Click to expand output from design_extractor</button>
        <div class="collapsible-content" id="output_extract_requirements_7">
          <pre class="code-content">Based on my research, I&#039;ll now compile the complete requirements extraction document for the Henchmen/Heroes System, using authentic GW1 mechanics and Space Marine 2 threat tiers (not Darktide as originally stated).

---

# REQUIREMENTS EXTRACTION: Henchmen/Heroes System

## Feature Overview

The Henchmen/Heroes System provides AI-controlled squad companions for the Warhammer 40K MMO, directly adapted from Guild Wars 1&#039;s proven companion system. This enables solo and small-group players to experience full tactical combat while maintaining the 40K squad fantasy.

---

## REQUIREMENTS FROM DESIGN DOCS

### Existing Foundation (from design-docs/)

**Party System (api-specification.md, systems-integration.md):**
- Maximum party size: 4 players for standard content
- PvE party configurations: 2, 4, 6, 8, or 12 characters total (matching GW1)
- Empty player slots can be filled with Henchmen or Heroes

**Class System (progression-design.md):**
- 12 classes across 3 factions (Imperial, Tau, Ork)
- Each class has access to 50+ skills, selects 8 for skill bar + 1 elite
- Secondary profession system after level 10
- Level cap: 30

**Summon Limits (combat-design.md):**
- Maximum 2 active constructs/summons per player
- Henchmen/Heroes are SEPARATE from summon limits (they are party members, not summons)

---

## REQUIREMENTS FROM GUILD WARS 1 RESEARCH

### Henchmen System (Authentic GW1 Mechanics)

**Definition:** Fixed AI companions available at outposts/mission hubs with preset builds.

| Specification | GW1 Authentic Value | 40K Adaptation |
|---------------|---------------------|----------------|
| Skill Customization | None - fixed skills based on profession | None - fixed loadout per henchman type |
| Attribute Customization | None - fixed attributes | None - preset builds |
| Equipment Customization | None - fixed gear | None - standardized faction gear |
| Level | Matches outpost/zone level | Matches mission difficulty level |
| Cost to Acquire | Free | Free (unlocked via story progression) |
| Movement Speed | 104% of player speed | 104% of player speed |
| Positioning Control | None in original GW1 | None |
| Death Penalty | Takes full death penalty | Takes appropriate penalty per design |

**Henchman Archetypes per Faction (12 total, 4 per faction):**

*Imperial:*
1. **Guardsman** - Ranged DPS, fixed lasgun build
2. **Medicae** - Healer, fixed support build
3. **Ogryn** - Tank, fixed melee/taunt build
4. **Psyker Adept** - Caster DPS, fixed psychic build

*Tau:*
1. **Fire Warrior** - Ranged DPS, fixed pulse rifle build
2. **Earth Caste Medic** - Healer, fixed drone-support build
3. **Crisis Suit Pilot** - Tank, fixed battlesuit build
4. **Ethereal Acolyte** - Support/Buffer, fixed aura build

*Ork:*
1. **Shoota Boy** - Ranged DPS, fixed dakka build
2. **Painboy Assistant** - Healer, fixed brutal healing build
3. **&#039;Ard Boy** - Tank, fixed heavy armor melee build
4. **Weirdboy Grot** - Caster DPS, fixed WAAAGH! magic build

---

### Heroes System (Authentic GW1 Mechanics)

**Definition:** Fully customizable AI companions that players unlock and develop.

| Specification | GW1 Authentic Value | 40K Adaptation |
|---------------|---------------------|----------------|
| Skill Customization | Full - any unlocked skill from account pool | Full - any skill unlocked for that class |
| Attribute Customization | Full - player allocates attribute points | Full - player allocates attribute points |
| Equipment Customization | Weapons: manual. Armor: auto-scales to level | Weapons: manual. Armor: auto-scales |
| Level | Matches player level | Matches player level |
| Cost to Acquire | Story unlock or special acquisition | Story unlock, reputation, or requisition |
| Movement Speed | 104% of player speed | 104% of player speed |
| Positioning Control | Flag system for precise placement | Flag system for tactical positioning |
| Combat Stance | Passive / Attack / Guard | Passive / Attack / Guard |
| Skill Suppression | Can disable specific skills | Can disable specific skills |

**Hero Attribute Points (GW1 Authentic):**
- Heroes gain attribute points at the same rate as players
- Heroes receive +15 bonus attribute points at level 10
- Heroes receive +15 bonus attribute points at level 15
- Total at level 30: Standard allocation + 30 bonus points

**Hero Combat Stances:**
1. **Attack** - Aggressively engages enemies, uses skills freely
2. **Guard** - Defends position, only attacks threats to self or flagged allies
3. **Passive** - Does not attack, only uses defensive/healing skills

**Hero Flag System:**
- Players can place positioning flags on the battlefield
- Heroes move to and hold flagged positions
- Flags can be set per-hero or as group command
- Clear flag returns hero to follow behavior

---

## REQUIREMENTS FROM SPACE MARINE 2 RESEARCH

### Enemy Threat Tier System

**Critical Clarification:** The minoris/majoris/extremis/terminus system is from **Warhammer 40,000: Space Marine 2**, NOT Darktide. Darktide uses armor-type classifications (Flak, Unarmored, Carapace, Maniacs, Unyielding, Infested).

| Threat Tier | SM2 Definition | Visual Indicator | Spawn Pattern |
|-------------|----------------|------------------|---------------|
| **Minoris** | Weakest enemies, instantly killed on parry | White indicator | Large packs (10-20+) |
| **Majoris** | Player-sized, significantly tougher | Blue indicator | Small groups (3-6) |
| **Extremis** | Miniboss units, appear in kill feed | Yellow indicator | Solo or pairs |
| **Terminus** | Full boss units with health bars | Purple indicator | Solo, scripted encounters |

**Space Marine 2 Threat Tier Behaviors:**
- **Minoris:** Can be cleaved through, exist to make players feel powerful
- **Majoris:** Require focused attention, can call reinforcements, varied attack patterns
- **Extremis:** Require tactical approach, have unique mechanics, execution animations on kill
- **Terminus:** Phase-based fights, visible health bars, encounter-defining mechanics

---

## INTEGRATION WITH EXISTING SYSTEMS

### Party Composition Rules

```
Maximum Party Size: 4-12 (based on content type)

Composition Options:
- 4-player content: Up to 3 Henchmen/Heroes if solo
- 8-player content: Up to 7 Henchmen/Heroes if solo
- 12-player content: Up to 11 Henchmen/Heroes if solo

Restrictions:
- Heroes limited to 3 per player in party
- Henchmen have no limit beyond party size
- PvP: Heroes allowed in specific formats only
- Competitive PvP: No Henchmen/Heroes
```

### Hero Skill Access

Heroes can use:
- Any skill the player has unlocked for that hero&#039;s class
- Skills from secondary profession if hero has one assigned
- Elite skills if player has captured them for that class

Heroes cannot use:
- Player-specific skills (e.g., leadership rallies that require player input)
- PvP-only skills in PvE contexts

### Faction-Locked Heroes

- Imperial heroes only available to Imperial players
- Tau heroes only available to Tau players  
- Ork heroes only available to Ork players
- Cross-faction heroes: Special story unlocks (e.g., defector characters)

---

## DATA MODEL ADDITIONS

### New Tables Required

```sql
-- Henchman definitions (static game data)
CREATE TABLE henchmen (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    faction_id UUID REFERENCES factions(id),
    class_id UUID REFERENCES classes(id),
    description TEXT,
    unlock_requirement JSONB, -- story progress, reputation, etc.
    fixed_skill_bar UUID[], -- 8 skill references
    fixed_attributes JSONB, -- attribute allocations
    created_at TIMESTAMP DEFAULT NOW()
);

-- Hero definitions (player-owned, customizable)
CREATE TABLE player_heroes (
    id UUID PRIMARY KEY,
    player_id UUID REFERENCES players(id),
    hero_template_id UUID REFERENCES hero_templates(id),
    name VARCHAR(100) NOT NULL,
    level INTEGER DEFAULT 1,
    experience BIGINT DEFAULT 0,
    class_id UUID REFERENCES classes(id),
    secondary_class_id UUID REFERENCES classes(id),
    skill_bar UUID[], -- 8 regular + 1 elite
    disabled_skills UUID[], -- suppressed skills
    attributes JSONB, -- allocated points
    equipment JSONB, -- weapon slots
    combat_stance VARCHAR(20) DEFAULT &#039;attack&#039;, -- passive/attack/guard
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Hero templates (unlockable hero characters)
CREATE TABLE hero_templates (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    faction_id UUID REFERENCES factions(id),
    class_id UUID REFERENCES classes(id),
    backstory TEXT,
    unlock_requirement JSONB,
    portrait_asset VARCHAR(255),
    model_asset VARCHAR(255),
    voice_set VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Enemy threat tier classification
ALTER TABLE enemy_templates ADD COLUMN threat_tier VARCHAR(20) 
    CHECK (threat_tier IN (&#039;minoris&#039;, &#039;majoris&#039;, &#039;extremis&#039;, &#039;terminus&#039;));
```

---

## API ENDPOINTS REQUIRED

### Henchmen Endpoints

```
GET /api/v1/henchmen
  - Returns available henchmen for player&#039;s faction and current zone
  - Query params: zone_id, faction_id

GET /api/v1/henchmen/:id
  - Returns specific henchman details including fixed build
```

### Hero Endpoints

```
GET /api/v1/heroes
  - Returns all heroes owned by authenticated player

GET /api/v1/heroes/:id
  - Returns specific hero with full customization details

POST /api/v1/heroes/:id/skills
  - Update hero&#039;s skill bar
  - Body: { skill_bar: UUID[], elite_skill: UUID }

POST /api/v1/heroes/:id/attributes
  - Update hero&#039;s attribute allocation
  - Body: { attributes: { strength: number, ... } }

POST /api/v1/heroes/:id/equipment
  - Equip weapon to hero
  - Body: { slot: string, item_id: UUID }

POST /api/v1/heroes/:id/stance
  - Set combat stance
  - Body: { stance: &#039;passive&#039; | &#039;attack&#039; | &#039;guard&#039; }

POST /api/v1/heroes/:id/disable-skill
  - Toggle skill suppression
  - Body: { skill_id: UUID, disabled: boolean }
```

### Party Composition Endpoints

```
POST /api/v1/party/add-henchman
  - Add henchman to party
  - Body: { henchman_id: UUID }

POST /api/v1/party/add-hero
  - Add hero to party
  - Body: { hero_id: UUID }

POST /api/v1/party/remove-companion
  - Remove henchman or hero from party
  - Body: { companion_id: UUID, type: &#039;henchman&#039; | &#039;hero&#039; }

POST /api/v1/party/flag
  - Set positioning flag for hero(es)
  - Body: { hero_ids: UUID[], position: { x, y, z } }

POST /api/v1/party/clear-flags
  - Clear all positioning flags
```

---

## WEBSOCKET COMBAT INTEGRATION

### New Message Types

```typescript
// Client -&gt; Server
interface HeroCommand {
    type: &#039;hero_command&#039;;
    hero_id: string;
    command: &#039;move&#039; | &#039;attack&#039; | &#039;use_skill&#039; | &#039;stance&#039; | &#039;flag&#039;;
    target_id?: string;
    position?: { x: number; y: number; z: number };
    skill_id?: string;
    stance?: &#039;passive&#039; | &#039;attack&#039; | &#039;guard&#039;;
}

// Server -&gt; Client
interface CompanionStateUpdate {
    type: &#039;companion_state&#039;;
    companions: Array&lt;{
        id: string;
        type: &#039;henchman&#039; | &#039;hero&#039;;
        health: number;
        max_health: number;
        position: { x: number; y: number; z: number };
        current_target?: string;
        stance: string;
        active_effects: string[];
        skill_cooldowns: Record&lt;string, number&gt;;
    }&gt;;
}

interface CompanionAction {
    type: &#039;companion_action&#039;;
    companion_id: string;
    action: &#039;skill_use&#039; | &#039;attack&#039; | &#039;move&#039; | &#039;death&#039; | &#039;resurrect&#039;;
    skill_id?: string;
    target_id?: string;
    damage?: number;
    healing?: number;
}
```

---

## AI BEHAVIOR SPECIFICATIONS

### Henchman AI (Simple)

```
Priority Order:
1. Self-preservation (flee at &lt;20% health if healer available)
2. Heal allies (if healer class)
3. Protect low-health allies (if tank class)
4. Attack player&#039;s target
5. Attack nearest threat
6. Follow player

Restrictions:
- No skill timing optimization
- No combo awareness
- Basic threat assessment only
```

### Hero AI (Advanced)

```
Priority Order (modified by stance):

ATTACK Stance:
1. Use elite skill when high-value target available
2. Maintain buffs/preparations
3. Attack flagged target or player&#039;s target
4. Use AoE on grouped enemies
5. Attack nearest threat
6. Move to flagged position or follow player

GUARD Stance:
1. Heal/protect flagged ally or lowest-health ally
2. Interrupt dangerous enemy skills
3. Only attack threats to guarded targets
4. Maintain defensive position

PASSIVE Stance:
1. Heal allies only
2. Apply defensive buffs
3. Do not attack under any circumstances
4. Follow player or hold position

Advanced Behaviors:
- Skill combo awareness (set up and follow through)
- Energy/resource management
- Interrupt priority targets
- Positioning for AoE effectiveness
- Avoid AoE damage zones
```

---

## IMPLEMENTATION CHECKLIST

### Phase 1: Data Layer
- [ ] Create `henchmen` table with migration
- [ ] Create `hero_templates` table with migration
- [ ] Create `player_heroes` table with migration
- [ ] Add `threat_tier` column to `enemy_templates`
- [ ] Create Henchman repository
- [ ] Create Hero repository
- [ ] Seed initial henchmen (4 per faction = 12 total)
- [ ] Seed initial hero templates (4 per faction = 12 total)

### Phase 2: Service Layer
- [ ] Create HenchmanService with getAvailableHenchmen(), getHenchmanById()
- [ ] Create HeroService with full CRUD operations
- [ ] Create HeroCustomizationService for skill/attribute/equipment management
- [ ] Extend PartyService to handle henchman/hero additions
- [ ] Create CompanionAIService for behavior processing

### Phase 3: API Layer
- [ ] Implement henchmen endpoints (GET list, GET by ID)
- [ ] Implement hero endpoints (full CRUD + customization)
- [ ] Implement party composition endpoints
- [ ] Add validation schemas for all new endpoints
- [ ] Add hero ownership middleware

### Phase 4: WebSocket Integration
- [ ] Add HeroCommand message handler
- [ ] Add CompanionStateUpdate broadcast
- [ ] Add CompanionAction broadcast
- [ ] Integrate companion AI into combat tick
- [ ] Implement flag system for positioning

### Phase 5: AI Implementation
- [ ] Implement basic henchman AI behavior tree
- [ ] Implement advanced hero AI with stance awareness
- [ ] Add skill combo detection and execution
- [ ] Add threat assessment and target prioritization
- [ ] Add positioning and movement AI

### Phase 6: Testing
- [ ] Unit tests for Henchman/Hero services
- [ ] Integration tests for API endpoints
- [ ] WebSocket integration tests for combat scenarios
- [ ] AI behavior tests for each stance
- [ ] Party composition validation tests

---

## VALIDATION RULES

### Hero Customization Validation
- Skill bar must contain exactly 8 skills + 1 elite (or empty slots)
- All skills must be unlocked by player for hero&#039;s class
- Secondary class skills only valid if secondary profession assigned
- Attribute points cannot exceed level-based maximum + bonuses
- Equipment must match hero&#039;s class proficiency

### Party Composition Validation
- Total companions â‰¤ (max party size - human players)
- Maximum 3 heroes per player in party
- Henchmen must be available in current zone
- No duplicate heroes (same hero template twice)

---

## OPEN DESIGN DECISIONS

The following require design team input before implementation:

1. **Hero Acquisition:** GW1 uses story unlocks. Options for 40K:
   - Story progression unlocks
   - Faction reputation thresholds
   - Requisition currency purchase
   - Achievement unlocks

2. **Cross-Faction Heroes:** Should defector/mercenary heroes exist?
   - Lore-friendly options (Rogue Traders, Kroot mercenaries)
   - Keep strictly faction-locked for purity

3. **Hero Death Penalty:** GW1 heroes take full death penalty. Options:
   - Full penalty (authentic)
   - Reduced penalty (more forgiving)
   - No penalty (heroes are expendable)

4. **Henchman Availability:** Which henchmen appear where?
   - Zone-based (GW1 authentic)
   - Always available once unlocked
   - Story-gated availability

---

**DECISION: requirements_extracted**</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: REQUIREMENTS_EXTRACTED</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;REQUIREMENTS_EXTRACTED&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>review_plan</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Review Implementation Plan</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reviews the extracted requirements. Checks for completeness, identifies gaps, ensures fidelity to original design docs.</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">feature_requirements_reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">reviewer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">62.1s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">8</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">2,009 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">4,405 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(2,009 characters)</span></div>
        <button class="collapsible" data-target="prompt_review_plan_8">Click to expand prompt from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="prompt_review_plan_8">
          <pre class="code-content">You are a feature requirements reviewer. Your job is to verify that extracted requirements are COMPLETE and FAITHFUL to the original design documents.

You MUST:
1. Read the extracted requirements from the previous stage
2. Read the ORIGINAL design docs yourself to verify
3. Check for missing specifications
4. Ensure no generic placeholders snuck in

## Review Checklist

### Completeness Check
- [ ] All relevant design docs were consulted
- [ ] Specific numbers extracted (not vague values)
- [ ] Visual/aesthetic requirements captured from docs
- [ ] Any faction/class/type-specific mechanics noted
- [ ] References and inspirations from docs included

### Fidelity Check
- [ ] Quotes match original docs
- [ ] No invented requirements (stuff not in docs)
- [ ] No generic game design substituted for specific design
- [ ] Aesthetic/style from docs preserved
- [ ] Referenced games/systems accurately represented

### Red Flags (REJECT if found)
- &quot;Basic&quot; or &quot;simple&quot; versions of complex designed systems
- Generic placeholders instead of documented specifics
- Missing mechanics that docs explicitly describe
- Placeholder entities instead of designed types
- Misinterpretation of referenced systems

## Output

If requirements are complete:
```
## Review: APPROVED

### Verified Specifications
[List key specs that are correct]

### Ready for Implementation
The requirements capture the design intent. Proceed.

DECISION: plan_approved
```

If requirements are incomplete:
```
## Review: NEEDS MORE DETAIL

### Missing Information
[List what&#039;s missing]

### Docs to Check
[Which design docs need re-reading]

DECISION: needs_more_detail
```

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- plan_approved: Go to implement_client
- needs_more_detail: Go to extract_requirements

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: plan_approved
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(4,405 characters)</span></div>
        <button class="collapsible" data-target="output_review_plan_8">Click to expand output from feature_requirements_reviewer</button>
        <div class="collapsible-content" id="output_review_plan_8">
          <pre class="code-content">Now I have thoroughly reviewed the design documents. Let me compile my review of the extracted requirements.

---

## Review: NEEDS MORE DETAIL

### What&#039;s Correct in the Extracted Requirements

The extracted requirements accurately capture:
- GW1 Henchmen mechanics (fixed skills, no customization)
- GW1 Heroes mechanics (full skill/attribute customization, flag system, stances)
- 104% movement speed for companions (authentic GW1 detail)
- Correct attribution of threat tier system to Space Marine 2 (not Darktide)
- Minoris/Majoris/Extremis/Terminus classification with color coding (white/blue/yellow/purple)

### Missing Information

**1. Critical: Level Cap Discrepancy**
- Extracted requirements state &quot;Level cap: 30&quot;
- But from `progression-design.md` line 27-28:
  - &quot;Level Cap: 30 (Guild Wars 1 style - achievable, not endless)&quot;
- However, the requirements reference &quot;level 10, level 15&quot; bonuses for Heroes that mirror GW1&#039;s level 20 cap system, not level 30
- **Need clarification:** Should hero attribute bonuses occur at levels 10 and 15, or at levels 15 and 20 (scaled from GW1&#039;s 20 cap)?

**2. Party Size Specifications**
- From `api-specification.md` lines 1406-1430 and `systems-integration.md` line 183-193:
  - Standard party size: 4 players
  - Raid content: 8 players
  - The extracted requirements mention &quot;4, 6, 8, or 12&quot; but docs show primarily 4 and 8
- **Need verification:** Are 6 and 12 player configurations supported, or just 4 and 8?

**3. Summon Limit Clarification**
- From `combat-design.md` line 336: &quot;Summon Limit: 2 active constructs maximum&quot; (Tech-Priest specific)
- The requirements correctly state Heroes/Henchmen are NOT summons
- But should clarify: Does adding a Hero that is a Tech-Priest with summons affect the player&#039;s summon limit?

**4. Henchman/Hero Archetypes Missing Details**
- The requirements created archetypes (Guardsman, Medicae, Ogryn, Psyker Adept, etc.) but these are **NOT in the design documents**
- These appear to be reasonable extrapolations but are **invented requirements**
- Design docs don&#039;t specify which henchmen/heroes should exist
- **Red Flag:** This is inventing content not in the source docs

**5. Faction Lock Implementation**
- Requirements state &quot;Imperial heroes only available to Imperial players&quot;
- But from `progression-design.md` line 1517-1524, the secondary profession system allows cross-class access
- **Need clarification:** Can a player have a Hero from a different faction if they have cross-faction progression?

**6. Death Penalty Not Specified**
- Requirements list this as &quot;Open Design Decision&quot;
- But from `combat-design.md` lines 1016-1043, death penalty is defined by difficulty mode:
  - Normal: respawn at waypoint, minor durability loss
  - Hard: respawn at checkpoint, moderate durability loss
  - Veteran: 3 respawns per mission
  - Nightmare: party wipe = failure
- Heroes/Henchmen should inherit these rules but specific behavior not defined

**7. Missing: WebSocket Combat Tick Integration**
- Requirements mention &quot;Integrate companion AI into combat tick&quot;
- But `api-specification.md` line 1214 shows server tick rate: 20 ticks/second
- Should specify how companion AI integrates with this tick rate

### Docs to Check

1. **Re-read combat-design.md** for:
   - Existing party composition examples
   - Death penalty specifics by difficulty
   - How summons from Tech-Priest/Crisis Suit interact with party limits

2. **Check for any henchmen/heroes references** that may have been missed:
   - Search for &quot;henchmen&quot;, &quot;companion&quot;, &quot;follower&quot; in all docs
   - The requirements created archetypes that don&#039;t exist in source docs

3. **Verify party sizes** from systems-integration.md and api-specification.md

### Red Flags Found

1. **Invented Henchman/Hero archetypes** - The 12 henchmen and 12 hero templates listed are reasonable extrapolations from the class system but are NOT specified in the design documents. This creates risk of implementing something the designers didn&#039;t intend.

2. **Generic database schema** - The SQL tables look reasonable but weren&#039;t validated against the existing `data-model.md` which has detailed schemas. Should align with existing table patterns.

3. **Hero attribute bonus timing** - &quot;+15 bonus at level 10, +15 at level 15&quot; appears to be adapted from GW1&#039;s level 20 cap without validation against this game&#039;s level 30 cap.

---

DECISION: needs_more_detail</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: NEEDS_MORE_DETAIL</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;NEEDS_MORE_DETAIL&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>extract_requirements</strong></div>
      </div>
      
    </div>

    <div class="stage running">
      <div class="stage-header">
        <div>
          <div class="stage-title">Extract Design Requirements</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Reads ALL relevant design docs and extracts SPECIFIC requirements for this feature. Outputs concrete specs, not summaries.</div>
        </div>
        <span class="stage-badge badge-running">running</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">design_extractor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">planner</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">In progress...</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">9</span>
        </div>
        
        
      </div>

      

      

      

      
    </div>
    </div>

    
  </div>

  <script>
    // Interactive collapsible sections
    document.addEventListener('DOMContentLoaded', function() {
      const collapsibles = document.querySelectorAll('.collapsible');

      collapsibles.forEach(button => {
        button.addEventListener('click', function() {
          this.classList.toggle('active');
          const targetId = this.getAttribute('data-target');
          const content = document.getElementById(targetId);

          if (content) {
            content.classList.toggle('active');
          }
        });
      });

      // Add "Expand All" / "Collapse All" buttons
      const header = document.querySelector('.header');
      if (header && collapsibles.length > 0) {
        const controlsDiv = document.createElement('div');
        controlsDiv.style.marginTop = '20px';

        const collapseAllBtn = document.createElement('button');
        collapseAllBtn.textContent = 'Collapse All Sections';
        collapseAllBtn.style.cssText = 'padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; margin-right: 10px; font-weight: bold;';
        collapseAllBtn.addEventListener('click', function() {
          collapsibles.forEach(btn => {
            btn.classList.add('active');
            const targetId = btn.getAttribute('data-target');
            const content = document.getElementById(targetId);
            if (content) content.classList.add('active');
          });
        });

        const expandAllBtn = document.createElement('button');
        expandAllBtn.textContent = 'Expand All Sections';
        expandAllBtn.style.cssText = 'padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;';
        expandAllBtn.addEventListener('click', function() {
          collapsibles.forEach(btn => {
            btn.classList.remove('active');
            const targetId = btn.getAttribute('data-target');
            const content = document.getElementById(targetId);
            if (content) content.classList.remove('active');
          });
        });

        controlsDiv.appendChild(collapseAllBtn);
        controlsDiv.appendChild(expandAllBtn);
        header.appendChild(controlsDiv);
      }
    });
  </script>
</body>
</html>