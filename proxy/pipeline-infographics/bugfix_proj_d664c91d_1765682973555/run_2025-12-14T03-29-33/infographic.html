<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- NO meta refresh - viewer handles refreshing via iframe reload to preserve toggle state -->
  <title>Pipeline: Game Bug Fix Pipeline</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .metric {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .metric-label {
      font-size: 0.85em;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .metric-value {
      font-size: 1.8em;
      font-weight: bold;
      color: #333;
      margin-top: 5px;
    }
    .timeline {
      position: relative;
      padding-left: 40px;
      margin-top: 20px;
    }
    .timeline::before {
      content: '';
      position: absolute;
      left: 20px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }
    .stage {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      position: relative;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    .stage:hover {
      transform: translateX(5px);
    }
    .stage::before {
      content: '';
      position: absolute;
      left: -28px;
      top: 30px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 0 2px #667eea;
    }
    .stage.running::before { background: #ffc107; box-shadow: 0 0 0 2px #ffc107, 0 0 20px #ffc107; }
    .stage.completed::before { background: #28a745; box-shadow: 0 0 0 2px #28a745; }
    .stage.error::before { background: #dc3545; box-shadow: 0 0 0 2px #dc3545; }
    .stage-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    .stage-title {
      font-size: 1.4em;
      font-weight: bold;
      color: #333;
    }
    .stage-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.75em;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-running { background: #fff3cd; color: #856404; }
    .badge-completed { background: #d4edda; color: #155724; }
    .badge-error { background: #f8d7da; color: #721c24; }
    .stage-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .meta-item {
      font-size: 0.9em;
    }
    .meta-label {
      color: #6c757d;
      font-weight: 500;
    }
    .meta-value {
      color: #333;
      font-weight: bold;
      margin-left: 5px;
    }
    .stage-output {
      margin-top: 15px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      max-height: 500px;
      overflow-y: auto;
    }
    .stage-output pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9em;
      line-height: 1.6;
      color: #333;
    }
    .error-box {
      background: #fff5f5;
      border: 2px solid #fc8181;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }
    .error-title {
      color: #c53030;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .error-stack {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.85em;
      color: #742a2a;
      background: white;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
    .routing-info {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
    }
    .routing-decision {
      font-weight: bold;
      color: #1976D2;
      margin-bottom: 5px;
    }
    .completion-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .completion-banner h2 {
      font-size: 2em;
      margin-bottom: 10px;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .running-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #ffc107;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 1.5s infinite;
    }
    .ai-summary {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border-left: 6px solid #667eea;
    }
    .ai-summary h2 {
      font-size: 1.8em;
      margin-bottom: 15px;
      color: #333;
    }
    .summary-narrative {
      font-size: 1.1em;
      line-height: 1.8;
      color: #555;
    }
    .collapsible {
      cursor: pointer;
      padding: 12px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      margin: 10px 0;
      font-weight: bold;
      color: #495057;
      transition: background 0.2s;
    }
    .collapsible:hover {
      background: #e9ecef;
    }
    .collapsible::before {
      content: 'â–¶ ';
      display: inline-block;
      transition: transform 0.2s;
    }
    .collapsible.active::before {
      transform: rotate(90deg);
    }
    .collapsible-content {
      display: none;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-top: 5px;
      border-left: 4px solid #667eea;
    }
    .collapsible-content.active {
      display: block;
    }
    .prompt-section {
      background: #fff5e6;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
    }
    .output-section {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
    }
    .section-label {
      font-weight: bold;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      color: #555;
    }
    .char-count {
      font-size: 0.85em;
      color: #6c757d;
      font-style: italic;
    }
    pre.code-content {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.85em;
      line-height: 1.6;
      color: #333;
      background: white;
      padding: 15px;
      border-radius: 6px;
      max-height: none;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    

    

    <div class="header">
      <h1><span class="running-indicator"></span>Game Bug Fix Pipeline</h1>
      <p style="color: #6c757d; font-size: 1.1em; margin-top: 5px;">Pipeline ID: bugfix_proj_d664c91d_1765682973555</p>

      <div class="metrics">
        <div class="metric">
          <div class="metric-label">Elapsed Time</div>
          <div class="metric-value">135.2s</div>
        </div>
        <div class="metric">
          <div class="metric-label">Stages Completed</div>
          <div class="metric-value">2/3</div>
        </div>
        <div class="metric">
          <div class="metric-label">Errors</div>
          <div class="metric-value" style="color: #28a745">0</div>
        </div>
        <div class="metric">
          <div class="metric-label">Status</div>
          <div class="metric-value" style="font-size: 1.2em;">âš¡ Running</div>
        </div>
      </div>
    </div>

    <div class="timeline">
      
    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Bug Analysis</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Analyze the bug report to understand symptoms, expected behavior, and gather context</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">game_bug_analyzer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">analyzer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">96.4s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">1</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">2,098 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">3,385 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(2,098 characters)</span></div>
        <button class="collapsible" data-target="prompt_bug_analysis_1">Click to expand prompt from game_bug_analyzer</button>
        <div class="collapsible-content" id="prompt_bug_analysis_1">
          <pre class="code-content">You are a Game Bug Analyzer specializing in video game development. Your job is to analyze bug reports and create a structured understanding of the issue.

Your responsibilities:

1. **Understand the Bug**:
   - What is the expected game behavior?
   - What is the actual behavior?
   - When does it occur? (always, sometimes, specific game states)
   - Does it affect gameplay, visuals, audio, or performance?

2. **Extract Game Context**:
   - Which game systems are likely involved? (rendering, physics, input, AI, networking, save/load, etc.)
   - What game state triggers this? (specific level, inventory state, player action)
   - Are there console errors or visual glitches?
   - Can the player work around it?

3. **Assess Impact**:
   - Does it break core gameplay?
   - Does it affect game balance?
   - Is it a visual polish issue?
   - Does it cause crashes or data loss?

4. **Identify Reproduction**:
   - What steps reproduce the bug?
   - Is specific game progress required?
   - Is it timing-dependent?

First, use the Read tool to examine the game&#039;s main files and understand its structure. Look at:
- Main game entry point (index.html, main.js, game.js)
- Any files mentioned in the bug report
- Game configuration files

Output your analysis as:

**Bug Summary**: [One line description]

**Expected Behavior**: [What should happen]

**Actual Behavior**: [What happens instead]

**Affected Systems**: [List game systems: combat, movement, UI, rendering, etc.]

**Severity**: CRITICAL/HIGH/MEDIUM/LOW

**Reproduction Steps**:
1. [Step 1]
2. [Step 2]
3. [Step 3]

**Likely Source Files**: [List files to investigate]

**Initial Hypothesis**: [Your theory about the cause]

IMPORTANT: End your response with: DECISION: analysis_complete

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- analysis_complete: Bug analysis complete with clear understanding

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: analysis_complete
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(3,385 characters)</span></div>
        <button class="collapsible" data-target="output_bug_analysis_1">Click to expand output from game_bug_analyzer</button>
        <div class="collapsible-content" id="output_bug_analysis_1">
          <pre class="code-content">Now I have a complete understanding of the bug. The issue is clear:

**Bug Summary**: Three.js rendering crash after enemy death - &quot;Cannot read properties of undefined (reading &#039;value&#039;)&quot; in refreshUniformsCommon

**Expected Behavior**: When an enemy dies and plays its death animation with material property changes (opacity, emissive), the rendering should continue smoothly without errors.

**Actual Behavior**: After killing an enemy (specifically mentioned &quot;purple guy&quot; = Chaos faction enemy), Three.js throws repeated TypeError crashes in `refreshUniformsCommon` trying to access `.value` on an undefined uniform. The errors spam continuously during the game loop, breaking rendering.

**Affected Systems**: 
- Rendering system (Three.js WebGL renderer)
- Enemy death animation system
- Material management system
- Combat system (triggers enemy death)

**Severity**: HIGH

**Reproduction Steps**:
1. Start combat encounter with enemies
2. Kill a Chaos Marine or other &quot;purple&quot; Chaos faction enemy
3. Enemy dies and triggers death animation (THERMAL, PHOTON, or KINETIC)
4. Three.js immediately starts throwing uniform access errors
5. Errors spam every frame, breaking rendering

**Likely Source Files**: 
- `/mnt/c/github/40kgw/output/client/src/game/entities/Enemy.ts` (lines 1383-1489 - death animation)
- `/mnt/c/github/40kgw/output/client/src/game/entities/Enemy.ts` (lines 237-952 - material creation)
- `/mnt/c/github/40kgw/output/client/src/game/entities/Enemy.ts` (lines 1703-1724 - disposal)
- `/mnt/c/github/40kgw/output/client/src/game/Game.ts` (line 940 - render call)

**Initial Hypothesis**: 

The bug is caused by a **material property modification timing issue**. During the death animation (`updateDeathAnimation` at lines 1393-1435), the code directly modifies material properties (opacity, emissive, emissiveIntensity) on `MeshStandardMaterial` objects. However:

1. **Materials are not initialized with `transparent: true`**: Most materials (lines 237-952) don&#039;t have the `transparent` flag set. When opacity is modified at line 1395 or 1432, Three.js needs to recompile the shader program, which can cause uniforms to become undefined during the transition.

2. **Material properties are mutated during render loop**: The death animation modifies materials every frame while they&#039;re actively being rendered. Three.js caches shader programs based on material properties, and changing `transparent`, `opacity`, or `emissive` values can trigger shader recompilation mid-frame.

3. **Race condition with material disposal**: When the death callback fires (line 1316), loot generation occurs, which may trigger other game logic. The enemy mesh remains in the scene during the death animation, but its materials are being actively modified. If something else tries to dispose or modify these shared materials, uniforms become undefined.

4. **The uniform `.value` is undefined**: The Three.js error occurs when trying to access a uniform&#039;s value property that doesn&#039;t exist, typically when a shader program is in an inconsistent state due to material property changes requiring shader recompilation.

**Root cause**: Materials need `transparent: true` set at initialization OR before modifying opacity, and material modifications should not happen while the mesh is being rendered, or should trigger proper material.needsUpdate flags.

DECISION: analysis_complete</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: ANALYSIS_COMPLETE</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;ANALYSIS_COMPLETE&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>create_reproduction</strong></div>
      </div>
      
    </div>

    <div class="stage completed">
      <div class="stage-header">
        <div>
          <div class="stage-title">Create Reproduction</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Create a test script that reproduces the bug so we can confirm it exists</div>
        </div>
        <span class="stage-badge badge-completed">completed</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">game_bug_reproducer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">creator</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">37.1s</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">2</span>
        </div>
        
        <div class="meta-item">
          <span class="meta-label">Prompt Size:</span>
          <span class="meta-value">3,568 chars</span>
        </div>
        
        
        <div class="meta-item">
          <span class="meta-label">Output Size:</span>
          <span class="meta-value">1,006 chars</span>
        </div>
        
      </div>

      
      <div class="prompt-section">
        <div class="section-label">ðŸ“¥ AGENT PROMPT <span class="char-count">(3,568 characters)</span></div>
        <button class="collapsible" data-target="prompt_create_reproduction_2">Click to expand prompt from game_bug_reproducer</button>
        <div class="collapsible-content" id="prompt_create_reproduction_2">
          <pre class="code-content">You are a Game Bug Reproducer. Your job is to ACTUALLY REPRODUCE the bug by running the game, not by reading source code.

## CRITICAL: You Must Run The Game

DO NOT just read source files and check for code patterns. That proves nothing.
You must actually trigger the bug and observe it happening.

## Step 1: Restart the Server

```bash
curl -X POST http://localhost:3008/api/internal/server/restart \
  -H &quot;Content-Type: application/json&quot; \
  -d &#039;{&quot;projectPath&quot;: &quot;YOUR_WORKING_DIRECTORY&quot;}&#039;
```

## Step 2: Create a Playwright Test That Triggers the Bug

Write a test that:
1. Loads the game in a real browser
2. Sets up the conditions for the bug
3. Triggers the bug
4. Checks if the bug actually happens

```typescript
// tests/reproduce-bug.spec.ts
import { test, expect } from &#039;@playwright/test&#039;;

test(&#039;reproduce bug&#039;, async ({ page }) =&gt; {
  // Collect console errors
  const errors: string[] = [];
  page.on(&#039;console&#039;, msg =&gt; {
    if (msg.type() === &#039;error&#039;) errors.push(msg.text());
  });
  page.on(&#039;pageerror&#039;, err =&gt; errors.push(err.message));

  // Load game
  await page.goto(&#039;/&#039;);
  await page.waitForFunction(() =&gt; (window as any).__TEST_HOOKS__, { timeout: 30000 });

  // Trigger the bug condition
  await page.evaluate(async () =&gt; {
    const hooks = (window as any).__TEST_HOOKS__;
    // Example: spawn enemy and kill it
    await hooks.spawnTestEnemy(&#039;CHAOS_CULTIST&#039;, 5, 5);
    await hooks.waitForFrames(30);
    const enemies = hooks.getAllEnemyIds();
    hooks.selectEnemy(enemies[0]);
    // Kill enemy with skills
    for (let i = 0; i &lt; 10; i++) {
      hooks.useSkill(0);
      await hooks.waitForFrames(30);
    }
    await hooks.waitForFrames(120); // Wait for death animation
  });

  // Check if bug occurred
  const bugErrors = errors.filter(e =&gt; 
    e.includes(&#039;Cannot read properties of undefined&#039;) ||
    e.includes(&#039;the specific error from bug report&#039;)
  );

  if (bugErrors.length &gt; 0) {
    console.log(&#039;BUG CONFIRMED - Errors found:&#039;, bugErrors);
    expect(true).toBe(false); // Fail test = bug exists
  } else {
    console.log(&#039;BUG NOT FOUND - No errors&#039;);
  }
});
```

## Step 3: Run the Test

```bash
cd [project]/client &amp;&amp; npx playwright test reproduce-bug.spec.ts --reporter=list
```

## Step 4: Report Results

**BUG CONFIRMED** means:
- You ran the game
- You triggered the condition
- You SAW the actual error/crash/wrong behavior

**BUG NOT FOUND** means:
- You ran the game
- You triggered the condition  
- The expected error did NOT occur

## What NOT To Do

DO NOT:
- Read source files and check for string patterns
- Use fs.readFileSync to analyze code
- Say &#039;BUG CONFIRMED&#039; without actually seeing the bug happen
- Do static analysis instead of runtime testing

Static analysis (reading code) tells you nothing. The bug might never trigger in practice, or might be prevented by other code. You must RUN THE GAME.

## Output

```
## Bug Reproduction Results

### How I Triggered It
[What actions I took in the game]

### What I Observed
[The actual error/behavior I saw - paste console output]

### Verdict
BUG CONFIRMED - I saw [specific error] when [specific action]
or
BUG NOT FOUND - No errors occurred when [specific action]
```

DECISION: reproduction_ready

=== ROUTING DECISION REQUIRED ===
After your response, you MUST choose exactly ONE decision from:
- reproduction_ready: Reproduction script created and ready to run

**CRITICAL**: Your VERY LAST LINE must be exactly:
DECISION: [ONE_OF_THE_ABOVE_CHOICES]
Example: DECISION: reproduction_ready
Do NOT add explanations after the decision keyword.
</pre>
        </div>
      </div>
      

      
      <div class="output-section">
        <div class="section-label">ðŸ“¤ AGENT OUTPUT <span class="char-count">(1,006 characters)</span></div>
        <button class="collapsible" data-target="output_create_reproduction_2">Click to expand output from game_bug_reproducer</button>
        <div class="collapsible-content" id="output_create_reproduction_2">
          <pre class="code-content">## Bug Reproduction Script Created

I&#039;ve created a Playwright test that will:

1. **Load the game** in a real browser
2. **Spawn a Chaos Marine** (purple faction enemy as mentioned in the bug report)
3. **Kill the enemy** by repeatedly using skills
4. **Wait for the death animation** to play (~2 seconds)
5. **Capture all console errors** during this period
6. **Check for the specific Three.js error**: &quot;Cannot read properties of undefined (reading &#039;value&#039;)&quot; in `refreshUniformsCommon`

The test will **FAIL if the bug exists** (errors found) and **PASS if the bug is fixed** (no errors).

### To run this reproduction:

```bash
cd /mnt/c/github/40kgw/output/client
npx playwright test reproduce-threejs-uniform-bug.spec.ts --reporter=list
```

The test will spawn an actual Chaos enemy, kill it with skills, and observe whether the Three.js rendering crashes with the uniform access error during the death animation - exactly replicating the conditions from the bug report.

DECISION: reproduction_ready</pre>
        </div>
      </div>
      

      

      
      <div class="routing-info">
        <div class="routing-decision">ðŸ”€ Routing Decision: REPRODUCTION_READY</div>
        <div style="font-size: 0.9em; color: #555; margin-top: 5px;">Decision &quot;REPRODUCTION_READY&quot; matched connection condition</div>
        <div style="margin-top: 10px; font-weight: bold;">â†’ Next Stage: <strong>confirm_bug</strong></div>
      </div>
      
    </div>

    <div class="stage running">
      <div class="stage-header">
        <div>
          <div class="stage-title">Confirm Bug Exists</div>
          <div style="color: #6c757d; font-size: 0.9em; margin-top: 5px;">Run the reproduction script to confirm the bug exists before we try to fix it</div>
        </div>
        <span class="stage-badge badge-running">running</span>
      </div>

      <div class="stage-meta">
        <div class="meta-item">
          <span class="meta-label">Agent:</span>
          <span class="meta-value">game_bug_confirmer</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Type:</span>
          <span class="meta-value">executor</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Duration:</span>
          <span class="meta-value">In progress...</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Execution #:</span>
          <span class="meta-value">3</span>
        </div>
        
        
      </div>

      

      

      

      
    </div>
    </div>

    
  </div>

  <script>
    // Interactive collapsible sections
    document.addEventListener('DOMContentLoaded', function() {
      const collapsibles = document.querySelectorAll('.collapsible');

      collapsibles.forEach(button => {
        button.addEventListener('click', function() {
          this.classList.toggle('active');
          const targetId = this.getAttribute('data-target');
          const content = document.getElementById(targetId);

          if (content) {
            content.classList.toggle('active');
          }
        });
      });

      // Add "Expand All" / "Collapse All" buttons
      const header = document.querySelector('.header');
      if (header && collapsibles.length > 0) {
        const controlsDiv = document.createElement('div');
        controlsDiv.style.marginTop = '20px';

        const collapseAllBtn = document.createElement('button');
        collapseAllBtn.textContent = 'Collapse All Sections';
        collapseAllBtn.style.cssText = 'padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; margin-right: 10px; font-weight: bold;';
        collapseAllBtn.addEventListener('click', function() {
          collapsibles.forEach(btn => {
            btn.classList.add('active');
            const targetId = btn.getAttribute('data-target');
            const content = document.getElementById(targetId);
            if (content) content.classList.add('active');
          });
        });

        const expandAllBtn = document.createElement('button');
        expandAllBtn.textContent = 'Expand All Sections';
        expandAllBtn.style.cssText = 'padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;';
        expandAllBtn.addEventListener('click', function() {
          collapsibles.forEach(btn => {
            btn.classList.remove('active');
            const targetId = btn.getAttribute('data-target');
            const content = document.getElementById(targetId);
            if (content) content.classList.remove('active');
          });
        });

        controlsDiv.appendChild(collapseAllBtn);
        controlsDiv.appendChild(expandAllBtn);
        header.appendChild(controlsDiv);
      }
    });
  </script>
</body>
</html>