Excellent! Now I have all the information I need. Let me write the complete investigation summary:

---

**Investigation Summary**:
I've identified the exact root cause of the Three.js rendering crash. When enemies die with THERMAL or PHOTON damage types, the death animation code attempts to modify the `opacity` property of materials that were NOT created with the `transparent: true` flag. This causes Three.js to access undefined shader uniforms during the render loop, resulting in the repeating error: `Uncaught TypeError: Cannot read properties of undefined (reading 'value')`.

**Root Cause**:
File: `/mnt/c/github/40kgw/output/client/src/game/entities/Enemy.ts`
Lines: 
- Material creation: 237-243, 251-256, 279-283, 299-303, 314-318, 327-331, 358-363, 370-374, 394-398, 416-420, 438-442, 451-455, 481-485, 495-499, 521-525, 541-545, 569-573, 584-588, 613-617, 627-631, 639-643, 669-673, 697-701, 725-729, 741-745, 769-773, 790-794, 808-812, 823-827, 879-883, 891-895 (31 MeshStandardMaterial instances total)
- Opacity modification: 1333, 1370

**Issue**: 
All enemy body materials (body, head, shoulders, weapons, legs, etc.) are created as `MeshStandardMaterial` instances WITHOUT the `transparent: true` property. For example:

```typescript
const bodyMaterial = new THREE.MeshStandardMaterial({
  color: colors.primary,
  roughness: 0.5,
  metalness: 0.5,
  emissive: colors.primary,
  emissiveIntensity: 0.1,
  // MISSING: transparent: true
});
```

However, the death animation code at lines 1328-1374 uses `mesh.traverse()` to find all child meshes and modifies their opacity:
- **THERMAL death** (line 1333): `(child.material as THREE.MeshStandardMaterial).opacity = 1.0 - progress;`
- **PHOTON death** (line 1370): `mat.opacity = 1.0 - (progress - 0.2) / 0.8;`

**Why**: 
In Three.js, when you create a material without `transparent: true`, the WebGL shader is compiled WITHOUT transparency-related uniform variables. When the death animation later sets `material.opacity < 1.0`, Three.js attempts to update the transparency uniforms during the render pass (`refreshUniformsCommon` function), but these uniforms were never created. This results in attempting to read `.value` on `undefined`, causing the crash.

The error repeats every frame during the death animation (typically for 2 seconds based on `deathAnimationDuration: 2.0` at line 1265) because:
1. The game loop calls `render()` at Game.ts:940
2. Three.js tries to render all meshes
3. For each mesh with modified opacity, it accesses non-existent uniform variables
4. Error is thrown but caught by the browser, allowing the next frame to execute
5. Process repeats until `progress >= 1.0` at line 1419

**Fix Strategy**:
Add `transparent: true` to ALL `MeshStandardMaterial` instantiations in Enemy.ts. Specifically, update all 31 material creation blocks to include:

```typescript
const material = new THREE.MeshStandardMaterial({
  // ... existing properties ...
  transparent: true,  // ADD THIS
  opacity: 1.0,       // ADD THIS (explicit initial value)
});
```

This ensures that:
1. Three.js compiles the shaders with transparency uniform support from the start
2. Materials start fully opaque (`opacity: 1.0`) so visuals are unchanged initially
3. Death animations can safely modify opacity without causing undefined uniform access
4. All death types (THERMAL, PHOTON, and any future ones that use opacity) will work correctly

**Risks/Considerations**:
1. **Performance**: Materials with `transparent: true` render in a separate pass (after opaque objects) and require alpha blending, which has a minor performance cost. However, this is unavoidable if opacity animations are needed.

2. **Render order**: Transparent materials can have z-sorting issues if multiple transparent objects overlap. In this case, it shouldn't be problematic since each enemy is a separate entity and death animations are brief.

3. **Depth writing**: By default, transparent materials still write to the depth buffer. This is actually desirable for solid objects that just fade out. No change needed.

4. **Initial opacity**: Must explicitly set `opacity: 1.0` when creating materials to ensure enemies appear fully opaque initially. Without this, default opacity might not be 1.0.

5. **Comprehensive fix needed**: ALL 31 MeshStandardMaterial instances must be updated, not just the body materials. The `mesh.traverse()` function iterates through ALL child meshes, so any material could potentially be modified.

DECISION: root_cause_found