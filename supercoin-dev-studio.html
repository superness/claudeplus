<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperCoin Dev Studio - Claude Plus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #2a2a3e 0%, #1e2a3e 100%);
            padding: 1.5rem 2rem;
            border-bottom: 2px solid #ffa500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #ffa500 0%, #ffcc00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 1rem;
        }

        .directory-selector {
            flex: 1;
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .directory-selector label {
            color: #ffa500;
            font-weight: 600;
            white-space: nowrap;
        }

        .directory-selector input {
            flex: 1;
            padding: 0.6rem;
            background: #1a1a2e;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .directory-selector input:focus {
            outline: none;
            border-color: #ffa500;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            background: #ffa500;
            color: #1a1a1a;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #ff8c00;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.3);
        }

        .btn.secondary {
            background: #444;
            color: #e0e0e0;
        }

        .btn.secondary:hover {
            background: #555;
        }

        .status-bar {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #333;
            font-size: 0.85rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #666;
        }

        .status-indicator.active {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: #1e1e2e;
            border-right: 1px solid #3a3a3a;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .quick-commands {
            margin-bottom: 1.5rem;
        }

        .quick-commands h3 {
            font-size: 0.9rem;
            color: #ffa500;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quick-btn {
            display: block;
            width: 100%;
            padding: 0.7rem;
            margin-bottom: 0.6rem;
            background: #2a2a3e;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            text-align: left;
        }

        .quick-btn:hover {
            background: #3a3a4e;
            border-color: #ffa500;
            transform: translateX(4px);
        }

        .quick-btn.danger {
            border-color: #ff4444;
            color: #ff6666;
        }

        .quick-btn.danger:hover {
            background: #3a2a2e;
            border-color: #ff6666;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #16213e;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .message {
            padding: 1.25rem;
            border-radius: 12px;
            max-width: 85%;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: linear-gradient(135deg, #2a4a5a 0%, #1e3a4a 100%);
            align-self: flex-end;
            border: 1px solid #3a5a6a;
        }

        .message.assistant {
            background: linear-gradient(135deg, #2a2a3e 0%, #1e1e2e 100%);
            align-self: flex-start;
            border: 1px solid #3a3a3a;
        }

        .message.system {
            background: linear-gradient(135deg, #3a2a3a 0%, #2a1a2a 100%);
            align-self: center;
            border: 1px solid #4a3a3a;
            font-size: 0.9rem;
            font-style: italic;
            max-width: 95%;
        }

        .message.pipeline {
            background: linear-gradient(135deg, #2a3a2a 0%, #1a2a1a 100%);
            align-self: flex-start;
            border: 1px solid #3a4a3a;
            max-width: 95%;
        }

        .message-header {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .message-content {
            line-height: 1.7;
        }

        .message-content pre {
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 0.5rem 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .message-content code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #ffcc00;
        }

        .pipeline-progress {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            border-left: 3px solid #ffa500;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffa500 0%, #ffcc00 100%);
            transition: width 0.3s ease;
        }

        .input-area {
            padding: 1.5rem 2rem;
            background: #1e1e2e;
            border-top: 1px solid #3a3a3a;
        }

        .input-container {
            display: flex;
            gap: 1rem;
        }

        #userInput {
            flex: 1;
            padding: 0.9rem;
            background: #1a1a2e;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: none;
            min-height: 48px;
            max-height: 150px;
        }

        #userInput:focus {
            outline: none;
            border-color: #ffa500;
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.1);
        }

        #sendBtn {
            padding: 0.9rem 2rem;
            background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
            color: #1a1a1a;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 165, 0, 0.4);
        }

        #sendBtn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #444;
            border-top-color: #ffa500;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .infographic-link {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid #ffa500;
            border-radius: 6px;
            color: #ffa500;
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .infographic-link:hover {
            background: rgba(255, 165, 0, 0.2);
            transform: translateX(4px);
        }

        /* Pipeline Visualization Panel */
        .pipeline-viz-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 450px;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-left: 2px solid #ffa500;
            box-shadow: -4px 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            transform: translateX(450px);
            transition: transform 0.3s ease-out;
            z-index: 1000;
        }

        .pipeline-viz-panel.visible {
            transform: translateX(0);
        }

        .pipeline-viz-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #2a2a3e 0%, #1e2a3e 100%);
            border-bottom: 2px solid #ffa500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pipeline-viz-header h2 {
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ffa500 0%, #ffcc00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .toggle-viz-btn {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
            border: 2px solid #ffa500;
            border-right: none;
            padding: 1rem 0.5rem;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            z-index: 999;
            font-size: 1.2rem;
            transition: all 0.2s;
            box-shadow: -4px 0 12px rgba(0,0,0,0.3);
        }

        .toggle-viz-btn:hover {
            padding-left: 1rem;
            box-shadow: -6px 0 16px rgba(255,165,0,0.4);
        }

        .pipeline-viz-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .pipeline-graph {
            position: relative;
            min-height: 400px;
            padding: 2rem 1rem;
        }

        .pipeline-node {
            background: linear-gradient(135deg, #2a2a3e 0%, #1e1e2e 100%);
            border: 2px solid #444;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .pipeline-node::after {
            content: '';
            position: absolute;
            bottom: -1.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 1.5rem;
            background: linear-gradient(180deg, #444 0%, transparent 100%);
        }

        .pipeline-node:last-child::after {
            display: none;
        }

        .pipeline-node.pending {
            border-color: #666;
            opacity: 0.6;
        }

        .pipeline-node.in-progress {
            border-color: #ffa500;
            background: linear-gradient(135deg, #3a2a1e 0%, #2a1e1e 100%);
            box-shadow: 0 0 20px rgba(255,165,0,0.3);
            animation: pulse-node 2s infinite;
        }

        .pipeline-node.in-progress::after {
            background: linear-gradient(180deg, #ffa500 0%, transparent 100%);
        }

        .pipeline-node.completed {
            border-color: #00ff88;
            background: linear-gradient(135deg, #1e3a2a 0%, #1e2a2a 100%);
        }

        .pipeline-node.completed::after {
            background: linear-gradient(180deg, #00ff88 0%, transparent 100%);
        }

        .pipeline-node.error {
            border-color: #ff4444;
            background: linear-gradient(135deg, #3a1e1e 0%, #2a1e1e 100%);
        }

        @keyframes pulse-node {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255,165,0,0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(255,165,0,0.6);
            }
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .node-icon {
            font-size: 1.5rem;
        }

        .node-title {
            flex: 1;
            font-weight: 600;
            font-size: 0.95rem;
            color: #e0e0e0;
        }

        .node-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .node-status.pending {
            background: #333;
            color: #999;
        }

        .node-status.in-progress {
            background: rgba(255,165,0,0.2);
            color: #ffa500;
        }

        .node-status.completed {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
        }

        .node-status.error {
            background: rgba(255,68,68,0.2);
            color: #ff4444;
        }

        .node-agent {
            font-size: 0.8rem;
            color: #999;
            margin-top: 0.5rem;
        }

        .node-output {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            font-size: 0.8rem;
            color: #ccc;
            max-height: 150px;
            overflow-y: auto;
            border-left: 3px solid #444;
        }

        .node-output.completed {
            border-left-color: #00ff88;
        }

        .node-output.error {
            border-left-color: #ff4444;
        }

        .no-pipeline {
            text-align: center;
            padding: 3rem 2rem;
            color: #999;
        }

        .no-pipeline-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ’° SuperCoin Dev Studio</h1>
        <div class="header-controls">
            <div class="directory-selector">
                <label>Working Directory:</label>
                <input type="text" id="workingDir" value="/mnt/c/github/private-SuperCoinServ" placeholder="/path/to/project">
                <button class="btn secondary" onclick="setWorkingDirectory()">Set Directory</button>
            </div>
        </div>
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="proxyStatus"></div>
                <span>Proxy Server</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="pipelineStatus"></div>
                <span>Pipeline Active</span>
            </div>
            <div class="status-item">
                <span id="currentDir">/mnt/c/github/private-SuperCoinServ</span>
            </div>
        </div>
    </div>

    <!-- Pipeline Visualization Toggle Button -->
    <button class="toggle-viz-btn" onclick="toggleVisualization()" id="toggleVizBtn">ğŸ“Š</button>

    <!-- Pipeline Visualization Panel -->
    <div class="pipeline-viz-panel" id="pipelineVizPanel">
        <div class="pipeline-viz-header">
            <h2>ğŸ”„ Pipeline Execution</h2>
            <button class="btn secondary" onclick="toggleVisualization()">Close</button>
        </div>
        <div class="pipeline-viz-content">
            <div id="pipelineGraph" class="pipeline-graph">
                <div class="no-pipeline">
                    <div class="no-pipeline-icon">â³</div>
                    <div>No pipeline running</div>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">Start a pipeline to see the visualization</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="quick-commands">
                <h3>ğŸ“Š Quick Info</h3>
                <button class="quick-btn" onclick="fillInput('project-status')">Project Status</button>
                <button class="quick-btn" onclick="fillInput('recent-changes')">Recent Changes</button>
                <button class="quick-btn" onclick="fillInput('list-pipelines')">Available Pipelines</button>
                <button class="quick-btn" onclick="fillInput('codebase-structure')">Codebase Structure</button>
            </div>

            <div class="quick-commands">
                <h3>ğŸ› ï¸ Development</h3>
                <button class="quick-btn" onclick="fillInput('run-tests')">Run Tests</button>
                <button class="quick-btn" onclick="fillInput('check-errors')">Check for Errors</button>
                <button class="quick-btn" onclick="fillInput('review-code')">Review Recent Code</button>
            </div>

            <div class="quick-commands">
                <h3>ğŸ—ï¸ Build Patterns</h3>
                <button class="quick-btn" onclick="fillInput('build-agent')">Build New Agent</button>
                <button class="quick-btn" onclick="fillInput('build-pipeline')">Build New Pipeline</button>
                <button class="quick-btn" onclick="fillInput('build-system')">Build Multi-Component System</button>
            </div>

            <div class="quick-commands">
                <h3>ğŸ’¡ Examples</h3>
                <div style="padding: 0.7rem; font-size: 0.85rem; color: #999; line-height: 1.6;">
                    Mining Development:
                    <br>â€¢ "Test the complete mining cycle"
                    <br>â€¢ "Fix stratum share submission error"
                    <br>â€¢ "Add PPLNS payout algorithm"
                    <br>â€¢ "Validate daemon-pool RPC connection"
                    <br><br>
                    General Development:
                    <br>â€¢ "Add authentication to the API"
                    <br>â€¢ "Fix the database connection bug"
                    <br>â€¢ "Refactor the user service"
                    <br>â€¢ "Add unit tests for validators"
                </div>
            </div>
        </div>

        <div class="chat-area">
            <div class="messages" id="messages">
                <div class="message system">
                    <div class="message-header">SUPERCOIN DEV STUDIO</div>
                    <div class="message-content">
                        Welcome to SuperCoin Dev Studio! I'm your AI development partner powered by Claude Code CLI with a complete automated development infrastructure.
                        <br><br>
                        <strong>ğŸ¯ What I Can Do:</strong>
                        <br>â€¢ Understand and navigate the SuperCoinServ codebase
                        <br>â€¢ Run intelligent workflow automation with 53 specialized AI agents
                        <br>â€¢ Execute 21 production pipelines covering the complete SDLC
                        <br>â€¢ Automatically route and chain workflows for complex multi-stage tasks
                        <br>â€¢ Test cryptocurrency mining with REAL components (no mocks!)
                        <br>â€¢ Build new agents, pipelines, and multi-component systems
                        <br>â€¢ Write, test, deploy, and monitor code changes
                        <br>â€¢ Debug issues, analyze errors, and optimize performance
                        <br><br>
                        <strong>ğŸ—ï¸ Meta-Pipeline Orchestration (28 Agents + 13 Pipelines):</strong>
                        <br>ğŸ“¦ Intelligent workflow routing with meta-pipeline-orchestrator
                        <br>ğŸ”„ Automatic pipeline chaining (feature â†’ test â†’ deploy â†’ monitor)
                        <br>ğŸ› ï¸ Development: bug-fix, feature-development, refactoring
                        <br>âœ… Testing: unit-test, integration-test, performance-test
                        <br>ğŸš€ Deployment: build-and-package, deployment, rollback
                        <br>ğŸ“Š Monitoring: health-check, performance-monitoring, error-detection
                        <br><br>
                        <strong>â›ï¸ Mining Automation System (17 Agents + 8 Pipelines):</strong>
                        <br>ğŸ”— Real component testing: bitcoind + CoiniumServ + miners
                        <br>âœ… Full mining cycle validation (job delivery â†’ share submission â†’ block discovery â†’ rewards)
                        <br>ğŸ”„ Automated testing: stratum, RPC, wallet, performance
                        <br>ğŸ› ï¸ Development: pool-bug-fix, pool-feature-development
                        <br>ğŸ“Š Integration: daemon-pool, miner-pool, full-mining-cycle
                        <br><br>
                        <strong>ğŸ’¡ Usage Examples:</strong>
                        <br>â€¢ "Add authentication, test it, and deploy" â†’ meta-orchestrator auto-chains workflows
                        <br>â€¢ "Fix the stratum bug" â†’ pool-bug-fix with real mining validation
                        <br>â€¢ "Test the complete mining cycle" â†’ full-mining-cycle end-to-end
                        <br>â€¢ "Deploy and monitor" â†’ build â†’ deploy â†’ health-check chaining
                        <br><br>
                        Current working directory: <code>/mnt/c/github/private-SuperCoinServ</code>
                        <br><br>
                        Just chat with me naturally! I'll proactively suggest the right automation for your task.
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <textarea
                        id="userInput"
                        placeholder="Tell me what you want to build or ask me anything about the SuperCoinServ project..."
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:8081');
        const messagesDiv = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const proxyStatus = document.getElementById('proxyStatus');
        const pipelineStatus = document.getElementById('pipelineStatus');
        const currentDirSpan = document.getElementById('currentDir');

        let conversationHistory = [];
        let isProcessing = false;
        let currentWorkingDir = '/mnt/c/github/private-SuperCoinServ';
        let activePipelineId = null;
        let pipelineVizVisible = false;
        let pipelineStages = [];
        let stageStatuses = {};

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });

        // Enter to send, Shift+Enter for newline
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        ws.onopen = () => {
            console.log('Connected to proxy');
            proxyStatus.classList.add('active');

            // Send initial context
            ws.send(JSON.stringify({
                type: 'supercoin-dev-studio-init',
                workingDirectory: currentWorkingDir,
                systemContext: `You are an AI development partner for the SuperCoinServ cryptocurrency mining pool project at /mnt/c/github/private-SuperCoinServ.

YOUR ROLE:
- Help with development, debugging, testing, and code quality
- Run specialized mining automation pipelines for testing and validation
- Run standard bug-fix and feature-development pipelines
- Understand the codebase and explain how things work
- Suggest improvements and best practices
- Be proactive about using the right pipeline for each task

IMPORTANT BEHAVIORS:
- When the user asks to build a feature, use the feature-development pipeline (or pool-feature-development for mining-related features)
- When the user reports a bug, use the bug-fix pipeline (or pool-bug-fix for mining-related bugs)
- When the user wants to test the mining infrastructure, use the mining system pipelines
- Be conversational and helpful
- Focus on the SuperCoinServ cryptocurrency mining pool context
- Track pipeline progress and provide updates

AVAILABLE TOOLS - COMPREHENSIVE AUTOMATION INFRASTRUCTURE:

You have access to a complete automated development infrastructure built by meta-pipelines. This includes 53 specialized AI agents and 21 production pipelines covering the full SDLC.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ META-PIPELINE ORCHESTRATION SYSTEM (13 Pipelines + 28 Agents)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Meta-Orchestrator Pipeline:**
- meta-pipeline-orchestrator: Master workflow that routes development tasks, chains pipelines, and orchestrates complex multi-stage operations

**Development Pipelines (3):**
- bug-fix-pipeline: Bug reproduction â†’ fix â†’ validation â†’ test collection
- feature-development-pipeline: Feature planning â†’ TDD â†’ validation â†’ test collection
- refactoring-pipeline: Code analysis â†’ refactor â†’ validation

**Testing Pipelines (3):**
- unit-test-pipeline: Unit test creation and execution
- integration-test-pipeline: Integration test orchestration
- performance-test-pipeline: Performance profiling and benchmarking

**Deployment Pipelines (3):**
- build-and-package-pipeline: Build artifacts â†’ package â†’ verify
- deployment-pipeline: Deploy â†’ smoke test â†’ health check
- rollback-pipeline: Rollback â†’ restore state â†’ verify

**Monitoring Pipelines (3):**
- health-check-pipeline: System health monitoring
- performance-monitoring-pipeline: Performance metrics and alerts
- error-detection-pipeline: Error detection and triage

**Meta-Pipeline Agents (28):**

Pipeline Builders:
- pipeline_architect: Designs new pipeline structures
- agent_architect: Creates new agent definitions
- component_validator: Validates pipeline/agent JSON files
- integration_reviewer: Reviews how pipelines integrate

Development Agents:
- bug_analyzer: Analyzes bug reports and symptoms
- root_cause_analyzer: Identifies root causes of bugs
- fix_implementer: Implements bug fixes
- feature_architect: Designs feature architecture
- implementation_planner: Plans feature implementation steps
- code_implementer: Implements features and code
- refactoring_planner: Plans code refactoring
- code_refactorer: Executes refactoring operations

Testing Agents:
- unit_test_writer: Writes unit tests
- integration_test_designer: Designs integration tests
- performance_profiler: Profiles performance and identifies bottlenecks
- test_executor: Executes test suites
- test_validator: Validates test results

Deployment Agents:
- build_manager: Manages build processes
- package_creator: Creates deployment packages
- artifact_validator: Validates build artifacts
- deployment_manager: Manages deployments
- smoke_tester: Runs smoke tests
- rollback_manager: Manages rollbacks

Monitoring Agents:
- health_checker: Checks system health
- performance_monitor: Monitors performance metrics
- error_detector: Detects and triages errors
- metrics_analyzer: Analyzes system metrics
- alert_manager: Manages alerts and notifications

Support Agents:
- agent_router: Routes tasks to appropriate pipelines (CRITICAL for meta-orchestrator!)
- diagnostics_agent: System diagnostics and troubleshooting
- emergency_shutdown: Emergency shutdown and recovery

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â›ï¸ MINING AUTOMATION SYSTEM (8 Pipelines + 17 Agents)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Mining System Pipelines:**

Setup & Infrastructure:
- mining-infrastructure-setup: Complete infrastructure setup (daemon â†’ wallet â†’ pool â†’ miner)

Integration Testing:
- daemon-pool-integration: Daemonâ†”Pool RPC integration testing
- miner-integration: Minerâ†”Pool stratum integration testing
- share-submission-test: Share submission validation
- block-discovery-test: Block discovery cycle validation

Comprehensive Testing:
- full-mining-cycle: End-to-end mining cycle validation (job delivery â†’ share submission â†’ block discovery â†’ rewards)

Development Workflows:
- pool-bug-fix: Bug reproduction and fixing using real mining components
- pool-feature-development: Feature development with mining cycle validation

**Mining Automation Agents (17):**

Core Infrastructure:
- bitcoin_daemon_manager: Manage bitcoind in regtest mode (start, fund wallets, generate blocks)
- pool_server_manager: Launch and manage CoiniumServ pool server
- miner_manager: Configure and run mining software (cpuminer, cgminer)
- wallet_manager: Create and manage mining wallet addresses

Integration Testing:
- daemon_pool_connector: Validate daemonâ†”pool RPC connection
- miner_pool_connector: Validate minerâ†”pool stratum connection
- job_validator: Verify miner receives valid mining jobs from pool
- share_validator: Test share submission from miner to pool
- block_validator: Verify complete block discovery cycle

System Testing:
- cycle_integration_tester: End-to-end full mining cycle validation
- performance_analyzer: Analyze mining performance and efficiency
- stratum_monitor: Monitor stratum protocol communication
- rpc_tester: Test Bitcoin RPC endpoints
- network_monitor: Monitor network connectivity

Support:
- config_generator: Generate config files for daemon, pool, miner
- log_analyzer: Parse and analyze logs from all components
- error_recovery_agent: Detect and recover from mining failures

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ WHEN TO USE EACH PIPELINE TYPE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Meta-Orchestrator Workflows:**

Use "meta-pipeline-orchestrator" when:
- User requests complex multi-stage workflows (e.g., "add auth feature, test it, and deploy")
- User wants automated routing to the right pipeline
- User needs pipeline chaining (e.g., feature â†’ test â†’ deploy â†’ monitor)
- User asks for "the complete workflow" or "end-to-end automation"

Example routing scenarios:
â€¢ "Fix this bug" â†’ bug-fix-pipeline
â€¢ "Add new feature" â†’ feature-development-pipeline â†’ integration-test-pipeline
â€¢ "Deploy to production" â†’ build-and-package â†’ deployment â†’ health-check
â€¢ "Rollback deployment" â†’ rollback-pipeline â†’ health-check
â€¢ "Optimize performance" â†’ refactoring-pipeline â†’ performance-test-pipeline

**Development Pipelines:**

Use "bug-fix-pipeline" when:
- User reports a bug or error
- User asks to fix something that's broken
- User mentions "not working", "broken", "error", "issue"

Use "feature-development-pipeline" when:
- User asks to add new functionality
- User requests new features or enhancements
- User wants test-driven development (TDD approach)

Use "refactoring-pipeline" when:
- User asks to clean up code
- User wants to improve code structure or quality
- User mentions "refactor", "clean up", "improve code quality"

**Testing Pipelines:**

Use "unit-test-pipeline" when:
- User asks to write tests for specific functions or modules
- User wants unit test coverage

Use "integration-test-pipeline" when:
- User wants to test how components work together
- User asks for end-to-end testing
- User needs API or service integration tests

Use "performance-test-pipeline" when:
- User asks about performance or speed
- User wants benchmarks or profiling
- User mentions "slow", "optimize", "performance"

**Deployment Pipelines:**

Use "build-and-package-pipeline" when:
- User asks to build or package the application
- User wants to create deployment artifacts

Use "deployment-pipeline" when:
- User asks to deploy the application
- User wants to push to staging or production

Use "rollback-pipeline" when:
- User reports deployment issues
- User asks to revert or undo a deployment

**Monitoring Pipelines:**

Use "health-check-pipeline" when:
- User asks if the system is healthy
- User wants to check system status

Use "performance-monitoring-pipeline" when:
- User wants continuous performance monitoring
- User asks for performance metrics

Use "error-detection-pipeline" when:
- User wants to check for errors
- User asks to monitor for issues

**Mining-Specific Pipelines:**

Use "pool-bug-fix" when:
- User reports bugs related to stratum protocol, job delivery, share submission, block discovery
- Issues with daemonâ†”pool or minerâ†”pool communication
- Mining reward or wallet issues
- RPC or network connectivity problems

Use "pool-feature-development" when:
- Adding new pool payout algorithms
- Implementing new stratum features
- Adding mining performance optimizations
- Building new monitoring or analytics features

Use "full-mining-cycle" when:
- User wants to test the entire mining stack end-to-end
- Validating a deployment or configuration
- Regression testing after major changes
- Demonstrating the system works correctly

Use "mining-infrastructure-setup" when:
- User needs to set up or reset the mining environment
- First-time setup or clean environment needed

**What These Pipelines Do:**

The mining system pipelines automate the complete testing workflow:
âœ… Launch bitcoind in regtest mode
âœ… Generate funded wallets for mining rewards
âœ… Start CoiniumServ pool server
âœ… Configure and run miners
âœ… Validate job delivery (daemonâ†’poolâ†’miner)
âœ… Test share submission (minerâ†’pool)
âœ… Verify block discovery (poolâ†’daemon)
âœ… Confirm wallet receives mining rewards

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ EXAMPLE USAGE PATTERNS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Meta-Orchestrator Examples:**

User: "Add user authentication, test it, and deploy to staging"
â†’ Use meta-pipeline-orchestrator (auto-chains feature â†’ test â†’ deploy):
[PIPELINE-EXECUTE]
{
  "pipelineName": "meta-pipeline-orchestrator",
  "userPrompt": "Add JWT-based user authentication system, create integration tests, and deploy to staging environment",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "The deployment is broken, roll it back and verify the system is healthy"
â†’ Use meta-pipeline-orchestrator (auto-chains rollback â†’ health-check):
[PIPELINE-EXECUTE]
{
  "pipelineName": "meta-pipeline-orchestrator",
  "userPrompt": "Rollback the latest deployment and verify system health",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

**Development Examples:**

User: "Fix the stratum share submission error"
â†’ Use bug-fix-pipeline or pool-bug-fix (mining-specific):
[PIPELINE-EXECUTE]
{
  "pipelineName": "pool-bug-fix",
  "userPrompt": "Fix stratum share submission error - shares are being rejected by the pool",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Add a new PPLNS payout algorithm"
â†’ Use feature-development-pipeline or pool-feature-development (mining-specific):
[PIPELINE-EXECUTE]
{
  "pipelineName": "pool-feature-development",
  "userPrompt": "Implement PPLNS (Pay Per Last N Shares) payout algorithm for the pool",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Refactor the configuration loader to use JSON schema validation"
â†’ Use refactoring-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "refactoring-pipeline",
  "userPrompt": "Refactor the configuration loader to use JSON schema validation for better error handling",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

**Testing Examples:**

User: "Test the complete mining cycle"
â†’ Use full-mining-cycle pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "full-mining-cycle",
  "userPrompt": "Validate complete mining cycle from job delivery to reward receipt",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Write unit tests for the wallet manager"
â†’ Use unit-test-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "unit-test-pipeline",
  "userPrompt": "Create comprehensive unit tests for the wallet manager module",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Run integration tests for the stratum server"
â†’ Use integration-test-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "integration-test-pipeline",
  "userPrompt": "Execute integration tests for stratum server with real miner connections",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

**Deployment Examples:**

User: "Build and package the pool server for production"
â†’ Use build-and-package-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "build-and-package-pipeline",
  "userPrompt": "Build and package SuperCoinServ pool server for production deployment",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Deploy to staging and run smoke tests"
â†’ Use deployment-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "deployment-pipeline",
  "userPrompt": "Deploy SuperCoinServ to staging environment and execute smoke tests",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

**Monitoring Examples:**

User: "Check if the pool server is healthy"
â†’ Use health-check-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "health-check-pipeline",
  "userPrompt": "Run health checks on the pool server and report status",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

User: "Detect any errors in the logs"
â†’ Use error-detection-pipeline:
[PIPELINE-EXECUTE]
{
  "pipelineName": "error-detection-pipeline",
  "userPrompt": "Scan logs for errors and exceptions, categorize by severity",
  "workingDirectory": "/mnt/c/github/private-SuperCoinServ"
}
[/PIPELINE-EXECUTE]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“š DOCUMENTATION & RESOURCES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Meta-Pipeline System Documentation:**
- META_PIPELINE_SYSTEM_DOCUMENTATION.md: Complete architecture (870 lines)
  - All 28 meta-pipeline agents with detailed descriptions
  - All 13 meta-orchestrator pipelines
  - Routing logic and pipeline chaining examples
  - Agent decision formats and stage connections

- PIPELINE_IMPLEMENTATION_SUMMARY.md: Implementation details (460 lines)
  - Verification steps and validation criteria
  - File locations and inventory
  - How sub-pipelines work
  - Integration patterns

- PROOF_OF_COMPLETION.md: Completion proof and metrics
  - File counts and system size
  - Agent categories and capabilities
  - Pipeline coverage across SDLC

**Mining System Documentation:**
Same files as above, plus mining-specific sections covering:
- All 17 mining automation agents
- All 8 mining system pipelines
- Real component testing (no mocks!)
- Integration patterns for daemon, pool, miner

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ KEY USAGE PHILOSOPHY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**Be Proactive About Pipeline Usage:**
- When a user asks to "fix a bug" â†’ IMMEDIATELY suggest the appropriate pipeline
- When a user asks to "add a feature" â†’ IMMEDIATELY suggest the appropriate pipeline
- When a user asks for complex workflows â†’ IMMEDIATELY suggest meta-pipeline-orchestrator
- Don't wait to be asked - OFFER the right automation tool

**Choose the Right Abstraction Level:**
- Simple question about code â†’ Use Read/Grep/Glob tools to explore
- Single bug fix â†’ Suggest bug-fix-pipeline or pool-bug-fix
- Single feature â†’ Suggest feature-development-pipeline or pool-feature-development
- Complex multi-stage workflow â†’ Suggest meta-pipeline-orchestrator
- Mining-specific testing â†’ Suggest mining system pipelines

**Pipeline Chaining Power:**
The meta-orchestrator's REAL power is automatic pipeline chaining:
- User doesn't need to know pipeline names
- User doesn't need to understand the workflow
- User just describes what they want: "Add auth, test it, deploy it"
- The agent_router automatically chains: feature â†’ integration-test â†’ build â†’ deploy â†’ health-check

**Example Decision Tree:**

User says: "Why aren't miners getting jobs?"
â†’ Explore first (Grep/Read to understand the code)
â†’ Then suggest: "I found the issue. Would you like me to run pool-bug-fix pipeline to fix and validate it?"

User says: "Add PPLNS payout algorithm"
â†’ IMMEDIATELY suggest: "I'll run the pool-feature-development pipeline to implement this with full mining cycle validation"

User says: "Add auth feature, test it thoroughly, and deploy to staging"
â†’ IMMEDIATELY suggest: "I'll run the meta-pipeline-orchestrator which will automatically chain: feature-development â†’ integration-test â†’ build-and-package â†’ deployment â†’ health-check"

**Benefits of This System:**

âœ… Complete SDLC Coverage: Development â†’ Testing â†’ Deployment â†’ Monitoring
âœ… Self-Evolving: Can build new pipelines and agents as needed
âœ… Quality Assurance: Every component goes through standardized QA process
âœ… Traceable: Full execution logs and structured state tracking
âœ… Production-Ready: All 53 agents and 21 pipelines are validated and documented
âœ… Mining-Specific: Real cryptocurrency mining testing with actual components
âœ… Intelligent Routing: Meta-orchestrator automatically picks the right workflow

**Remember:**
- You have 53 specialized AI agents at your disposal
- You have 21 production pipelines covering the complete SDLC
- You can build new agents, pipelines, and systems using the meta-pipeline patterns
- You are a SPECIALIZED development assistant for SuperCoinServ
- You have DEEP KNOWLEDGE of pipeline architecture and automation patterns
- Be PROACTIVE about suggesting and using these tools!

PIPELINE DESIGN PATTERNS:

1. **Sub-Pipeline Architecture** (for complex multi-component systems):
   - Use the "sub_pipeline" stage type to compose larger workflows from reusable templates
   - Example: meta-pipeline-builder-v2 uses agent-build-process and pipeline-build-process sub-pipelines
   - Benefits: Quality assurance through standardized processes, maintainability, reusability

2. **5-Stage Quality Assurance Pattern** (for building agents/components):
   Stage 1: Design Specification (task_planner)
     - Creates detailed design with UNDERSTANDING, APPROACH, STEPS, EVIDENCE, CONFIDENCE
   Stage 2: Design Review (discerning_expert)
     - APPROVED or REJECTED with feedback (loops back on rejection)
   Stage 3: Implementation (agent_architect or appropriate builder)
     - Builds the actual artifact (agent JSON, pipeline template, code)
   Stage 4: Validation (component_validator or appropriate validator)
     - Schema validation, correctness checks, functional tests
   Stage 5: Finalization (proof_validator)
     - Final review and approval

3. **Meta-Pipeline Pattern** (for orchestrating multi-component builds):
   - Analysis stage: Break down the system into components
   - Builder stages: Use sub-pipelines to build each component with QA
   - Integration stage: Validate all components work together
   - Documentation stage: Generate comprehensive system docs

4. **Sub-Pipeline Invocation Format**:
   {
     "id": "build_component",
     "name": "Build Component X",
     "type": "sub_pipeline",           // â† Marks as nested pipeline
     "agent": "pipeline_executor",     // â† Meta-agent coordinator
     "description": "Use sub-pipeline to build component",
     "inputs": ["previous_stage"],
     "config": {
       "pipeline": "agent-build-process",  // â† Template to execute
       "inheritContext": true              // â† Pass context to child
     },
     "prompt": "Build the X component with Y capabilities..."
   }

5. **How Sub-Pipelines Work** (proxy/server.js:2678-2740):
   - Proxy detects stage.type === 'sub_pipeline'
   - Loads the referenced template from templates/
   - Recursively executes all stages of the sub-pipeline
   - Aggregates results and returns to parent pipeline
   - Creates distinct execution logs for traceability

WHEN TO SUGGEST THESE PATTERNS:
- User wants to build multiple related components (agents, pipelines, services)
- User wants quality assurance and validation built into the workflow
- User wants reusable processes across different projects
- User asks "how do we build this properly?" or "what's the right way?"
- User mentions words like: "architecture", "infrastructure", "system", "components", "agents", "pipelines"

EXAMPLE WORKFLOWS:

Building a Mining Infrastructure:
  "I want to build a complete Bitcoin mining automation system with daemons, pools, and wallets"
  â†’ Suggest: Use meta-pipeline-builder-v2 pattern
  â†’ Creates: 18 agents via agent-build-process, 8 pipelines via pipeline-build-process
  â†’ Result: Fully validated, documented, traceable system

Building a Single Agent:
  "I need a network monitor agent"
  â†’ Suggest: Use agent-build-process template directly
  â†’ Creates: Design spec â†’ Review â†’ Implementation â†’ Validation â†’ Finalization
  â†’ Result: Production-ready agent with design documentation

Building a Custom Pipeline:
  "Create a deployment pipeline for SuperCoinServ"
  â†’ Suggest: Use pipeline-build-process template
  â†’ Creates: Design â†’ Review â†’ Build â†’ Validate â†’ Finalize
  â†’ Result: Tested, validated pipeline template

Remember: You're a specialized development assistant for THIS specific project with deep knowledge of pipeline architecture and quality assurance patterns.`
            }));
        };

        ws.onclose = () => {
            console.log('Disconnected from proxy');
            proxyStatus.classList.remove('active');
            pipelineStatus.classList.remove('active');
            addMessage('system', 'Disconnected from proxy server. Please restart the proxy.');
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            addMessage('system', 'Connection error. Make sure the proxy server is running on port 8081.');
        };

        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);

                if (data.type === 'assistant-message') {
                    addMessage('assistant', data.content);
                    isProcessing = false;
                    updateUI();
                } else if (data.type === 'pipeline-update') {
                    addPipelineUpdate(data);
                } else if (data.type === 'pipeline-started') {
                    pipelineStatus.classList.add('active');
                    activePipelineId = data.pipelineId;
                    addMessage('pipeline', `Pipeline started: ${data.pipelineName || 'Development Pipeline'}`);
                    initializePipelineVisualization(data);
                } else if (data.type === 'pipeline-stage-update') {
                    updatePipelineStage(data);
                } else if (data.type === 'pipeline-completed') {
                    pipelineStatus.classList.remove('active');
                    addMessage('pipeline', `Pipeline completed successfully!`);
                    completePipelineVisualization();
                    activePipelineId = null;
                } else if (data.type === 'infographic-ready') {
                    addInfographicLink(data);
                } else if (data.type === 'error') {
                    addMessage('system', `Error: ${data.message}`);
                    isProcessing = false;
                    updateUI();
                }
            } catch (e) {
                console.error('Error parsing message:', e);
            }
        };

        function addMessage(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            headerDiv.textContent = role.toUpperCase();

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            // Basic markdown-style formatting
            let formattedContent = content
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');

            contentDiv.innerHTML = formattedContent;

            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);

            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            conversationHistory.push({ role, content });
        }

        function addPipelineUpdate(data) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message pipeline';

            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            headerDiv.textContent = 'PIPELINE UPDATE';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = data.message;

            if (data.progress) {
                const progressDiv = document.createElement('div');
                progressDiv.className = 'pipeline-progress';
                progressDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>Progress: ${data.progress.current} / ${data.progress.total} stages</span>
                        <span>${Math.round((data.progress.current / data.progress.total) * 100)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(data.progress.current / data.progress.total) * 100}%"></div>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.85rem; color: #999;">
                        Current: ${data.progress.currentStage || 'Initializing...'}
                    </div>
                `;
                contentDiv.appendChild(progressDiv);
            }

            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function addInfographicLink(data) {
            const lastMessage = messagesDiv.lastElementChild;
            if (lastMessage && lastMessage.classList.contains('pipeline')) {
                const link = document.createElement('a');
                const pipelineId = data.pipelineId || activePipelineId;
                link.href = `http://localhost:3005/infographic-viewer.html?pipeline=${pipelineId}`;
                link.className = 'infographic-link';
                link.textContent = 'ğŸ“Š View Real-time Infographic';
                link.target = '_blank';
                lastMessage.querySelector('.message-content').appendChild(link);
            }
        }

        function setWorkingDirectory() {
            const newDir = document.getElementById('workingDir').value.trim();
            if (newDir) {
                currentWorkingDir = newDir;
                currentDirSpan.textContent = newDir;

                ws.send(JSON.stringify({
                    type: 'directory-change',
                    directory: newDir
                }));

                addMessage('system', `Working directory changed to: ${newDir}`);
            }
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (!message || isProcessing) return;

            addMessage('user', message);
            userInput.value = '';
            userInput.style.height = 'auto';

            isProcessing = true;
            updateUI();

            // Send to Claude via proxy with SuperCoin dev studio context
            ws.send(JSON.stringify({
                type: 'supercoin-dev-studio-query',
                message: message,
                workingDirectory: currentWorkingDir,
                history: conversationHistory.slice(-10)
            }));
        }

        function fillInput(command) {
            const commands = {
                'project-status': 'What is the current status of the SuperCoinServ project?',
                'recent-changes': 'What changes were made recently to the codebase?',
                'list-pipelines': 'Show me all available development pipelines',
                'codebase-structure': 'Explain the structure of the SuperCoinServ codebase',
                'run-tests': 'Run the test suite and show me the results',
                'check-errors': 'Check for any errors or issues in the code',
                'review-code': 'Review the most recent code changes',
                'build-agent': 'Build a new agent using the 5-stage quality assurance pattern',
                'build-pipeline': 'Build a new pipeline using the pipeline-build-process template',
                'build-system': 'Build a multi-component system using meta-pipeline architecture with sub-pipelines'
            };

            userInput.value = commands[command] || command;
            userInput.focus();
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        }

        function updateUI() {
            sendBtn.disabled = isProcessing;
            sendBtn.innerHTML = isProcessing ? '<span class="loading"></span>' : 'Send';
            userInput.disabled = isProcessing;
        }

        // Pipeline Visualization Functions
        function toggleVisualization() {
            pipelineVizVisible = !pipelineVizVisible;
            const panel = document.getElementById('pipelineVizPanel');
            if (pipelineVizVisible) {
                panel.classList.add('visible');
            } else {
                panel.classList.remove('visible');
            }
        }

        function initializePipelineVisualization(data) {
            // Auto-show visualization when pipeline starts
            if (!pipelineVizVisible) {
                toggleVisualization();
            }

            // Initialize stage list from pipeline configuration
            pipelineStages = data.stages || [];
            stageStatuses = {};

            // Set all stages to pending initially
            pipelineStages.forEach(stage => {
                stageStatuses[stage.id] = {
                    status: 'pending',
                    name: stage.name || stage.id,
                    agent: stage.agent,
                    output: null,
                    error: null
                };
            });

            renderPipelineGraph();
        }

        function updatePipelineStage(data) {
            const stageId = data.stageId;
            if (!stageStatuses[stageId]) {
                stageStatuses[stageId] = {
                    name: data.stageName || stageId,
                    agent: data.agent
                };
            }

            // Update stage status
            if (data.status) {
                stageStatuses[stageId].status = data.status;
            }
            if (data.output) {
                stageStatuses[stageId].output = data.output;
            }
            if (data.error) {
                stageStatuses[stageId].error = data.error;
                stageStatuses[stageId].status = 'error';
            }

            renderPipelineGraph();
        }

        function completePipelineVisualization() {
            // Mark any remaining stages as completed
            Object.keys(stageStatuses).forEach(stageId => {
                if (stageStatuses[stageId].status === 'in-progress') {
                    stageStatuses[stageId].status = 'completed';
                }
            });
            renderPipelineGraph();
        }

        function renderPipelineGraph() {
            const graphDiv = document.getElementById('pipelineGraph');

            if (pipelineStages.length === 0) {
                graphDiv.innerHTML = `
                    <div class="no-pipeline">
                        <div class="no-pipeline-icon">â³</div>
                        <div>No pipeline running</div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem;">Start a pipeline to see the visualization</div>
                    </div>
                `;
                return;
            }

            // Render each stage as a node
            let html = '';
            pipelineStages.forEach((stage, index) => {
                const status = stageStatuses[stage.id] || { status: 'pending', name: stage.name || stage.id, agent: stage.agent };
                const icon = getStageIcon(status.status);

                html += `
                    <div class="pipeline-node ${status.status}" data-stage-id="${stage.id}">
                        <div class="node-header">
                            <div class="node-icon">${icon}</div>
                            <div class="node-title">${status.name}</div>
                            <div class="node-status ${status.status}">${status.status}</div>
                        </div>
                        ${status.agent ? `<div class="node-agent">Agent: ${status.agent}</div>` : ''}
                        ${status.output ? `<div class="node-output ${status.status}">${escapeHtml(status.output)}</div>` : ''}
                        ${status.error ? `<div class="node-output error">${escapeHtml(status.error)}</div>` : ''}
                    </div>
                `;
            });

            graphDiv.innerHTML = html;

            // Auto-scroll to in-progress node
            const inProgressNode = graphDiv.querySelector('.pipeline-node.in-progress');
            if (inProgressNode) {
                inProgressNode.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function getStageIcon(status) {
            const icons = {
                'pending': 'â¸ï¸',
                'in-progress': 'âš™ï¸',
                'completed': 'âœ…',
                'error': 'âŒ'
            };
            return icons[status] || 'â¸ï¸';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Request pipeline state updates every 2 seconds when pipeline is active
        setInterval(() => {
            if (activePipelineId && pipelineVizVisible) {
                ws.send(JSON.stringify({
                    type: 'request-pipeline-state',
                    pipelineId: activePipelineId
                }));
            }
        }, 2000);
    </script>
</body>
</html>
