{
  "id": "content-generation-v1",
  "name": "Content Generation Pipeline V1",
  "description": "AI-driven content creation pipeline for Warhammer 40K MMO. Creates zones, quests, NPCs, enemies, and dialogues using the declarative content system.",
  "version": "1.0.0",
  "category": "game-content",
  "stages": [
    {
      "id": "analyze_requirements",
      "name": "Analyze Content Requirements",
      "type": "analyzer",
      "agent": "content_requirement_analyzer",
      "description": "Analyze content request to determine scope, faction, level range, and required files",
      "decisions": [
        {"choice": "requirements_defined", "description": "Content requirements clearly defined with file list"}
      ]
    },
    {
      "id": "design_zone",
      "name": "Design Zone Layout",
      "type": "designer",
      "agent": "zone_designer",
      "description": "Create zone definition with ASCII map, terrain, NPCs, spawn points",
      "inputs": ["analyze_requirements"],
      "decisions": [
        {"choice": "zone_designed", "description": "Zone layout complete with map and configuration"},
        {"choice": "skip_zone", "description": "No new zone required for this content"}
      ]
    },
    {
      "id": "design_enemies",
      "name": "Design Enemy Stats",
      "type": "designer",
      "agent": "enemy_designer",
      "description": "Create enemy stat blocks, abilities, behaviors, and drop tables",
      "inputs": ["analyze_requirements", "design_zone"],
      "decisions": [
        {"choice": "enemies_designed", "description": "All enemy stats and drops defined"},
        {"choice": "skip_enemies", "description": "No new enemies required"}
      ]
    },
    {
      "id": "write_quests",
      "name": "Write Quest Definitions",
      "type": "designer",
      "agent": "quest_writer",
      "description": "Create quest files with objectives, rewards, prerequisites, and narrative",
      "inputs": ["analyze_requirements", "design_zone", "design_enemies"],
      "decisions": [
        {"choice": "quests_written", "description": "All quest definitions complete"},
        {"choice": "skip_quests", "description": "No quests required for this content"}
      ]
    },
    {
      "id": "write_dialogues",
      "name": "Write NPC Dialogues",
      "type": "designer",
      "agent": "dialogue_writer",
      "description": "Create dialogue trees for NPCs with quest integration and branching conversations",
      "inputs": ["analyze_requirements", "design_zone", "write_quests"],
      "decisions": [
        {"choice": "dialogues_written", "description": "All NPC dialogue trees complete"},
        {"choice": "skip_dialogues", "description": "No dialogues required for this content"}
      ]
    },
    {
      "id": "assemble_content",
      "name": "Assemble Content Files",
      "type": "executor",
      "agent": "content_assembler",
      "description": "Combine all content pieces into final files with proper cross-references",
      "inputs": ["design_zone", "design_enemies", "write_quests", "write_dialogues"],
      "decisions": [
        {"choice": "content_assembled", "description": "All content files written to correct locations"}
      ]
    },
    {
      "id": "validate_content",
      "name": "Validate Content",
      "type": "validator",
      "agent": "content_validator",
      "description": "Run content validation pipeline to check syntax and cross-references",
      "inputs": ["assemble_content"],
      "decisions": [
        {"choice": "CONTENT_VALID", "description": "All content passes validation"},
        {"choice": "CONTENT_NEEDS_FIXES", "description": "Validation errors found, need fixes"},
        {"choice": "VALIDATION_ERROR", "description": "Validator infrastructure failed"}
      ]
    },
    {
      "id": "fix_zone_issues",
      "name": "Fix Zone Issues",
      "type": "designer",
      "agent": "zone_designer",
      "description": "Fix zone-related validation errors (map, enemies, spawn points)",
      "inputs": ["validate_content"],
      "decisions": [
        {"choice": "zone_fixed", "description": "Zone issues resolved"}
      ]
    },
    {
      "id": "fix_quest_issues",
      "name": "Fix Quest Issues",
      "type": "designer",
      "agent": "quest_writer",
      "description": "Fix quest-related validation errors (prerequisites, objectives, rewards)",
      "inputs": ["validate_content"],
      "decisions": [
        {"choice": "quests_fixed", "description": "Quest issues resolved"}
      ]
    },
    {
      "id": "fix_dialogue_issues",
      "name": "Fix Dialogue Issues",
      "type": "designer",
      "agent": "dialogue_writer",
      "description": "Fix dialogue-related validation errors (nodes, references, actions)",
      "inputs": ["validate_content"],
      "decisions": [
        {"choice": "dialogues_fixed", "description": "Dialogue issues resolved"}
      ]
    },
    {
      "id": "compile_content",
      "name": "Compile to SQL",
      "type": "executor",
      "agent": "content_compiler_agent",
      "description": "Compile validated content into SQL for database seeding",
      "inputs": ["validate_content"],
      "decisions": [
        {"choice": "COMPILATION_SUCCESS", "description": "SQL generated successfully"},
        {"choice": "COMPILATION_FAILED", "description": "Compilation failed"}
      ]
    },
    {
      "id": "seed_content",
      "name": "Load Content into Database",
      "type": "executor",
      "agent": "seed_content_agent",
      "description": "Execute npm run seed:content to load compiled SQL into database",
      "inputs": ["compile_content"],
      "decisions": [
        {"choice": "CONTENT_SEEDED", "description": "Content successfully loaded into database"},
        {"choice": "DATABASE_ERROR", "description": "Database connection or query error"},
        {"choice": "FILE_NOT_FOUND", "description": "Compiled SQL file doesn't exist"}
      ]
    }
  ],
  "flow": {
    "type": "conditional",
    "description": "Content creation workflow with validation loop",
    "connections": [
      {
        "from": "analyze_requirements",
        "to": "design_zone",
        "condition": "requirements_defined",
        "description": "Requirements defined, start zone design"
      },
      {
        "from": "design_zone",
        "to": "design_enemies",
        "condition": "zone_designed",
        "description": "Zone complete, design enemies"
      },
      {
        "from": "design_zone",
        "to": "write_quests",
        "condition": "skip_zone",
        "description": "No zone needed, proceed to quests"
      },
      {
        "from": "design_enemies",
        "to": "write_quests",
        "condition": "enemies_designed",
        "description": "Enemies designed, write quests"
      },
      {
        "from": "design_enemies",
        "to": "write_quests",
        "condition": "skip_enemies",
        "description": "No enemies needed, proceed to quests"
      },
      {
        "from": "write_quests",
        "to": "write_dialogues",
        "condition": "quests_written",
        "description": "Quests complete, write dialogues"
      },
      {
        "from": "write_quests",
        "to": "assemble_content",
        "condition": "skip_quests",
        "description": "No quests needed, proceed to assembly"
      },
      {
        "from": "write_dialogues",
        "to": "assemble_content",
        "condition": "dialogues_written",
        "description": "Dialogues complete, assemble content"
      },
      {
        "from": "write_dialogues",
        "to": "assemble_content",
        "condition": "skip_dialogues",
        "description": "No dialogues needed, proceed to assembly"
      },
      {
        "from": "assemble_content",
        "to": "validate_content",
        "condition": "content_assembled",
        "description": "Content assembled, run validation"
      },
      {
        "from": "validate_content",
        "to": "compile_content",
        "condition": "CONTENT_VALID",
        "description": "Validation passed, compile to SQL"
      },
      {
        "from": "validate_content",
        "to": "fix_zone_issues",
        "condition": "CONTENT_NEEDS_FIXES",
        "description": "Zone issues found, route to zone designer"
      },
      {
        "from": "validate_content",
        "to": null,
        "condition": "VALIDATION_ERROR",
        "description": "Validator infrastructure failed - PIPELINE ENDS"
      },
      {
        "from": "fix_zone_issues",
        "to": "validate_content",
        "condition": "zone_fixed",
        "description": "Zone fixed, re-validate"
      },
      {
        "from": "fix_quest_issues",
        "to": "validate_content",
        "condition": "quests_fixed",
        "description": "Quests fixed, re-validate"
      },
      {
        "from": "fix_dialogue_issues",
        "to": "validate_content",
        "condition": "dialogues_fixed",
        "description": "Dialogues fixed, re-validate"
      },
      {
        "from": "compile_content",
        "to": "seed_content",
        "condition": "COMPILATION_SUCCESS",
        "description": "Content compiled successfully, load into database"
      },
      {
        "from": "compile_content",
        "to": "validate_content",
        "condition": "COMPILATION_FAILED",
        "description": "Compilation failed, re-validate content"
      },
      {
        "from": "seed_content",
        "to": null,
        "condition": "CONTENT_SEEDED",
        "description": "Content loaded into database - PIPELINE ENDS (SUCCESS)"
      },
      {
        "from": "seed_content",
        "to": null,
        "condition": "DATABASE_ERROR",
        "description": "Database error - PIPELINE ENDS (manual intervention needed)"
      },
      {
        "from": "seed_content",
        "to": "compile_content",
        "condition": "FILE_NOT_FOUND",
        "description": "SQL file missing, re-compile"
      }
    ]
  },
  "metadata": {
    "tags": ["game-content", "warhammer-40k", "zones", "quests", "dialogues", "enemies"],
    "author": "Claude Plus Development System",
    "targetProject": "Warhammer 40K: Imperium Divided",
    "workingDirectory": "/mnt/c/github/40kgw/output",
    "contentDirectory": "/mnt/c/github/40kgw/output/content",
    "validationCommand": "npm run content:validate",
    "compileCommand": "npm run content:compile",
    "previewCommand": "npm run content:preview",
    "seedCommand": "npm run seed:content"
  }
}
