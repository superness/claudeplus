{
  "id": "spec-generator-v1",
  "name": "Specification Generator V1",
  "description": "Generates a complete protocol specification from thesis documents and requirements",
  "version": "1.0.0",
  "type": "sub_pipeline",
  "stages": [
    {
      "id": "requirements_extraction",
      "name": "Extract Requirements from Theses",
      "type": "agent",
      "description": "Analyzes thesis documents to extract technical requirements and constraints",
      "agent": "thesis_requirements_extractor",
      "prompt": "Extract technical requirements from the thesis documents for this protocol subsystem. Focus on the specific theses mentioned in the stub specification.",
      "config": {
        "inputs": [],
        "outputs": ["soft_constraints", "hard_constraints", "anti_patterns", "design_principles"]
      },
      "routing": {
        "next_stage": "spec_drafting"
      }
    },
    {
      "id": "spec_drafting",
      "name": "Draft Protocol Specification",
      "type": "agent",
      "description": "Writes the detailed protocol specification based on extracted requirements",
      "agent": "protocol_spec_writer",
      "prompt": "Write a complete, detailed protocol specification for this subsystem based on the requirements extracted from the thesis documents.",
      "config": {
        "inputs": ["requirements_extraction"],
        "outputs": ["specification_content"]
      },
      "routing": {
        "next_stage": "spec_review"
      }
    },
    {
      "id": "spec_review",
      "name": "Peer Review Specification",
      "type": "agent",
      "description": "Reviews the specification for completeness, feasibility, and principle alignment",
      "agent": "spec_peer_reviewer",
      "prompt": "Review this protocol specification for completeness, technical feasibility, and alignment with ChainSocial's design principles from the thesis documents.",
      "config": {
        "inputs": ["spec_drafting"],
        "outputs": ["review_feedback", "verdict"]
      },
      "routing": {
        "decision_field": "DECISION",
        "possible_next_stages": [
          {
            "decision": "approved",
            "next_stage": "spec_finalization"
          },
          {
            "decision": "needs_revision",
            "next_stage": "spec_revision"
          }
        ],
        "default_next_stage": "spec_finalization"
      }
    },
    {
      "id": "spec_revision",
      "name": "Revise Specification",
      "type": "agent",
      "description": "Revises the specification based on peer review feedback",
      "agent": "spec_reviser",
      "prompt": "Revise the protocol specification based on the peer review feedback. Address all required changes and improve the specification.",
      "config": {
        "inputs": ["spec_drafting", "spec_review"],
        "outputs": ["revised_specification"]
      },
      "routing": {
        "next_stage": "spec_finalization"
      }
    },
    {
      "id": "spec_finalization",
      "name": "Finalize Specification",
      "type": "agent",
      "description": "Final formatting and quality check of the specification",
      "agent": "protocol_spec_writer",
      "prompt": "Finalize the protocol specification. Ensure all sections are complete, formatting is consistent, and the document is ready for implementation.",
      "config": {
        "inputs": ["spec_drafting", "spec_review", "spec_revision"],
        "outputs": ["final_specification"]
      },
      "routing": {
        "next_stage": null
      }
    }
  ],
  "connections": [
    {"from": "requirements_extraction", "to": "spec_drafting"},
    {"from": "spec_drafting", "to": "spec_review"},
    {"from": "spec_review", "to": "spec_revision", "condition": "needs_revision"},
    {"from": "spec_review", "to": "spec_finalization", "condition": "approved"},
    {"from": "spec_revision", "to": "spec_finalization"}
  ],
  "metadata": {
    "created": "2024-12-24",
    "purpose": "Protocol specification generation sub-pipeline for ChainSocial",
    "designed_for": "spec-batch-processor parent pipeline"
  }
}
