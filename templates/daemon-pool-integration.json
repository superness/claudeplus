{
  "id": "daemon-pool-integration",
  "name": "Daemon-Pool Integration",
  "description": "Test daemonâ†’pool RPC integration with complete validation of communication between Bitcoin daemon and CoiniumServ pool server",
  "version": "2.0.0",
  "category": "integration",
  "stages": [
    {
      "id": "start_daemon",
      "name": "Start Bitcoin Daemon",
      "type": "executor",
      "agent": "bitcoin_daemon_manager",
      "description": "Launch bitcoind in regtest mode with RPC interface enabled for pool connection",
      "decisions": [
        {"choice": "daemon_started", "description": "Daemon running and RPC interface responding"},
        {"choice": "daemon_failed", "description": "Daemon failed to start or RPC not accessible"}
      ]
    },
    {
      "id": "configure_pool_rpc",
      "name": "Configure Pool RPC Settings",
      "type": "generator",
      "agent": "config_generator",
      "description": "Set daemon RPC connection parameters in pool configuration (host, port, user, password)",
      "inputs": ["start_daemon"],
      "decisions": [
        {"choice": "rpc_configured", "description": "Pool configuration updated with daemon RPC settings"},
        {"choice": "config_failed", "description": "Failed to update pool configuration"}
      ]
    },
    {
      "id": "start_pool",
      "name": "Start Pool Server",
      "type": "executor",
      "agent": "pool_server_manager",
      "description": "Launch CoiniumServ pool server with daemon RPC configuration",
      "inputs": ["configure_pool_rpc"],
      "decisions": [
        {"choice": "pool_started", "description": "Pool server running and attempting daemon connection"},
        {"choice": "pool_failed", "description": "Pool server failed to start"}
      ]
    },
    {
      "id": "test_rpc_calls",
      "name": "Test RPC Communication",
      "type": "validator",
      "agent": "rpc_tester",
      "description": "Verify getinfo and getblocktemplate RPC calls work correctly between pool and daemon",
      "inputs": ["start_pool"],
      "decisions": [
        {"choice": "rpc_calls_successful", "description": "RPC calls execute successfully with valid responses"},
        {"choice": "rpc_calls_failed", "description": "RPC calls failed or returned errors"}
      ]
    },
    {
      "id": "generate_test_block",
      "name": "Generate Test Block",
      "type": "executor",
      "agent": "bitcoin_daemon_manager",
      "description": "Create a new block in regtest and verify pool detects blockchain update",
      "inputs": ["test_rpc_calls"],
      "decisions": [
        {"choice": "block_generated", "description": "Block created and pool notified of chain update"},
        {"choice": "block_generation_failed", "description": "Failed to generate block or pool didn't detect update"}
      ]
    },
    {
      "id": "validate_template",
      "name": "Validate Block Template",
      "type": "validator",
      "agent": "daemon_pool_connector",
      "description": "Check that pool receives valid block template from daemon with correct structure",
      "inputs": ["generate_test_block"],
      "decisions": [
        {"choice": "template_valid", "description": "Pool received valid block template with all required fields"},
        {"choice": "template_invalid", "description": "Block template missing fields or malformed"}
      ]
    },
    {
      "id": "rpc_integration_verified",
      "name": "RPC Integration Verified",
      "type": "validator",
      "agent": "daemon_pool_connector",
      "description": "Final validation that daemon-pool RPC integration is fully functional",
      "inputs": ["validate_template"],
      "decisions": [
        {"choice": "complete", "description": "Daemon-pool RPC integration verified and working correctly"},
        {"choice": "verification_failed", "description": "Integration issues detected in final validation"}
      ]
    }
  ],
  "flow": {
    "type": "sequential",
    "description": "Step-by-step validation of daemon-pool RPC integration from daemon startup through block template validation",
    "connections": [
      {
        "from": "start_daemon",
        "to": "configure_pool_rpc",
        "condition": "daemon_started",
        "description": "Daemon running, configure pool RPC settings"
      },
      {
        "from": "start_daemon",
        "to": null,
        "condition": "daemon_failed",
        "description": "Daemon failed to start - PIPELINE ENDS"
      },
      {
        "from": "configure_pool_rpc",
        "to": "start_pool",
        "condition": "rpc_configured",
        "description": "RPC settings configured, start pool server"
      },
      {
        "from": "configure_pool_rpc",
        "to": null,
        "condition": "config_failed",
        "description": "Configuration failed - PIPELINE ENDS"
      },
      {
        "from": "start_pool",
        "to": "test_rpc_calls",
        "condition": "pool_started",
        "description": "Pool running, test RPC communication"
      },
      {
        "from": "start_pool",
        "to": null,
        "condition": "pool_failed",
        "description": "Pool failed to start - PIPELINE ENDS"
      },
      {
        "from": "test_rpc_calls",
        "to": "generate_test_block",
        "condition": "rpc_calls_successful",
        "description": "RPC calls working, generate test block"
      },
      {
        "from": "test_rpc_calls",
        "to": null,
        "condition": "rpc_calls_failed",
        "description": "RPC calls failed - PIPELINE ENDS"
      },
      {
        "from": "generate_test_block",
        "to": "validate_template",
        "condition": "block_generated",
        "description": "Block generated, validate template"
      },
      {
        "from": "generate_test_block",
        "to": null,
        "condition": "block_generation_failed",
        "description": "Block generation failed - PIPELINE ENDS"
      },
      {
        "from": "validate_template",
        "to": "rpc_integration_verified",
        "condition": "template_valid",
        "description": "Template valid, perform final verification"
      },
      {
        "from": "validate_template",
        "to": null,
        "condition": "template_invalid",
        "description": "Template validation failed - PIPELINE ENDS"
      },
      {
        "from": "rpc_integration_verified",
        "to": null,
        "condition": "complete",
        "description": "Integration verified successfully - PIPELINE ENDS"
      },
      {
        "from": "rpc_integration_verified",
        "to": null,
        "condition": "verification_failed",
        "description": "Final verification failed - PIPELINE ENDS"
      }
    ]
  },
  "metadata": {
    "tags": ["integration", "daemon", "pool", "rpc", "validation", "mining-cycle"],
    "author": "Mining Cycle Automation System",
    "estimatedTime": "3 minutes",
    "requiresWSL": true,
    "refactored": "2025-01-22 - Removed type fields",
    "basedOn": "Section 3.1 of MINING_CYCLE_AUTOMATION_PLAN.md",
    "components": [
      "bitcoin_daemon_manager",
      "config_generator",
      "pool_server_manager",
      "rpc_tester",
      "daemon_pool_connector"
    ]
  }
}
