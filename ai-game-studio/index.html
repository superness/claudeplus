<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Game Studio</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header id="header">
      <div class="logo">AI Game Studio</div>
      <div id="user-area">
        <span id="user-email"></span>
        <button id="logout-btn" class="btn-secondary">Logout</button>
      </div>
    </header>

    <!-- Auth Screen -->
    <div id="auth-screen" class="screen">
      <div class="auth-container">
        <h1>AI Game Studio</h1>
        <p class="tagline">Describe your game. We'll build it.</p>

        <div class="auth-tabs">
          <button class="tab active" data-tab="login">Login</button>
          <button class="tab" data-tab="signup">Sign Up</button>
        </div>

        <form id="login-form" class="auth-form">
          <input type="email" id="login-email" placeholder="Email" required>
          <input type="password" id="login-password" placeholder="Password" required>
          <button type="submit" class="btn-primary">Login</button>
          <div class="error-message" id="login-error"></div>
        </form>

        <form id="signup-form" class="auth-form hidden">
          <input type="email" id="signup-email" placeholder="Email" required>
          <input type="password" id="signup-password" placeholder="Password (min 6 chars)" required minlength="6">
          <button type="submit" class="btn-primary">Create Account</button>
          <div class="error-message" id="signup-error"></div>
        </form>
      </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen hidden">
      <div class="dashboard-container">
        <div class="dashboard-header">
          <h2>Your Games</h2>
          <div class="dashboard-actions">
            <button id="import-game-btn" class="btn-secondary">Import Existing</button>
            <button id="new-game-btn" class="btn-primary">+ New Game</button>
          </div>
        </div>

        <div id="projects-list" class="projects-grid">
          <!-- Projects populated by JS -->
        </div>

        <div id="no-projects" class="empty-state hidden">
          <h3>No games yet</h3>
          <p>Create your first game by clicking the button above!</p>
        </div>
      </div>

      <!-- New Game Modal -->
      <div id="new-game-modal" class="modal hidden">
        <div class="modal-content">
          <h2>Create a New Game</h2>
          <form id="new-game-form">
            <label for="game-name">Game Name</label>
            <input type="text" id="game-name" placeholder="My Awesome Game" required>

            <label for="game-type">Game Type</label>
            <select id="game-type">
              <option value="2d">2D (Phaser.js)</option>
              <option value="3d">3D (Three.js)</option>
            </select>

            <details class="advanced-options">
              <summary>Advanced Options</summary>
              <label for="design-complexity">Design Pipeline Complexity</label>
              <select id="design-complexity">
                <option value="">Auto-detect (Recommended)</option>
                <option value="simple">Simple - Client-side only, no backend (~15-30 min)</option>
                <option value="standard">Standard - May need light backend (~4-6 hours)</option>
                <option value="complex">Complex - Full backend architecture (~8-20 hours)</option>
              </select>
              <p class="option-hint">Auto-detect analyzes your game idea. Simple games (tic-tac-toe, snake) skip backend design entirely.</p>
            </details>

            <label for="game-idea">Describe Your Game</label>
            <textarea id="game-idea" rows="6" placeholder="A space trading game where players can mine asteroids, trade goods between space stations, engage in combat with pirates, and build their own fleet..." required></textarea>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" id="cancel-new-game">Cancel</button>
              <button type="submit" class="btn-primary">Create Game</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Import Game Modal -->
      <div id="import-game-modal" class="modal hidden">
        <div class="modal-content">
          <h2>Import Existing Game</h2>
          <p class="modal-description">Import an existing game project from your filesystem. This lets you manage and iterate on games built outside AI Game Studio.</p>
          <form id="import-game-form">
            <label for="import-name">Game Name</label>
            <input type="text" id="import-name" placeholder="My Existing Game" required>

            <label for="import-path">Path to Game Files</label>
            <input type="text" id="import-path" placeholder="C:\github\my-game\output" required>
            <p class="option-hint">Windows path to the folder containing your game files (index.html, assets, etc.)</p>

            <label for="import-description">Brief Description</label>
            <textarea id="import-description" rows="3" placeholder="A strategy game where players manage resources and build empires..."></textarea>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" id="cancel-import-game">Cancel</button>
              <button type="submit" class="btn-primary">Import Game</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Studio Screen -->
    <div id="studio-screen" class="screen hidden">
      <div class="studio-container">
        <!-- Left Panel: Chat -->
        <div class="panel chat-panel">
          <div class="panel-header">
            <button id="back-to-dashboard" class="btn-icon">&larr;</button>
            <h3 id="project-name">Game Name</h3>
            <span id="project-status" class="status-badge">designing</span>
            <button id="delete-project-studio" class="btn-icon btn-danger" title="Delete project">&#128465;</button>
          </div>

          <div id="chat-messages" class="chat-messages">
            <!-- Messages populated by JS -->
          </div>

          <div id="progress-indicator" class="progress-indicator hidden">
            <div class="progress-bar">
              <div class="progress-fill" style="width: 0%"></div>
            </div>
            <span class="progress-text">Starting...</span>
          </div>

          <!-- Pipeline Feedback Input (collapsible, shown during active pipeline) -->
          <div id="pipeline-feedback" class="pipeline-feedback hidden">
            <button class="feedback-toggle" id="feedback-toggle" type="button">
              <span class="feedback-toggle-icon">ðŸ’¡</span>
              <span class="feedback-toggle-text">Inject Feedback</span>
              <span class="feedback-toggle-arrow">â–²</span>
            </button>
            <div class="feedback-content" id="feedback-content">
              <div class="feedback-input-row">
                <textarea id="feedback-input" placeholder="Add your perspective or correction..." rows="2"></textarea>
                <button id="inject-feedback-btn" class="btn-feedback" type="button">Inject</button>
              </div>
              <div id="feedback-status" class="feedback-status"></div>
            </div>
          </div>

          <form id="chat-form" class="chat-input">
            <div class="chat-input-row">
              <textarea id="chat-input" placeholder="Describe a feature or report a bug..." rows="2"></textarea>
              <div class="chat-controls">
                <select id="pipeline-type-select" class="pipeline-type-select">
                  <option value="feature">Add Feature</option>
                  <option value="bugfix">Fix Bug</option>
                </select>
                <button type="submit" class="btn-primary">Send</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Center Panel: Game Preview -->
        <div class="panel preview-panel">
          <div class="panel-header">
            <h3>Live Preview</h3>
            <div class="preview-controls">
              <button id="refresh-preview" class="btn-icon" title="Refresh">&#x21bb;</button>
              <button id="fullscreen-preview" class="btn-icon" title="Fullscreen">&#x26F6;</button>
            </div>
          </div>
          <div class="preview-container">
            <iframe id="game-iframe" src="about:blank"></iframe>
            <div id="preview-placeholder" class="preview-placeholder">
              <p>Your game will appear here once the first build completes.</p>
            </div>
          </div>
          <div class="game-url">
            <span>Game URL:</span>
            <a id="game-url-link" href="#" target="_blank"></a>
          </div>
        </div>

        <!-- Right Panel: Work Queue -->
        <div class="panel queue-panel">
          <div class="panel-header">
            <h3>Work Queue</h3>
          </div>

          <!-- Server Panel (for full-stack projects) -->
          <div id="server-panel" class="server-panel hidden">
            <div class="server-header">
              <h4>Server</h4>
              <button id="analyze-server-btn" class="btn-icon" title="Re-analyze project">&#x21bb;</button>
            </div>
            <div class="server-status">
              <span class="status-dot" id="server-status-dot"></span>
              <span id="server-status-text">Stopped</span>
              <span id="server-uptime" class="server-uptime"></span>
            </div>
            <div class="server-url hidden" id="server-url-container">
              <a id="server-url" href="#" target="_blank">http://localhost:3000</a>
            </div>
            <div class="server-controls">
              <button id="server-start-btn" class="btn-server btn-start">Start</button>
              <button id="server-stop-btn" class="btn-server btn-stop" disabled>Stop</button>
              <button id="server-restart-btn" class="btn-server btn-restart" disabled>Restart</button>
            </div>
            <div class="server-scripts hidden" id="server-scripts-container">
              <select id="server-script-select">
                <option value="">Run script...</option>
              </select>
              <button id="run-script-btn" class="btn-secondary" disabled>Run</button>
            </div>
            <div class="server-logs">
              <div class="logs-header">
                <span>Logs</span>
                <button id="clear-logs-btn" class="btn-icon btn-small" title="Clear logs">Clear</button>
              </div>
              <div id="server-logs-content" class="logs-content">
                <div class="log-placeholder">Server logs will appear here...</div>
              </div>
            </div>
          </div>

          <div class="queue-section">
            <h4>In Progress</h4>
            <div id="current-work" class="queue-items">
              <div class="empty-queue">Nothing running</div>
            </div>
          </div>

          <div class="queue-section">
            <h4>Queued</h4>
            <div id="queued-items" class="queue-items">
              <div class="empty-queue">No items queued</div>
            </div>
          </div>

          <div class="queue-section">
            <h4>Completed</h4>
            <div id="completed-items" class="queue-items">
              <div class="empty-queue">No completed items</div>
            </div>
          </div>

          <div class="queue-section stories-section">
            <h4>Pipeline Stories</h4>
            <div id="pipeline-stories" class="queue-items">
              <div class="empty-queue">No stories yet</div>
            </div>
          </div>

          <div class="queue-section usage-section">
            <h4>AI Usage</h4>
            <div id="usage-summary" class="usage-summary">
              <div class="usage-stat">
                <span class="usage-label">Total Cost</span>
                <span class="usage-value" id="usage-total-cost">$0.00</span>
              </div>
              <div class="usage-stat">
                <span class="usage-label">Input Tokens</span>
                <span class="usage-value" id="usage-input-tokens">0</span>
              </div>
              <div class="usage-stat">
                <span class="usage-label">Output Tokens</span>
                <span class="usage-value" id="usage-output-tokens">0</span>
              </div>
              <div class="usage-breakdown" id="usage-breakdown">
                <!-- Usage by action type will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>
